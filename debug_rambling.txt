sim=true
2
2175

2
2175

sim=false
2
659
2870


sim == false
no intro/loading
2
1000


sim == true
no intro/loading
2
1000

even with everything off, those 2 are still being got.
why?
oh, time till reckoning and sessionType. i will initialize them to non random.


now simmode gets me 2040, with intro and loading. instead of 2175. so confused.

simodd false (so rendering) gets me
659
2870

so whether or not there is more in rendering is different for different sessions.

what if only intro, no tick
659
800

vs

1000

so rendering uses 459 more seeds. why.

okay, lets look at the "real" sim.
real page	ai finder simulation = false
977		659
2870		2870

I wonder why rendering has the console statements print
out in 2 parts, and not consistently in 2 parts?
Like...both things have 2870 as the second part.
But the first part is different. Why?

The second part seems to be the important part...
The MVP of the session was: Grim Dark Heir of Rage's Corpse with a power of: 203
The MVP of the session was: Grim Dark Heir of Rage's Corpse with a power of: 203
Both have same result, even same power (which means everything was the same, basically)

IS THE SEED GETTING RESET?
Is that why only number of seeds being got AFTER a point matter?

Nope. only called once.

Okay. What do I know?

There is a problem even in the intro stuff.
That greatly shortens the stuff I have to look into.

Simulation = false is identical to the real stuff,
so only need to debug one page.

Question: What happens in the intro (when sim=false).

Where/when does it differ from sim-true?

Both intros are identical.  But...use different amount of seeds?  Okay,
maybe directly measureing seeds isn't the best way? with regular ticks on,
 where do they start to differ?

4kmonitor ftw that i can put these side by side to compare


!!!!!!!!!!!!!!!!!!!!!!!!!
The very last thing that is the same is
The Maid of Void makes a general nuisance of themselves to the Black Queen.

Then,sim-false the Heir of Rage black flirts with Knight of Space,
 and gets rejected. Then ectobiology happens.

Then,sim-true, "
The Heir of Rage has taken an acrobatic fucking pirouette off the handle and into a giant pile of crazy. They engage Murder Mode while thinking of their enemies Knight of Space and Seer of Time and Page of Light and Rogue of Mind and Sylph of Heart and Thief of Breath. This is completely terrifying. "


Yeah, that would hella cause a difference between sessions.

So, is relationshipChat somehow using up randomness?
There is a space for a chatlog in the sim-true version...
But, the relationshipDrama should still be happening, just not being rendered....
it's not the first chat, but it IS the first relationship chat.

HR is antagonizing a jerk, which means they are indeed triggered (possibly just as much as when they engage murder mode)

printing out the text that would have been there, it is the same for both of them.
drawRelationshipChat doesn't seem to consume random.

Okay, what if I allow that thing to render, but nothing else. Does source of difference dissappear?


....What. The. Hell. It freaking APPEARS TO!? Smae MVP with same power and everything. This makes no sense.
I'm not actually even rendering anything but text, 'cause still no loading.

Alright. WHY is this happening?


Alright, well, drawChat and drawRelationshipChat are actually pretty similar. So look for their differences.

dRC gets the relationship to know if they should render heart or spade or nothing. Is that it? Doesn't appear to consume
a seed. if i comment it out, will sim-false do an accrobatic piorrette (both literally and figuarativelY)

Yep. Still doesn't make sense. But NOT rendering the heart or spade causes acrobatic pirouettes.

Look deeper.

It's not from rendering their empty buffers. still acrobatic pirouette

Is it getting the relationship? No.

Is it drawing the symbol?

Is it .....fuck. FUCK!!!!

I'm asking the relationship what type it is! That's WRONG! That's allowing it to recalculate
the relationship (for example, fall out of love). I'm supposed to be querying the savedType.
THAT was consuming the random!

!!!!!!!!!!!!!!!!!!!!!!!!!!!!I AM THE GREEEEEEETEST!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Also, now I need to go make sure anywhere i'm using type() is saved_type unless i really meant it.

Fuck. Fuck. It's still happening though, even though i found an obvious use of random seeds.

Oh god, I just realized that before when i was rendering empty buffers, I thought it was right that it was still pirouetting.
that's wrong. damng.

Wait. no, that's actually right. the rendered version is wrong. acrobatic piroutte is right because it's when less seeds.

compare both versions.










And now for something entirely different. This is the best place to put a ramble, but it's not even at the debug phase yet.

Problem: I wish to change exactly one thing in a session, at a specific point in time.

Related information.

I have a several ways to identify a point in time in session, but none of them are currently accessible in a meaninful way.

*  Tick:  There are both regular and reckoning ticks. this information is indirectly available in the sesion's "timeTillReckoning" variable. it's negative after a reckoning.
* Scene Index:  I have a list of "scenesTriggered" in the sesion, which is how I summarize a session, partly. This list is not guaranteed to be useful. I'm pretty sure it just adds the scene in the scene list. The same scene can appear multiple times, and will in fact be changed over time (for example, corpse smooch will have different players attached to it.)


Sub problems:
* Identify an important event.
* add an event before the important event.



"add an event before the important event." appears to be the easier subproblem. I will tackle it first.
Given that I have a way of identifying an event, I need to have a scene that triggers right before that event. If it's based on tick, then trigger will happen when this.session.timeTileReckoning=x. if it's based on scenesTriggered index, then it will happen when this.session.scenesTriggered.length = x; That SHOULD be all I need.  scene should not repeat, and should have absolutely highest priority...or...hrrm.

SHOULD it have highest priority? It just needs to happen before the important event, right. But "timeTillReckoning" can have many scenes called. So if i give it highest priority, it might happen several scenes before it should.

CONSTRAINT FOUND:  Scenes need to be identified by scenesTriggered index, not timeTillReckoning. This makes sense in retrospect.


PROBLEM FOUND: scenesTriggered index will not be consistent between timelines.

I need them to be.  The whole point is that the Observer (that's you, btw) gets to make a decision after a virgin doomed timeline happens.
So,they insert a scene that wasn't there before. Which by definition alters the index of the previous thingy.



Alright, think about this in more detail.

Sequence of Events:

Session procedes on the regular and ends in tear-jerking tragedy.

At the very end, AB and I show up.

I offer the Observer and time player a yard's worth of Decisions.

Session reloads, then procedes on the regular until the time player warps in to make a change.

Session is altered. Either ends in  tear-jerking  tragedy, or in less tragedy, or success.

If tear-jerking tragedy, At the very end, AB and I show up.

I offer the Observer and time player a yard's worth of Decisions, including the decision to undo their previous decision.


Session reloads, then procedes on the regular until the time player warps in to make a change.  Both THIS decision will be implemented AND the previous decision (unless you decided to undo this.)


Repeat until either Observer gives up or there is no more tear-jerking tragedy.





So, once more:



PROBLEM: scenesTriggered index will not be consistent between timelines.

Brainstorm Solutions:

add array to SaveDoomedTimeLines.  List of scene indexes to alter.  No, make new object that has index/result function pairings?

no...if being that different, make new scene.  YellowYardResult or some shit.

If I am careful to play the new scene juuust before the old one, then....wait. okay. no.
I was going to say "resave the old scene index +1", but that won't be true every time. or even consistently. if a new scene has been added before me, add 1, else it's the same. hrrrrm...

so, YellowYardResult will also have a boolean if a new scene has been added yet. (only one new scene can be added a runthrough.) if yes, increment your scene_trigger_id. if no, do nothing.






Okay, I"m sure that's not enough to work just yet, but it's enough to start. BUT, there is still another subproblem I have not yet addressed:



* Identify an important event.

How do humans do this?

Types of important events:
	* a player dying
	* a player engaging murder mode
	* a player going grim dark
	* jack being promoted.
	* frog breeding


So, how do I decide which events to include in my Yellow Yard? Through the session summary code, I know I can find if MurderPlayer has happened. But that scene can result in a murder or result in clubs/diamonds.

Okay, well, when I say "player dying", do I mean a permanent death, or any death?

Should I have scenes be capable of creating a "ImportantEvent" object to give to their session?

That might solve both sub problems. If a scene creates the important event BEFORE RENDERING, it can trigger the session to go to it's YellowYardResult object or whatever and decide whether or not the event should be altered.

I am tentatively optimistic.


So, obviously if i was in a sane language, I'd have different types of Important Events subclass out from the main one, but javascript does not give a fuck.
Should Important Events be like scenes (i.e. a different class for each event), or should it be a big stupid jumble. Problem with different classes/files is it gets cumbersome including it in html documents and also is spoilers.

big stupid jumble it is. but like, a hybrid jumble, with the different objects in a single file.

An Important Event has a human readable label, and a function that is how to prevent that Event. (both the text/image to display and the results.  like player.dead = false. or whatever.)
It should also have an importanceRating, because if I have more than a Yard's worth, I have to trim the list SOMEHOW.

when a session is done and qualifies for a YellowYard, I display the list of important events that happened this session. One is selected and saved in the YellowYardResult object or whatever.

 Then, the session is redone. Just like before, each time an ImportantEvent happens, the session asks the YellowYardResult if it's allowed to happen.  This time, for one of them, YellowYardResult says "no".
 It says "no" because the ImportantEvent perfectly matches the saved event.

 Example of match.:

 ImportantEvent.subtype = "Player dies with a living dream self without God Tiering."
 ImportantEvent.player = "Heir of Life"


Note: this means that this Important Event can be matched even if it is under very different circumstances. For example, the timeline can vastly change, but so long as the Hier of Life still dies without godtiering, this event would be altered. Do I want this?

For the authorBot, a good way to check if a session has changed before now is the check the value of the MVP. If things are mostly the same besides cosmetic stuff, this value will also be the same.

Alright,

 ImportantEvent.subtype = "Player dies with a living dream self without God Tiering."  (automatically decides importanceRating)
 ImportantEvent.player = "Heir of Life"
 ImportantEvent.mvp_value = 342

 BAM, now altered events are mostly stable.

 Okay, where was I?

 Okay, so the YellowYardResult has found a match. it tells the session, which returns to the scene that calls it. The scene does not render itself, and instead render the ImportantEvent.alternateTimeLine(); I need to make sure this function changes all relevant variables. Or...

 Hrrm...  Let's say the ImportantEvent was the GrimDark MurderMode Heir of Life dying.   The scene kills them, (which clears our their status modifiers), and then asks if it can render the result. It is told no, and ImportantEvent.alternateTimeline brings them back to life.  But it doesn't know they were GrimDark MurderMode and doesn't restore that.

 That clearly is unacceptable.

 So, the scene should create an ImportantEvent BEFORE modifying anything. Not just before rendering.  But the problem is that many scenes modify things over time. Hrrrm.  Well, the important event can be PART of a scene.   Example, jack starts to show his stabs to the Heir of Life and the Maid of Mind, but the Bard of Time warps in and carts the Heir of Life's corpse to their sacrificial slab/quest bed.

 Okay, at this point I'm just waffling to avoid coding because once I start this will be real and WHAT IF IT'S STILL IMPOSSIBLE!?  Time to code.





 TODO:   22577

 why is page of time god tier twice listed? is it just first?  in subsequent loops its life that gets repeated

 add alternate scenes for all important events
  make player not die is NOT just an alternate to god tiering. god tiering deals with corpses, but not dying needs to be the scene that MAKES the corpse

 add scene for undoing your own undoing. basically generate list from scenesToUndo.  add before killing players list.




 Problem. Trying to remove functional duplicates from importantEvents. Objects aren't literally the same, but values are.

 Current way is looping through an inner loop and an outter loop. problem is that let's say my array is:

 [1,2,3,4,1,2,3,4,1]

 In the outter loop I look for "1".  I find it two additional times, and mark the extras for removal. I succesfully don't mark 'myself'.

 But...then, the fourth element, the second 1, when i loop on THAT, I find the first 1. And mark it for removal. And thus ALL 1s are marked for removal.

 How to fix?

 Well, I could probably extend javascripts native filter thing. But i don't want to . I'm feeling intellectually lazy.

 hrrrrm.

 Well, the inner loop doesn't HAVE to start from zero. It can start from the outter loop index. that should do it.


                          ```````   `                 `  ``   `                        ```````                           `
                      ```` `   `   ````           `````   `   `````               ````  `   `` ````                ````  `   ``` `
                   ```               ````        ```             ````           ```                ```          ```             ````
                  ``                   ```      ``                 ```         ```                  ```        ```                ``
           `````..``.`..`````````.``.``-``.``..`..``.```.``..``.``.``.``.``.``-`.-``.``.`..``.``.``..`..``.``.``.```..``.``..`..````..````
           `.-............-..-...-.....-........................................................................-.......................-.`
           `.-..........................................................................................................................-.`
           `......:-....-::::::::::----:++++++++++++++oo+++::::::::::::::...::::::::::::::---------::::::::::::::::::::::::::-....-:......`
           `.-..../.                 -ohddddddddddddddddddhh+`           `.`                                                      ./....-.`
           `......+.              .+yhddddddddddddddddmmmmmddy.          `.`                            `     `                   .+......`
       `````.-....+.           `:shddddddddddddddddmNNNNNNNNmdy.         `.``.+o+.`  `.oo/.           .sh   .sh                   .+....-.` ```
     ```   `......+.         -ohdddddddddddddddmmNNNNNNNNNNNNmdy`        `.`  +d+      sd:             yd    yd                   .+......`   ```
     ```   `.:....+.         .yddddddddddddmmddNNNNmshNNNNmmNNmdo        `.`  +d+      sd-    ---:.    yd    yd    `---:.         .+....:.`    ```
    ```    `......+-          `+hdddddddddms:-hNdyo.``:shmN+omNdh-       `.`  +do------yd-  -s.``-ho   yd    yd   /o```-ss`       -+......`    ```
    ```    `.-....+:            .ohddddddy-``.:-.````````.-:`-NNdo       `.`  +d+``````yd-  yy:::://`  yd    yd  -h:    -do       :+....-.`    ```
     ```   `......+-              .+hdddds```````````````````.NNmh.      `.`  +d+      sd-  yh.    .`  yd    yd  :do    `d+       -+......`    ```
     ```   `.-..../.                .sddddy-`````````````````+Nmdo`      `.`  odo      yd:  -yho//+:   yd    yd   +h/` `/o`  /o.  ./....-.`    ``
       `````....../.                 -yddddh/```````````````/dyo-        `.``.:::.`  `.::-`  `-//:.   .::.  .::.   .::-..    -/`  ./......` ````
        ````......+.                /hddddddds:``````````.-/:.`          `.`                                                      .+......````
           `......+.               -ddmddddddddo-..-//+ohms              `.`                                                      .+......`
           `.-....+.              -hdNmddddddddddhhdddddyNh              `.`                                                      .+....-.`
           `-.....+.           .-ohddmdddddddddddhhdddddso:              `.`                                                      .+.....-`
          ``......+.          .ohdddddddddddddddhs/ddddddh:              `.`                                                      .+......`
        ````......+.         ```:hdddddddddddddh+--/hdddddh-             `.`                                                      .+......`````
      ```  `......+-      ``````.hddddddddddddho....+dddddy`             `.`                                                      -+......`  ```
     ````  `.:...-+:   ``````` `odddddddddddddo/-..-+sdds/.``            `.`                                                      :+-...:.`   ```
     ```   `....../-`````````   :sssssssyyyyyys+o++o+syyo `````          `.`               ````````````````                       -/......`    ``
     ```   `........````````````--------:::::::::::::::::.````````````````.````````````````````````````````````````````````````````.......`    ``
     ```   `....../```````      -+syyyhhhhhhhhhddddddhyo/.    ```        `.`                                                      `+......`   ```
      ``   `.....-+`   `````       ``.shdddddddddddddo         ```       `.`                                                      `+-.....`   ```
       ``` `.....-+`      `````   ````-/hddddddddddddh-         ```      `.`                                                      `+-.....`  ``
         ```.-...-+`          ````````..:oddddddddddddh.         ```     `.`                                                      `+-...-.```
           `.....-+.                 :shyddddddddddddddy.         ```    `.`                                                      .+-.....`
           `.-...-+.                 sddddddddddddddddddy.        ```    `.`                                                      .+-...-.`
           `......+`                 ydddddddddddddddddddh.        ```   `.`                                                      `+......`
        ````......+`                -hydddddddddddddddddddy`        ``   `.`                                                      `+......`````
      ```  `......+`                +hsdddddddddddddddddddds`        ``  `.`                                                      `+......`  ````
     ```   `.....-+`                +y+hddddddddddddddddddddo         `` `.`                                                      `+-.....`   ```
     ```   `.-...-+`                ys+yddddddddddddddddddddd/         ` `.`                                                      `+-...-.`    ```
     ```   `.....-+`               -d++sdddddddddddddddddddddh-        ```.`                                                      `+-.....`    ```
     ```   `:....-+`               -s++ohhhhhddhdddddddhhhhyso+        ` `..`                                                     `+-....:`   ```
      ``   `.....-+`                .++++++oooo-::::/oooo++++++.         `..`                                                     `+-.....`   ```
       ````..-...:+`                -+++++++++/      :+++++++++/         `.`                                                      `+:...-.` ````
        ```......-+.                -+++++++++/       /+++++++++.        `.`                                                      .+-......```
           `.-...:+.                -+++++++++/       `+++++++++/        `.`                                                      .+:...-.`
           `.-...-+-                -+++++++++/        :+++++++++`       `.`                                                      -+-...-.`
           ......./:...--:::::::::--://///////:......--://///////::::::::...::::::::::::::--------:::::::::::::::::::::::::::--...:/.......
           ..-..........................................................................................................................-..
           ..-........-...-..-..................................................................................-..............-........-..
           `````-``.``.```.`````..`..`..``-``-``-``..``.```-``.```.``.`..``.`..`..`..`..`.``..`..``-``.``.``..``.```-```.``-```.``.``-`````











Okay, now that THAT's out of the way....

time to update the Rare Session Finder.

my original thought was to have a new page entirely, where you can pick what you want to look for from a drop down menu, and then AuthorBot prints a list of sessions out that match your criteria.  But karmicRetribution has an intriguing idea: On the 'stats' section, have them be clickable to filter sessions out.

So: Design time.

~~~~Sequence of Events:

Page is loaded.  Can pick number of sessions to check, and click "check sessions."

Stats for All Sessions updated with each session, and stats for A session print below.

Click on a total stat line, and it filters sessions to only be ones where that value is 'true'.   Total stats now only reflect filtered list?  Button added to delete all filters.
~~~~~~~~~~~~~~~~~~~~~

So, I will have to refactor some stuff.

Right now the way total session stats are calculated is each session adds to a global variable when they are asked to summarize themselves. if i were to call that multiple times, it would inflate the value. and there is no way to get it for only a subset of sessions.

bluh. bob warned me about global variables. he told me, dog.


So, instead of having global variables, have each session contain a summary object (much like a player snapshot).  When I ask for a session's summary, it generates this object.  Move the "summary HTML" code outside of the object itself. just make it a global function. Then, I get combo stats by asking all sessions in an array to give me their stats.

have sessions array, and filteredSessions array.  Sessions array is never modified. filteredSessions array is always a object by object copy (even if there is nothing to filter by).

what happens if they check a session while it's filtered?



bluh, okay time to actually try filtering.

I can test to see if a session summary has any arbitrary variable filled. won't help with frog leve, but baby steps.

but...standard array filtering doesn't work that way. it wants you to specify the variable in advance. so maybe will have to have a lot of bullshit methods?

sequence of events:

click on collated stat. calls method, giving the parameter name to the method.  method mostly just filters based on parameter name, with a few being special.

that's what I WANT...but Array.filter only lets me pass an object in, not anything else....right? Confirm this.  yeah....seems like it.  can just write my own, linear time code.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~




okay. time for the main event.

SHIIIIIIIIPPPPING!

can label a relationship as being in a quadrant now. want to carefully refactor things to check on them.

if <> killed, super fucking trigger plus super-hate killer should be insta-murdermode.

as long as you have a relationship of type <>, less likely to engage murder mode.

if you try to kill c3<, middle leaf intervenes if able.

can do break ups, or cheat.

~~~

Man. I spent all yesterday making easter eggs and hiding links for them. And then giving a bonus to my tumblr followers by violating the easter egg aesthetic and giving them links to them.

I kind of...want to do something with that for 413. No way I'll get my next major feature (character creation) done in time...but I still should do SOMETHING, right?

I'm thinking riddles.  Ask some sufficiently obtuse question, and the answer is expected to be a seed id. if you enter a seed id that fits the riddle (from it's summary), list of various easter egg urls (including maybe a link to THIS whole mess) are revealed.

would that even be fun or cool?

......
Bluh. For the record, can I just say that the medical tv show "House"  is complete bullshit. Like, I get that it's fiction. But you still figure that there are magical hyper-competant doctors out there that can DIAGNOSE you. Like. In this day and age shit being left undiagnosed is such bullshit.
Especially when the internet is just there, telling you about all these cutting edge tests for various bullshit diseases that no actual doctor has ever heard of. Or genes that are definitely diagnostic of something that it turns out there are no commercial tests for.  Hope you live near the one lab on the planet that developed those gene tests, buddy.  Although I guess at this point the list of shit I could have is pretty incurable. So. Diagnosis is more solving a puzzle then something actually useful. bluh. /rant.
.....


Okay. Let's focus. Fo-cus. Focus! (Magic Cupcakes by Octopimp on youtube has just corrupted that entire word for me.)  Today's goal is to let people break up from their quadrants, even though that should be hella rare.

THINGS THAT CAN TRIGGER A BREAKUP:
* Feelings change
* Cheating (on either parties part.)

I figure "feelings changing" shouldn't be an automatic breakup session, after all inertia is totally a thing.   And I want to move away from using seeds if I can help it for a variety of reasons.  I dont' have enough claspect specific stuff going on right now.

Some classes will hold onto a relationship for longer, regardless of why a break up might be valid. Maybe different inertial rates depending on the event.

If I am a Knight AND I am cheating on you, I confess and break up with you. Seems chivalrous. (although maybe NOT cheating would be better, but cheating is already rare enough, I'll leave it as is.)
If I am a PAGE in the same situation, maybe I just sort of let it...keep happening.  Or a Rogue, like Rufio and Damara.

So, break things up into Active/Passive lines?  Not all the Active/Passive stuff is known...but I can make educated guesses. It's not like it'll be explicit.
I can also have a few Interests (like whatever superclass "Romance" is in) influence your odds of calling things off. I figure if you are good ar romance you migth be more likely to be honest and open? and terrible people just...arne't.

Meanwhile, if your partner is cheating on YOU, chance of finding out and breaking up with them.  This tends to result in much worse feelings.  Triggers and hate and what not.  Damara went into murder mode, basically, after she found out about Horrus.

MurderMode would probably be a MUCH more likely option in the case of diamonds cheating.

Clubs cheating is totally not a thing.

Oh! And if there is a heart player, everybody is MUCH MORE LIKELY to be open and honest (thus reducing the murder mode freak outs). Cause hell, if you don't tell them you have a new <3, then the heart player might.




PROBLEM:

If CorpseSmooch takes priority over GetTiger, then MOST players will only god tier through sacrificial slabs.  But if GetTiger takes priority over CorpseSmooch, ALL players will god tier the first time they die and not leave any for Sacrificial Slab. That's because CorpseSmooch is a one time thing. If you don't get smooched, your dream self dies and you are no longer eligible for smooching. (Note to self, maybe let usless smooches happen, creepy Gamzee style). But GetTiger happens so long as you have at least a dream self and are destined to god tier.

BLUUUUUUUUUHHHHH.

Okay. Think.

You SHOULD be able to do multiple scenes in a row. That's what the availablePLayers array is for, right? Is GetTiger ever setting a player as unavailable? If so, just undoing that will acomplish two things:
1.) If a player fails to GetTiger, they will then hit the corpse smooch, which will leave them ready for the sacrificial slab the next time they die.
2.) GodTier players get a free extra action. They are Gods, don't worry about it.

Huh, no, I don't seem to be setting available players. So...why...why isn't corpse smooch being called next?
Okay, adding some console output, and it looks like Corpse smooch thinks there are no dead players. Look into GetTiger. Is it reviving them regardless of what I do?  Yes. Yes it is. Okay then, return when random chance says no quest bed.

Heh. Also, don't render them 'reviving' if they haven't. Duh.


from DestroyerTerraria sent 11 minutes ago
"X of X is fucking pissed at X of X. They'll get thrown the fuck down by their lyrical flow, Get their asses kicked with words that cause em woe, Gonna bust every rhyme they could possibly know- X of X started some SICK FIRES, YO!"

Oh god. How much of my life is going to be sacrificed to making the worlds shittiest rap engine?  Focus:

Priorities:
* Claspect Character Creator
* Some claspect customization
* Shitty Rap Engine
* Cosmetic/Interest/KernelSprite Character Creator Upgrade.
* Refactor battle system for luck/hp, etc.
* More claspect customization


TODO: First thing is allow class and aspect to be chosen. Won't be very different from the OC_Generator (does that thing still work?). Basically, step one will be having the Observer input a session ID to replay/hijack/override. Then, load the players from that session and display them. Drop downs over the sprites let you change Class/Aspect for each player. Sprite updates with the new claspect. When it's to your liking, can click "start", and session begins BELOW character creator (don't vanish it cause they might want to see their chars in a pristine state.)

		Challenges:
		* Handling graphics.  For the regular sim, I just preload all the graphics that will be used and call it a day. This is fine, but with a character creator, I don't KNOW what graphics I will use. Should I preload dozens of hair, for example?  MB's been poking me to do asyncronous image loading, but it has it's own challenges, which is why i went away from it in the first place. I will need to stop and THINK about this.
		* Sharing sessions. Can't just use session IDs anymore. Will need to serialize the player data in some fashion. Write to image, along with pictures of their players? Might be neat.  Top border is random-looking stuff that's actually the encoded session, and underneat it is the human understandable: here's what the players look like. Ah...but...how will they UPLOAD the image so I can recreate their custom players. Do I really want to bother having a server that isn't dead simple?  I guess I could have them upload it on literally any image hosting site and then just give me the URL? But...what if the hosting site warps the image (like, by compressing it). Table this for now.


Who am I kidding, it's Rap Battle time.

So, basic idea outlined by recursiveSlacker is one of finding a word in both arrays.

wordsThatRhymeWithNo = [a,b,c,d]
nounsAboutPopCulture = [c,d,e,f]

so i might get c and d outta that.

Want to have points though, no how good the rap was and how sick the fires were....is "And it don't stop" still online? Get templates for raps.
nope. but can go to cannon.

Sit your ass back down 'cause we got shit to settle.
Just park ii on my grill you be whistling like a kettle
If rap's a one wheel device your foot don't reach the peddle.

Hrrm.when tavros and gamzee have one of teh worst rap offs in paradox space history, they talk about their INTERESTS. I really want to do that.

iMAGINE AN ARRAY OF BEATS THAT SET LIMITS,
AT: tHEY GOT A RULEBOOK, iT DOESN'T PAY TO SKIM IT,
AT: bECAUSE, tHERE'S NOT A LOT OF LATITUDE,
AT: tHEY WON'T STAND FOR AN ATTITUDE,
AT: aND, cROSSING THEM'S A HABIT YOU'D,
AT: (nOT REALLY WANT TO GET INTO BECAUSE, uHH),
AT: tHEY'D GET PRETTY MAD AT YOU,




switch gears right quick.  AuthorBotJunior has to be a thing.


objective: be able to filter by:

# of players in session (2-12)
claspect  (two drop downs, like oc_generator)
interests

want to also display other initial stats like interests, initial relationships.

Okay, the individual session summaries (junior) is working beautifully.  Players, Sprites, Interests and Ships.

But...filtering is going to be way harder. Don't want a list of 144 check boxes and then some, right?

So....think.

For number of players, could have a range bar like I do for how many sessions to show. Okay. Solid idea.
Will probably have to redo my "filter" code...dont' even remember how I did it, tho.

As far as interests and sprites, can filter by category?
HelpfulSprites
UnhelpfulSprites
DisastorSprites
FortuneSprites

etc.

Ships...don't even bother filtering. Like, seriously. Unless somebody asks.

Claspect will be the hard one. Maybe display a grid of checkboxes, click checkbox to show only sessions with that claspect?

BUT it's not just about filtering, right, also about displaying uberStats...


think.

Start with the basics.  I KNOW I want to do this by number of players, because that was the initial request. So. Do that. Everything else is a bonus feature that i don't need to do right now.

Okay, the stats look good, and I have the range input for number of players, but it's not wired up.

Without reviewing how I did filtering before, given that right now I ONLY want to filter based on number of players...
What's the best way.

Take the sessionSummaries, and reject any that have a players.length that doesnt' match the chosen value.

That doesn't seem hard, probably can extend javascripts' filter method.

QUESTION: why is the Bard of Heart doing bullshit sidequests when their land level is only 7. And their power fucking sucks.  Shouldn't land quests be a priority???
Goddammit. how long has this been going on? fucking slackig players.

oh. wait. false alarm. they only need a land level of SIX to be done? Who fucking decided that. Okay. did I do that so they fought their denizens more? fuck it, dial the difficulty up. way too much bullshit sidequests.



okay, new problem, why does the thief of space, who did NO frog breeding....do bullshit moon parties instead of their JOB??? why are all these players so distractable?

Huh...apparently players who have finished up their lan quest AND players who have done zero land quests can do moon parties. I know I don't let players do plot shit IMMEDIATELY after entering...how do i judge that?
power needs to be greater than 2. so is this space player just...NEVER leveling up? wth.
No...they end the game with a power of 9. Not, like...great. but not zero, either. Of course, they may have only gotten that high at the last minute.
Okay, maybe make moon bullshit and sidequest give them a tiny power boost.
Ah, no there we go. for bullshit side quests, player1 gets a small powr boost, but player 2 didnt'. fixed.

 I really need to implement that power graph I've been meaning to do.


Alright, no distractions, character creator time.
TODO: (in order)
*  Write a "load fucking everything script". See how long it actually takes/how stable it is. Don't worry about lazy loading until it looks like I need it.
*  Given a session ID/random session ID, render the players to the screen. Take inspiration from how far apart they are on the oc_generator.html.
* have a button that says "start session". when you press it, characters vanish, session starts.
* have the ability to change class/aspect (through drop downs) for each player. confirm can still start session.
* alert error if no space/time player on start. don't let it even start.



What are some things that freeWill can do versus luck?

Free Will:
	* decide to get out of/ into murder mode.  (but not grimdark. if you're grimdark you don't CARE that things won't end well)
	* god tier suicide.
	* kill a murdermode player.
	* Call off the "exile jack" plan.
	* Insist ectobiologist does his goddamend job. (raise their power to min requirement)
	*insist space player does their god damned job. . (raise their power to min requirement)

Good Luck:  (different events have different odds. can have different flavor text, too.)
	*die to trash mobs, but right next to your quest bed (only if god tier destiny)
	*trip over a treasure chest full of sweet sweet grist (boost to land level)
	* accidentally solve a group of consorts problem before you were even aware of it. (boost to land level)
	* find a rare enemy that gives you a BUNCH of exp when you kill it.
	* find out something that makes someone like you a lot more.

Bad Luck:  (different events have different odds. can have different flavor text, too.)
	* die to trash mobs.
	* get grist stolen from you by an enemy (lower land level)
	*accidentally ruin a quest line entirely (lose land level)
	* spend WAY too much time fighting an enemy, only to discover it doesn't drop any loot and you don't level up from beating it.
	* Accidentally say the wrong thing and someone likes you a lot less.



Okay, so, like random lucky/unluck events are easy. You roll a metaphorical dice, and do what it says.

But mind is all about DECISIONS, not luck.

How should I do this? I can't just freeWill lock certain events, because then you'll have a single player doing it every single damn turn.
It needs to be logical...think think think.

ignoring code, how would it actually work? how DID it work for terezi? She was aware of the consequences for NOT killing Vriska, and so choose to kill her when she otherwise wouldn't.

Problems:
	* I am not currently pre-simulating things.
	* It is extremely hard to actually know WHY a given outcome happens. That's the whole point of the YellowYard...it's hard even for humans.
	* not all players care about avoiding doom. some WANT shit to go bad, like Damara.

Now, I can still allow there to be non-luck based randomness. It could account for "this is a complex decision and I'm not going to get into details".

So, as an example...why would a player DECIDE to engage murder mode. Well, for one, they need to hate someone. That's non-negotiable. I guess they also need to not be spades with the person they want to kill.

So, unlike LuckStuff, I can't decide that I'm "lucky or unlucky" at trigger time and then later decide what that actually means. I need to be consistent.  I might be tripping free will, but not have anything I actually want to do.
So, decide what you're going to do at trigger time and store that till render time.




http://purplefrog.com/~jenny/SburbStory/index2.html?seed=47189
bug fix: 47189  trying to break up a relationship that no longer exists after a 3x combo session + yellow yard.

Initial thoughts: wth, that shouldnâ€™t happen. i am CLONING the foreign players especially SO they will show up after a yard.


at first yellow yard, 4 players. Maid of Time, Witch of Space, Witch of Void and Seer of Time. 2 players cloned on arrival. Witch of Void and  Seer of Time.
post yellow yard: 4 players. 2 aliens cloned on arrival. names all seem right.  is it doppelgangers again?

BLUUUUHHHH.




Goal: Have AB not get caught in glitchy, corrupted sessions. She never returns.  The first step was being able to catch session crashing, which I can now do (and print out bullshit about horrorterrors)

problem, session stops ticking after error. this is fine. my error handling code can grab mark a session as corrupt. how can i trigger AB to continue on with the next session?



GrimDark Refactoring TODO:
have stat that is CorruptionLevelOther. have various things raise it. (corrupted land, corrupted sprite, etc.) every 100 points, raise grimDark level tier and go back to zero.
make grimDark 4 level tier, not boolean. 0 is none.  1 = Zero out Relationships. Break game some. 2 = Break game more, small power boost. 3 = grim dark font, grim dark halo, do nothing but break game.


Add grim light corruption as well. think about what this means (do they counter each other?)










okay. let's think this through.

Problem:  AB is returning from a single session EIGHT GODDAMNED TIMES.

Context: I'm upgrading AB to be able to handle scratched sessions. I carefully locked out the various ways she can 'return' from a session to either be through scratching, or through winning, OR through losing a scratched session. At least...I think so.

Okay. turns out I need to check to see if a session was already scratched beofre auto scartching. duh.

but things are weird still. no session scratched, but two extra sessions show up.  session with combo and without are treated separate? and combo is twice. BLUH.

okay. so. what's going on there.

Current Behavior: Look for 1 sesssion. If scratched, renders 3 session summaries. 1 pre scratch, 2 post scratch. What the hell.


if(!session.scratched){
		console.log("scartch")
		session.scratchAvailable = true;
		summarizeSessionNoTimeout(session);
		scratch(); //not user input, just straight up do it.
}

i can confirm the above only gets called once. so...what is happening.  is summarizeSessionNoTimeout calling intro or anything like that?

intro
scartch
intro  *2
victory   *2

So. I am calling "intro" twice for the same session. How?

or...maybe not? not happening here:
start session  find_rare_sessions.js:245:2
intro  find_rare_sessions.js:648:2
scartch  find_rare_sessions.js:292:3
intro  find_rare_sessions.js:648:2
victory or utter defeat * 2

GLAR. Okay. So...is the same session returning multiple ways? look for mvp on print out. !!! That's IT!  MVP is DIFFERENT between the two sessions.


Fuck. What does this mean.


Okay, new tactic. Now for some reason session ID never changes even if hit button multiple times. Why? How? not a scratch.  huh. that might be a regular bug. or a preexisting one. looks like i only set new seed if there is more to do. if only doing one, don't.  is it related?

nope. scratch bug still there even after fixed. bluh.

okay. so. like. sometimes two intros are called.  and sometimes they aren't.  sometimes summary is called twice. sometimes it's not. and it doens't matter if intro was twice.
why might a summary be called BEFORE a session is done. seems to be my "victor or utter defeat" section.

curSessionGlobalVar.won || living.length == 0 || curSessionGlobalVar.scratched
oh damn, THERE it is.  maybe. hold on need to look around.
see, like, that code should only be called during aftermath, which should only be called once. that can't be the problem even though .scratched is a pretty generic thing.


sessions simulated has 3 sessions in it, all with same ID. should only be two.  Pre scratch and post scratch. ....




okay, new tactic. there are two places in the aftermath where the scratch button is rendered.  one if no frog. one if sick frog.  If sick frog, does combo check AND renders scratch button. what does that mean. do i...hide the button if it's a combo instead?
probably a distraction. i see the bug hits even when full frog.

change tactic again. the problem is multiple sessions are going at the same time. Or is it? How to confirm. print when tick?
okay, progress.  It looks like everything goes according to keikaku...but then...when the reckoning tick STARTS the session splits in two. one summarizes immediatly, the other goes into the reckoning. I know scratches can be called prereckoning. what else?

is....is doomedTimeline true? if it were, that might be weird.


oh shit oh shit oh shit. new theory. I'm seeing multiple "should be done" popups. Iv'e been ignoring them as a separate poblem, but very clearly they aren't. think.
before i click the first popup, i see two sessions in the print out.  it's only AFTER clicking it to I see the third session and IT's popup. Which session is wrong. Number 2 or Number 3?
Only one way to find out. actually physically visit the session and see what post scratch looks like.

Oh fuck. NEITHER of them are true. Okay. that's important, too. It would make sense if there were two simultaneous sessions going on they'd be stealing each others random seeds.

only see two sets of reckoning ticks. it's like the second one "finishes" before the reckoning and then starts up the second one?  mvp of second session appears to be the initial values of the session. so...it summarizes itself really early on?

made sure doom gets set right for scratched sessions.
victory or utter defeat  find_rare_sessions.js:368:5
summarizing: 135789202 doomed: false  find_rare_sessions.js:421:2
reckoning tick -11false  find_rare_sessions.js:348:2
no scratch  find_rare_sessions.js:297:3
victory or utter defeat  find_rare_sessions.js:368:5
summarizing: 135789202 doomed: false


so...it looks like it tries to...tick itself again?


...
...
Hypothesis: summarize setsTimeout without updating the session (somehow). tries to tick a mostly done session, which forwards to reckoning tick. cause no more time till reckoning.
no, it really looks like setTimeout for new session never called. but something there feels right. go tak ea walk. get a snack clear head.

Alright focus up, five minutes on the clock, only problems, no solutions.

* it APPEARS that a session is being run twice at the same time.
* three sessions are being rendered, and I only expect 2.
* i know there are multiple ways for a session to be "done". as such, my "time to render a session code" is hard to read.
* two sessions render before a popup, one renders after then genreates it's own popups
* a popup happens when a session is summarized adn there are no more sessions to summarize.
* i make sure to not count a prescratch sessions as towrds the session quota.
* neither post scratch session is "real".
* at least one post scratch session appears to be the initial conditions of the session. no confirmation though.
*a session can be done mid tick, before the reckoning or during it or in the aftermath.
* the repeated session summary claims to be rendering after the aftermath.
* a "scratched" session is the SAME session, just reinited.
* multiple parts of a ticking session can render the scratch button. i dodn't remember evern seeing more than one scratch button, though. do they replace each other???

five minutes are up.
if...if...I render teh scratch button and THEN do the aftermath...wouldn't i get the behavior i'm seeing? it's still the "first session" summarizing itself, but it appears to be the post scratch one 'cause it's already processed.

not perfect. but...i'm getting closer. i see that ticks are interupted by reckoning ticks midway through the first post scratch session. it must 'rescratch' then or something. okay. try....

intro  find_rare_sessions.js:661:2
victory or utter defeat  find_rare_sessions.js:373:5
summarizing: 20729783 doomed: false  find_rare_sessions.js:427:2
tick 28false

So, current observed behavior is intro, immediate AFTERMATH and then summary, and then I start ticking.  This is bass fucking ackwards.
I have a variable called "pleaseIgnoreThisSEssionAB" and it's doing nothing. so. it must be set to true....

progress. aftermath can call a scratch. the next thing the rRECKONING TICK does is check for combo for victory and render summary. see if this fixes it.
how to distinguish between a freshly scratched session a post scratch session. oh. my plz ignore variable.
so frustrated still seeing it.  I have wasted HOURS on this.
problem, can't have new session's pleaseIgnore be false on intro. intro somehow called BFORE i finishe processing after math.fucking asyncronous code.


about to trigger aftermath  find_rare_sessions.js:359:3
scartch  find_rare_sessions.js:292:3
no timeout summarizing: 143713195  find_rare_sessions.js:474:2
reinit  find_rare_sessions.js:311:2
intro  find_rare_sessions.js:661:2
aftermath rendered  find_rare_sessions.js:362:3
checking if i should do summaries  find_rare_sessions.js:368:3
victory or utter defeat  find_rare_sessions.js:374:5
summarizing: 143713195 please ignore: false  find_rare_sessions.js:427:2
tick 13false


k.
just triggering the aftermath is enough to cause a scratch.  even before it renders.  and intro for scratched session called before...before....Fuck.
Okay. this suddenly makes sense.

Sequence of events.  Aftermath triggered. Aftermath begins to render, midway through renders the scratch button which CAUSES a scratch which CAUSES an intro.  async bullshit. then the scratch returns, which lets the aftermath finish rendinger.

How to fix?

How to distinguish between a fresh session and a old one. number of ticks!

fucking FINALLY. AB can do one scratched session correctly. okay. lets see if she can do more than that.

yay. new problem. i think AB is scratching too early or something. maybe need to let the aftermath finish rendering. i don't know. the scratched sessions' she's finding are all wrong.



~~~~~~~~~~~~~~~~~~~~~~~BLUH~~~~~~~~~~~~~~~~~~~~~~~~~~~


Bluh. New brainstorming session. The next feature I want to work on is denizens.
I want denizens to have 'infinite' of their aspects associated stat. will that make them unbalanced? always dodging, for example. always getting a lucky break.  maybe...maybe "infinite" means "1 more than the player has." or something like that? bluh.

in addition to denizens, i want denizen minions (like the typheus minion) to be a mini boss.

if landLevel < 6, then do any of first 6 quests (completely generic). fight minion.  If landLevel < 12, then do any of second 6 quests (3 from class, 3 from aspect).  fight denizen. then, do any of third set of quests. (post denizen). these quests give you fraymotifs. can also get fraymotifs through luck events (isntead of raising power)

so......what's stopping me here? there's no real cognitive challenge. is it just inertia? deniznes won't even be that special 'till i do fraymotifs and i won't do those just yet.

Okay. Step one, make a list of "generic quests" that anybody can do.  Make sure DoLandQuest pulls from them first and not their claspect quests.

wait, no backwards. existing quests are pretty generic, make new ones that reference the denizen. glitch faq had some good examples. denizen fucked over your planet in some way, you have to fix it.


what should I do?

damn. grist might have to be a thing for ultimate alchemy.






Alright, I was in the middle of letting the ghost powers work during battles when it was brought to my attention that yellowYards aren't working as well as I thought they were.

I have confirmed that ghosts are still banned from interacting with the session until the timelines divurge...so....what is different.

First guess would be that the seeds are being eaten differently.  gonna look at the same session side by side, one yarded and one not and see what is different.
I know at first glance the yarded one has a total party wipe, so my hypoethesis has legs.

Yes. very, VERY obviously seeds are different early on. WV is doing different stuff, quests are going randomly different



"The Bard of Time initiates a strife with the Hephaestus Minion.



The fight is over. Hephaestus Minion is dead. "
Whelp. That's what I get for blaming ghosts.

Whelp. Thatâ€™s what I get for blaming all my problems on ghosts like a superstitious oldtimey dude. Looks like the problem is that after a yellow yard, the fucking BOSSES ARE SPAWNING DEAD. And OF COURSE when I tested, I apparently chose the least competent sessions in Paradox Space, so they hadnâ€™t managed to really defeat anything so their session were going pretty much the same even after a reset.








~~~~~~~~~~~~~~~~~~~!!!!!!!!!!!!!!!!!!!!!


slowest thing is swap colors.  what if i kept characters in memory and only rerendered when necessary? Or.........what if...what if I
 rendered each sprite to a dedicated hidden canvas. And then just grabbed that sprite as needed. Each player knows where their sprite lives and knows .....wait.

 wait wait

 Okay.  Base sprite is body, hair, colors, horns, fins, etc. all that shit.

 Render stuff on top of that right? blood, stabs. grim dark aura goes behind.

 So, the only time the BASE sprite changes is:

 *  When you go grim dark (skin color darkens)
 *  When you go god tier ( body changes )
 *  When you are a dream self  (body changes  )


everything else is layers and rotations and.....



.....

it might finally be time to upgrade the rendering engine.




Okay, let's fucking do this. I've long since been hiding canvases. What's 12 more canvases?

Problem: when should the first render occur. If it happens at charcter creation, won't get custom character or easter eggs.  If it happens at intro, what happens
if char is chatting with char this not yet rendered.  if happens in big stupid pile at sesion start, won't there be slow down???

that last one was a question. so. answre it.


Okay: What part of a character is DYNAMIC other than base sprite:

* grim dark aura (but we changed your skin color anyways, so throw that on)
* wings, but we changed you to god tier body anways, so throw that on.
* stabs...but you're dead....if you get revived....think about this.
* MURDER MODE SCRATCHES/SCARS!!! There we go. um.

honestly, probably easier to re-render the sprite at ANY change.  but how to know there was a change? oh wait, that's right
I render to the sprite in the scene or wherever the change happened. drawSpriteNew only called from scenes and only called TO the secret
canvas.






AB has gone a little crazy, specifically with combo sessions. :(

seed=670898551

When viewed by me, does a combo session.

but when viewed by AB, she scratches it before the combo happens, and then reports that the scratched session is a combo session.


To me, this means she needs to not scratch if it's going to keep going.


let's find otu how to make this a thing.

Alright. Let's refresh my memory on exactly how AB scratches sessions.



if it's a combo session, i don't even render the scratch button. Right?  So AB is somehow getting the option to scratch sessions that should be combo.
regular sessions only have scratches be an option AFTER process combined session.

I remember in this very text i was upgraded AB to handle scratches.  So...why did I choose to do things different.  let's review.







~~~~~~~~~OK, AB is acting up.

If there is a sick frog that is NOT a combo session, shes' not scratching.

Need to find out why.   (She is totally sulking about how I told her she can't scratch mid-combo session)

~~~~~~~~~~~~~~~~~~~~~

Huh, the light player is being revived with a mind control symbol, but isn't being mind controlled until the next turn. setting a break point on mind control reveals that they are in fact not yet rendering the revival.

Do i have a stray timeout wandering around?  I am definitely making a snapshot of the light player, should i make one before even calling renderSprite?

light player IS rendered as being mad at the breath player befoer the mind control happens, no mark.

AHAH, yes, stray timeout that ALSO explains why sometimes god tiers would "revive" dead.  that bug is fixed!



~~~~~~~~~~~~~~~~~~~~~

Okay, let's plan this out, sequence of events:

* players edited in character creator
* link generated to send into SBURB (you monster)
* index2.html loaded.
* session.makePlayers called.  makePlayer generates correct number of players, but then replaces them with players from URL.  (IF AND ONLY IFF SESSION.SESSION_ID == PARAM SEED (don't do this for combo sessions you dunkass)
	*  recalculates all things that were part of initialization.  chatHandle. Land. level names.   dont' recalculate other things, like kernel sprite (even if you're a troll now), or relationships.
	*  guardians match players that DID exist, not replayed players.
	* should handle things for yellow yards??????????????????????????????????????????????????????????????????????????????????????????????????????


Alright, let's compare this plan to reality.

scenario_controller2.js has:

curSessionGlobalVar.makePlayers();
curSessionGlobalVar.randomizeEntryOrder();
curSessionGlobalVar.makeGuardians(); //after entry order established

So, if I implemented my change in MakePlayers, then the entry order would get randomized from the char creator. And the guardians would resemble the created characters (do I want that?)

But if I make it by a fourth call, run the risk of forgetting to call it sometimes.  Could have a session far be all "init" and it calls all four?

What does a yellowyard or otherwise reinitialized session look like, just in the controller?

function reinit(){
	available_classes = classes.slice(0);
	available_aspects = nonrequired_aspects.slice(0); //required_aspects
	available_aspects = available_aspects.concat(required_aspects.slice(0));

	curSessionGlobalVar.reinit();
}


function restartSession(){
	$("#story").html('<canvas id="loading" width="1000" height="354"> ');
	window.scrollTo(0, 0);
	initializeStatsForPlayers(curSessionGlobalVar.players);
	intro();
}


function processCombinedSession(){
	var tmpcurSessionGlobalVar = curSessionGlobalVar.initializeCombinedSession();
	if(tmpcurSessionGlobalVar){
		curSessionGlobalVar = tmpcurSessionGlobalVar
		$("#story").append("<br><Br> But things aren't over, yet. The survivors manage to contact the players in the universe they created. Their sick frog may have screwed them over, but the connection it provides to their child universe will equally prove to be their salvation. Time has no meaning between universes, and they are given ample time to plan an escape from their own Game Over. They will travel to the new universe, and register as players there for session <a href = 'index2.html?seed=" + curSessionGlobalVar.session_id + "'>"+curSessionGlobalVar.session_id +"</a>. ");
		checkSGRUB();
		load(curSessionGlobalVar.players); //in loading.js
	}else{
		//scratch fuckers.
		curSessionGlobalVar.makeCombinedSession = false;  //can't make a combo session, so scratch
		renderScratchButton(curSessionGlobalVar);
	}

}

and yellowYard specifically is:
curSessionGlobalVar.addEventToUndoAndReset(null);
and  restartSession (in controller)


Okay. So, it looks like initiazeStatsForPlayers is called on the existing players. But the players themselves aren't remade. So, might not even have to worry about YellowYard?

EMERGENCY:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~found the source of yellow yard shenanigans.  PLAYERS are being reinitialized, but their sprites are NOT!!!!!!!!!!!
	this is a good opporunity to have a method to reinit all things, including land and levels so that created players can be called with this.
	method should have programtic shit, not random shit. don't re-roll hair, do recalc land.

Okay. things seem to be working. had to stop testing cause stuff. need to reorganize my thoughts.

I honestly think new char creator is working. Just need to test yellow yard. test by changing player hair colors (trolls are an obvious target). should cause the sim to have 0 changes, but be obvious that it's a custom character.




  ~~~~~~~~~~~~~~~~~

  Okay, I finally want to finish AB's corpse party mode. I just made it so she prints out class and aspects like so:

  Witch: 2(17%)
Thief: 1(8%)
Maid: 2(17%)
Seer: 1(8%)
Bard: 1(8%)
Prince: 1(8%)
Rogue: 1(8%)
Knight: 1(8%)
Sylph: 1(8%)
Heir: 1(8%)
Rage: 2(17%)
Breath: 1(8%)
Light: 2(17%)
Blood: 1(8%)
Doom: 1(8%)
Life: 1(8%)
Space: 1(8%)
Void: 1(8%)
Time: 1(8%)
Heart: 1(8%)


My goal is for there to be checkboxes by each of these. Clicking on a check box will filter the AFTERLIFE ONLY to display only those deaths of players that fit the check boxes.

There is a challenge inherit here: existing filters assume you want ALL session data, and are just filtering out whole sessions.

First question: Does a multiSessionSummary know about ALL ghosts within it, or is it just a number?

Sure it does: for(var i = 0; i<this.ghosts.length; i++){

Okay, so. Rather than have a global function like the other filter methods, it would make sense to call a method inside the specific MSS that generated the html.

have generateHTML take in a ghost array rather than use the class one.  when called normally, iti's passed the class ghost array.
when you filter, it grabs all check boxes (How does it know what "all" means?).  If your class/aspect matches a check box you are in (even if it doesn't match another check box.)
ghosts that pass teh filter are passed to generate HTML.

EXCEPT: It would erase classes/aspects that aren't part of the filter, you woldn't be able to add them to the filter. So, classes/aspects keys needs to be hardcoded.




~~~~~~~~~

Okay. I've done a bunch of little shit here and there, but I need to work on AB again.

Feature Goal: MultiSessionSummary lists  out classes and aspects.  Clicking on a check box next to a class or aspect filters the session .......

Wait.

Fuck.

No.

That is too specific. Back that truck up.

Feature Goal:  Be able to determine if certain aspects, classes, or classpects are over or under powered. Be better able to balance SBURBSim.

Forseen Problem:  With the corpse party class/aspect update, Clicking on "Heir" and "Mind" gets me all Heir OR Mind players, which is not want I want. But if I make it be
AND instead of OR, that has additional problems.  For example, clicking on "Mind" and "Time" would get me no players, as it is a logical impossibility.

Before I can move forward on the AB ugprade, I should fix this problem in the corspe party and let it be the basis for the other mode.

So.

Sequence of events:

Click on "Heir".  All "Heir" ghost stats shown.

Click on "Mage".  All "Heir" OR "Mage" ghost stats shown.

Click on "Time".  All Heir AND Time or Mage AND Time ghost stats are shown.

Click on "Space".  All Heir of Time OR Space AND Mage of Time OR Space stats are shown.


That reveals a path forwards. It's two levels.   Within just class or just aspect, it's OR but when both it's AND.

 Don't panic about how lost you are. Find a way to move forwrds and do it. So. What does the code look like right now?

 if($("#"+ghost.class_name).is(":checked") || $("#"+ghost.aspect).is(":checked")){
   filteredGhosts.push(ghost)
 }


 Okay. That makes sense, it's an "OR" just like I thought.


 So. that sequence of events was complicated. What would it look like to get to level 3?

 Well....first of all, I am only checking if the ghosts class_name or aspect is checked. I'm not looking at other classes/aspects.

 So, my "sequence of events" is user facing, not code facing. Redo sequence from the code's perspective.

 Sequence of Events:

 looping through array, I find "Heir of Time."

 Is heir clicked?  Yes. Is Time clicked? Yes.

 Fuck. If I restrict myself to ONLY checking boxes for one ghost at a time, I dont' know that there's an AND.

 Think.

 Okay, open things up a bit.

 I'm pretty sure jQuery can give me an ARRAY of selected. Let's pretend I get that.


2 classes selected.
2 aspects selected.

for each ghost:
  check if ghost class is ANY selected class.
  if so, check if ghost class is ANY selected aspect.

  isnt that...the same code, tho.

ok. new approach.  check ab.

220 ghosts.
Click "Heir", get 16.
Click "Time", get 56.

Want ghosts to be equal to or LESS than 16. Want ONLY heirs of time. Not ALL heirs and ALL time.




If NO aspect is selected....then only class.
if NO class is selected, then only aspect.
If both, AND?



2 classes selected.
0 aspects selected.

for each ghost:
  ghost.class.isSelected?

2 classes selected
1 aspect selected

for each ghost:
    ghost.class.isSelected? AND ghost.aspect.isSelected?


I think...that might be it. I need to know how many of a set of classes or aspects is selected (0 or more than 0).

so, is the html already set up so jquery can get what i need??? No. find where i set names.


if(classFiltered && !aspectFiltered){
  if($("#"+ghost.class_name).is(":checked")){
    filteredGhosts.push(ghost)
  }
}else if(aspectFiltered && !classFiltered){
  if($("#"+ghost.aspect).is(":checked")){
    filteredGhosts.push(ghost)
  }
}else if(aspectFiltered && classFiltered){
  if($("#"+ghost.class_name).is(":checked") && $("#"+ghost.aspect).is(":checked")){
    filteredGhosts.push(ghost)
  }
}else{//nothing filtered.
  filteredGhosts.push(ghost)
}


okay, now just need to actually set classFiltered and aspectFiltered.


Done, and it's fucking working beautifully. I am a GENIUS!!!!

But...am a genius who should probably sleep now and finish upgrading AB in the morning.






~~~~~~~~~~~
Okay, major barrier compared to corpse party mode and regular mode is that the classpect filters have to ALSO be compatible with the regular filters.

Can choose to see all sessions with a Knight of Time and also MurderModes.

Regular properties call a generic "filter" method kept in the rare session finder itself.  So. Claspect filters should do this as well.

Okay. So, classes and aspects aren't wired up seprearte any more, just a simple onChange.


so. next step would be to review how existing filters work and see how to add the new functionality.
don't panic just cause i can't remember how it works. And don't come up with fascinating sounding ways to procrastinate, like fuck around on tumblr or discord.

Okay.


function filterSessionSummaries(){
	var tmp = []
	var filters = [];
	sessionSummariesDisplayed = [] //can filter already filtered arrays.
	for(var i = 0; i<allSessionsSummaries.length; i++){
			sessionSummariesDisplayed.push(allSessionsSummaries[i]);
	}

	$("input[name='filter']:checked").each(function(){
		filters.push($(this).val());
	});
		for(var i = 0; i<sessionSummariesDisplayed.length; i++){
			var ss = sessionSummariesDisplayed[i];
			if(ss.satifies_filter_array(filters)){
				tmp.push(ss);
			}

	}

	////console.log(tmp);
	sessionSummariesDisplayed = tmp;
	printSummaries();
	printStats(filters);
}



So, use my words.
First, I make sure to only grab the summaries that are ALREADY displayed. already match existing filters.

this step might be useless, because I'm still probably gonna look at all filters anyway, not only the one most recent one. But it probably doesn't hurt anything, either.

Okay. What happens next? I look at each checked filter (fucking told you) and.

Wait.

Back that truck up.

Next I Look at each checked box with a name of "filter". This ONLY includes traditional filter shit, not the complicated classpect stuff.
I have a method called "satisifies filter array".  I remember thoth helped me work the logic out on that one 'cause it kept kicking my ass.

Now, before I look into "satisfies_filter_arary".....what happens next?

I call printSTats on FILTERS, but tmp.  "satisfies_filter_array" is called for tmp, not filters.

Why am I passing filters to print stats?   sessionSummariesDisplayed is a global it looks like, is printStats using it???  Why bother passing filters?

var mms = collateMultipleSessionSummaries(sessionSummariesDisplayed);

Okay. yes, it's using the global variable like an idiot, but whatever. it works.  but what about filters? Is that useless code dragged forward by my own laziness?

AH!  Filters is used to decide which boxes should be checked when the session stats are rerendered. Good job pastJR, for not being a complete fucking idiot.


Okay. so. make a note there to also do class/aspect

So.

Backing up, I decide whether or not to add a particular session to the stats by calling satisfies_filter_array.

Would this be a good place to have my new class/aspect algorithm I use for corpse party? Pretty sure that happens on a single session basis?
No, it doesn't. corpse party is just it's own thing. like an asshole.

Okay.


Well, look into satisfies_filter_array.

Options:
* Modify satifies_filter_array
* make new method that is called after satisfies_filter_array
* process classes/aspects in printStats directly. (probably dumb)


I think that the cleanest implementation would be to NOT fuck with satisfies_filter_array, and instead a new method.

Maybe it takes the filtered sessions and then REMOVES any that don't fit the class/aspect filter.

So:

Here's all sessions with a god tier in it.  Return only those with a Knight of Time.

Remember, same alg as corpseParty in that it's one, or the other or BOTH.




	this.matchesClasspect = function(classes, aspects){
		if(aspects.length > 0 && classes.length == 0){
        //???
		}else if(classes.length > 0 && aspects.length == 0){
      //???
		}else if(aspects.length > 0 && clases.length >0){
      //???
		}else{
			return true; //no filters, all are accepted.
		}

	}


  need to fill out that stub, but first wire it up.



  nice. i think I've leveld up at jquery, cause the way i was getting filters before was baby shit comapred to how i figured out how to do it for the fraymotif test page.


  wait. no false alarm, it's the same.





  *GASP*
  There is a problem.  Why is time and space sometimes showing up in MORE THAN 100% of all sessions? Is it a rounding error???


  sessionSummary.js:700:48
Total is: 63and Time is 68  sessionSummary.js:700:48
Total is: 63and Space is 66  sessionSummary.js:700:48

So. Despite there being only 63 session, I think there is 68 sessions with time players in them.

What the fuck.

....oh. it's combo sessions. well. shit. that's not a bug, then.


Fuck.

Shit.

FUCKING HELL.

Okay.

Don't panic.

But it turns out you designed everything terribly because you suck.

You suck so much.

Fuck.

Define the problem.

Despite my best efforts, clicking "Bard" and "Time" does NOT show only those sessions that contain a Bard of Time.

This appears to be because SessionSummaries keep track of class and aspect separately, in hashes.

So,  a Session with a Rogue of Time and a Bard of Light look the same as a session with a Rogue of Light and a Bard of time.

Just because I am displaying the classes/aspects separately doesn't mean that the data needs to be kept that way.

Fuck. Just look at the corpse party, that was using actual ghosts rather than disembodied ghost stats.


Okay. Time for a break.

When you come back, expect to:

* Refactor session summaries to store mini player objects {class: "Heir", aspect: "Time"}, not {"Heir": 0}.
* Refactor MSS to take this into account.  MSS should still have classes and aspects divoruced.
* Refactor SS matchesClaspect to take this into account.


Break obtained.

pffft....okay. One thing at a time.

Store mini player objects, NOT a count of "number of heirs in a session" (which was that source of 120% time player bs earlier, anyways)

huh. mss will have to be refactored too.  Not leave class and aspect divourced. Or...fuck.

Think about this.

FILTERING happens on an individual session level.  All the MultiSessionSummary cares about is printing out stats. It can have separate class and aspect arrays, sure, no problem.

But....how will it count?

Oh sweet, i was smart enough to make them seperate methods, integrateAspects and integrateClasses. pastJR from a few hours ago did a good job.
Fucking nice, that was painless as shit.

Now i just gotta wire up filtering to work with the new system.
I LITERALLY just coded it and yet have to review the code anyways because fuck using meat to remember shit, amirite?

Alright, so, the actual "click the chekc box and a thing happens" is still wired up, 'cauase rendering the html didnt' change any. That just means that
a single session return "true" or "false" as to whether it has the class/aspect/classpect in question needs to be updated.
And then it might work.

Which would mean, what, less than an hour of extra work 'cause of  my mistake. thats not bad. I might still meet my bullshit self-imposed deadline of "tonight" to finish up AB.

Man, I REALLY have leveled up at coding btw. Like. My old shit is monolithic functions that are hard as FUCK to modify and read, but I've leaned towards
little single purpose functions that turn out to be WAY easier to mod. SBURBSim is the gift that keeps on giving.

;alskdfj

Oh. My. Fucking. God.

How is this STILL Happening??? AB is STILL giving me knights OR Blood players when I ask for Knights of Blood.

Is it the algorithm?  Fuck.  Yes. I am doing:

else if(aspects.length > 0 && classes.length >0){
  console.log("returning and")
  return this.matchesClass(classes) && this.matchesAspect(aspects);
}

which still treats them as separate.

That's an easy fix though, and the code being so modular makes it obvious to see that.  pastJR from a few hours ago is WAY better at pastJR from a few months ago.
It took me, like two days to work though pastJR of a few months ago code, and only a few hours to do pastJR from a few hours ago. Although, yes, obstensibly
I should have clearer memories of the more recent code, but this is clearly not the case. This shit is a safari of discovery.

Holy fuck, it looks like it might be working. Now to have AB run through a bunch of sessions to confirim (which is where i found this bug last time)
http://www.threepanelsoul.com/comic/on-infinite-loops  <-- true facts


:/  Can't tell if bug. But....  Having "Heir, Maid" and "Blood" isn't working like I would think it would.
Observation:

Total: 138 Sessions, No filtered
83 sessions with an Heir.  check
115 with an Heir OR a Maid.  check.
3 sessions with an Heir Blood OR a Maid of Blood

7 Sessions with Heir of Blood.
3 Sessions with Maid of Blood.


So.

It looks like things aren't right.  It's not an OR for multiple classes.

Okay.

Well, theoretically I didn't look too hard at the corpse party classpect algorithm once I realized it applied to a MSS and not a SS.

Before I spend time reviewing it, confirm corpse party works how I think.

"Heir,Maid", "Blood" should be bigger than EITHER "Heir", "Blood" or "Maid", "Blood"

Confirmed that corpse party does what I think it should.

Man, I really hope other people's instincts match mine. It would suck to do all this work and other people are all "it doesn't do what i think it should"

Okay.

Review CorpseParty algorithm while trying to acount for the fact that it's acting on a MSS.


In words: what is going on. don't panic that it initially looks like what you are already doing:

have a bool for filtering by any classes.
have a bool for filtering by any aspects.

Loop on all ghosts.
if filtering by only classes, check to see if the checkbox corresponding to the ghosts's class is checked.
if filtering by only aspects, check to see if the checkbox coresponding to the ghosts' aspect is checked.
if filtering by both class and aspect, check to see if checkbox corresponding to BOTH class AND aspect of ghost is checked.


So. Right away I see that my current code can be improved. rather than looping on classes/aspects, can only loop on ghost and check for
existance of class/aspect in array. way more efficient, probably.

But...does it change the algorithm? Think.

Heir of Blood: classes = [Maid, Heir], aspects = "Blood"

CorpseParty algorithm says:

is "Heir" in class array && is "Blood" in aspect array.  YES.

Current Regular Claspect algorithm says:
is "Heir of Blood" Maid and Blood? NO.
is "Heir of Blood" Heir and Blood? YES.

should....be same thing.

Think.  But don't think too long, other way is improvement anyways and if it is somehow "right', then bonus. Can implement the code without knowing how the two are different.

God damn it.

fucking typos.

inner loop was getting aspects[i], not aspects[j].  So, what it was REALLY doing was:

is "Heir of Blood" Maid and Blood? NO.
Is "Heir of Blood" Maid and ...oh, I don't have a second aspect. Done.

fucking hell.

Okay. well. confirm this hypothesis. If it's really the problem, then no reason to refactor code to be slightly more efficient. probably. though bug wouldn't be here if i were smart.
fuck it, no, refactor. futureJR will thank you.

There, way better. single line instead of confusing nested for loop.
if(classes.indexOf(miniPlayer.class_name) != -1 && aspects.indexOf(miniPlayer.aspect) != -1) return true;

~~~~~~~~~~~~~

Okay, it's been awhile since the sim proper has been updated with more than just a tweak. Been doing AB and char creator all weekend.

One thing that effects the sim in a huge way is adding Quardrant dialogue. Especially if it costs a turn to do romantic bullshit like that.

Don't want to have fully hardcoded dialogue like with the intros, though. Nor do I want to redo the entire dialogue engine.
So. I know what I need to do. Bust out the ElderScrolls style "call and response" pairs randomly smooshed together.

Pairs can be about: interest both player have in common, the quadrant they are in, the value of their relationship (like, literal value, to foreshadow if they are close to breaking up).
maybe other stuff too, like jack or a dead player.

You know, it's been awhile since I made a new scene entirely. Not since Luck/FreeWill i think.  It's nostalgic. All full of hope and promise 'cause I haven't actually made it, yet.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Okay. Letâ€™s try to roll our own url solution.


If I did not have any dynamic strings, I could shove all my binary variables into a single variable.


{aspect: this.aspect, class_name: this.class_name,hair: this.hair, causeOfDrain: this.causeOfDrain, doomed: this.doomed, influenceSymbol: this.influenceSymbol, ghost: this.ghost, godTier: this.godTier, victimBlood: this.victimBlood, hairColor: this.hairColor, isTroll: this.isTroll, bloodColor: this.bloodColor, leftHorn: this.leftHorn, rightHorn: this.rightHorn, quirk: this.quirk, isDreamSelf:this.isDreamSelf, murderMode:this.murderMode, leftMurderMode:this.leftMurderMode,grimDark:this.grimDark, causeOfDeath: this.causeOfDeath };



Binary:  doomed, isTroll, isDreamSelf, murderMode, leftMurderMode
Int:  leftHorn (0-46), rightHorn(0-46), hair (0-60) ,grimDark (0-4), favoriteNumber(0-12)

String:  causeOfDrain, influenceSymbol, causeOfDeath

String, but can make int:  Class(0-12), Aspect(0-12), victimBlood(3 bytes), hairColor(3 bytes), bloodColor(3 bytes)

 Object:  quirk  (only fav number for now, can bring up and make int)

Proposal: params (for ghost) look like: i=1932873124987&s=â€nWSZzne4F3RMBBnpMCcX3DcmHEfQwkIAB9Et3BoGIIEIAA6Rxwj0BDdzWO0tkPQhURwZkwDdBg2SuAjuSOP16VSsiHzgSjxWo18QXERilQiFâ€

Where i stores ints and binaries in defined way (i.e. 1 bit for binary, 4 bits for class and 4 for aspect, etc), and s stores the lz compressed comma separated strings.

 Foreseen Difficulty: That is all well and good for ONE player, but how to do arbitrary amount?


Can just concatenate?  Ex: First 52 bits are p1, next 52 bits are p2, next 52 are p3, etc. How to do for strings? Well, they are comma separated, so first 3 strings are p1, second 3 strings are p2, etc.
 Alright.

Need to have a method where I pass it a list of players and a list of attributes and it turns it into  i = numbers&s=encoding.  This way can reuse for ghosts or players or pretty much anything.

No. How would you decode that? Dumb.

Instead, always encode â€œas playerâ€. Yes, afterlife needs LESS variables than char creator, but less likely to be shared.

 So.  Fuck pastJR, and go grab the attributes Iâ€™m using for players, not ghosts before I make my encoding.
But also include ghost attributes, like murderMode and dreamSelf.


var json = {aspect: this.aspect, class_name: this.class_name, quirk: this.quirk, hair: this.hair,  hairColor: this.hairColor, isTroll: this.isTroll, bloodColor: this.bloodColor, leftHorn: this.leftHorn, rightHorn: this.rightHorn, interest1Category: this.interest1Category, interest2Category: this.interest2Category, interest1: this.interest1, interest2: this.interest2  };



Binary:  doomed, isTroll, isDreamSelf, godTier, murderMode, leftMurderMode

 Int:  leftHorn (0-46), rightHorn(0-46), hair (0-60) ,grimDark (0-4), favoriteNumber(0-12)

 String:  causeOfDrain, influenceSymbol, causeOfDeath,interest1, interest2

 String, but can make int:  Class(0-12), Aspect(0-12), victimBlood(3 bytes), hairColor(3 bytes), bloodColor(3 bytes), interest1Category(0-13), interest2Category (0-13)


I format:

Doomed, isTroll, isDreamSelf, murderMode, leftMurderMode, leftHorn, rightHorn, hair, grimDark, favoriteNumber, class, aspect, victimBlood, hairColor, bloodColor, interest1Category, interest2Category

12 bits, 1 bit, 1 bit, 1 bit, 1 bit, 1 bit, 1 bit, 6 bits, 6 bits, 6 bits, 3 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits


So, total of: 67 bits. 9 bytes?  Yes. Do I want zero padding on left or right?  left, I guess.

 Example player:


Doomed: false, isTroll:false, , isDreamSelf:true, godTier: false, murderMode true, leftMurderMode false , leftHorn 13, rightHorn 13, hair 47, grimDark 2, favoriteNumber 3, class 4, aspect 2, victimBlood,2 , hairColor 0 , bloodColor 12, interest1Category 14, interest2Category 12



0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000



000000000000000000000000    001010  001101  001101 0011111 010  0011 0100 0010   0010   1100 1110 1100



00000000000000000000000000101000110100110100111110100011010000100010110011101100

Or

11491338063326444 (base 10)

Or



28D34FA3422CEC (base 16)



275 characters down to 14. That is impressive as shit.
80% reduction in size for integers.  If keep these savings across the whole url (strings donâ€™t compress much, tho), I can expect a url to be ~650 characters long, which is way better.



Of course, that IS with black hair, which is basically free to compress since I shoved it at the front.



Okay.



Now the question is, how good is javaScript at byte sequence generation? I know it can do the << and what not operators, is that good enough? How do I want to code this?


2 bytes: hairColor, favoriteNumber

1 byte: class/asspect

1 byte victimBlood, bloodColor

1 byte interest1Category, interest2Category

1 byte grimDark,isTroll, isDreamSelf, isGodTier, murderMode, leftMurderMode

1 byte  leftHorn

1 byte  rightHorn

1 byte hair

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!WARNING TO FUTUREJR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
the below stuff probably won't work on older browsers. for older browsers, use old url generation????
//https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays
var buffer = new ArrayBuffer(9 * num_players);

var uint8View = new Uint8Array(buffer);

Wait, but I'm pretty sure my compression library uses ArrayBuffers or SOMETHING...does IT work in older browsers or IE?  Yes it does, and has UInt8s. double nice.




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
So tired.....But it's finally time to figure out interests for the replay sessions. At least before I try compressing the url.
Overarching goal:  Pick Interest1 category out of a list of the 14 interersts. Pick actual interest out of second drop down menu that is list of all InterestCategory interests. Same with second interest (4 drop downs total).

Example:

Pick "Comedy" out of interest categories......

Wait.

Better idea.

TWO DROP DOWNS ONLY. And TWO text boxes.  And TWO buttons.

Drop down 1 = InterestCategories
Drop down 2 = interests within that category.
Button1 = set value textBox1 to be value of dropDown2  (Set hidden interestCategory1 to be value of drop down 1)
Button2 = set value textBox2 to be value of dropDown2.   (Set hidden interestCategory2 to be value of drop down 1)
And Text boxes can be edited.

That way can use default values AND allow customization.

Wait. Problem.


If interestCategory1 and 2 are only set implicitly, what happens if player writes in "rap" for interest category 2.  no button press.

No, need two interest category boxes. and two drop down interests bluh. no buttons though.

~~~~~
Okay, the UI problem is solved, now I just have to USE these values.

my objToPlayer code SEEMS to be doing find with whatever I pass it. but the interests still aren't being set.

> Investigate

Two possible sources of lack of custom interests:

objToPlayer isn't getting them
and
they are being overridden by some derived bullshit.

Test: ask objToPlayer what attributes it's handling. Yeah, it's getting it.

Maybe it's not being overridden. This gives me A player, but pretty sure I copy it's attributes over to a different player?

~~~~~~~~~~~
And now to debug my byte generation code. i still feel l337 as shit.  i am leveling the HELL UP.  At the end of this I'll probably be up 3 rungs.

Okay, I am expecting:
1101000010000010000
But only getting:   0000010000

why am I missing ....
huh.

oh.
well.
fuck.
that's obvious now. i must be confusing left shifting and right shifting again.

Okay, I have a 12 bit number. I want only the left most 8 bits.

1111 1111 0000 0000

What I WAS doing is num >> 4. And then being made when it gives me only the ...huh.

Alright, time to review right and left shifting:

My brain says:

Right shifting  1111 1111 0000 0000 by 4 should give me, 1111 1111 0000.   and left shifing by 4 should give me 1111 1111 0000 0000 0000.
What does internet say. It agrees.

So. Stop, think about this.

my unint8 value is CORRECTLY only showing 0000010000, which is to say 8 bits.  Expecting  "1101000010000010000" is a dumb fuck thing to do because that is more than 8 bits. (but the non uint8 print statement is correct for saying that.)

What is the hair color really look like, with no bit shifting.

11010000100000100001010

Okay, how many bits is that? ....23. What the hell? Why? I expected only 12 bits.

Okay. Think about this. WHY did I think it should be 12 bits?  Because...fuck you pastJR.  Because I know that rgb is 3 bytes long and for some reason my brain thought a byte was 4 bits again like a dumb asshole.
BLUH!!! Why are bytes 8 bits if they are grouped in sets of 4!??? And why can't my brain remember this basic fucking fact!???

Okay. So, hair color is 3 bytes WHICH IS 8 * 3 WHICH IS 24 BITS!.  don't shift by 4.

Have 24 bytes, need it to be destributed amont 3 bytes. that's easy baby shit, but it does mean that favorite color has to live somewhere else.  luckily i had exactly 4 bits free in one of the boolean bytes.

huh, apparently "+" has a higher order of operation than "<<". explains my missing data.

Okay, how about decoding the 4+4 bytes (like class + aspect)

1010 1111

>> 4 gets me class (1010).

& 15 gets me aspect (1111)


~~~~
Starting to parse urls and getting random bullshit.
Thinks byte array is 10 bytes long, when it should be 12 x 11.
Oh, i bet it's cuz i used decodeURI instead of decodeURI component.
huh. nope. damn.

What is going on?

b is: Â¿Ã°Ã·sÃ¸Â™U and raw is: %C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12and nonraw is: Â¿Ã°Ã·sÃ¸Â™U

okay, so the problem is it's getting caught on a pound sign, just stop having raw care about that shit.

Still getting caught on something, now thinks is 53 bytes.

%C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12#%C2%AE%C3%99%C3%86%C2%8B%C3%B0%16%10B%25%25-%C2%99=%C3%8Bh%C3%BF3%00Z%19%19%25%C2%BE%C3%A9%C3%A7P%C3%B2%C3%8D%10W%1E%16%09%C3%AE%C3%AE%C3%AE%C2%B2%C3%B8%7D%10X%0A&:%C2%96%C2%97%C3%91%C2%91%C3%B0%19%10%5C(%18%1C%C2%80%C2%80%C3%BF6%C3%BF%C2%B0%00W%15%15&%00%C3%BF%00%15%C3%BF%C3%96%00X%06%06%05%C2%80%C3%BF%C3%BFI%C3%B9%C2%B8%10C%08%08%25%C3%BF%00%00*%C3%BF%16%00Z..%01%C3%BF%C2%80%C2%80%C2%A4%C3%BF%C2%92%10J%20%17%20%C2%80%C2%80%00%07%C3%BF%C3%92%00W%16%16%0F&s=,,Movies,Action%20Movies,,,,Ballet,Leadership,,,,Script%20Writing,Character%20Creation,,,,Fate,Knowledge,,,,Vampires,Archaeology,,,,Musicals,Heroes,,,,Animal%20Training,Stand-up%20Comedy,,,,Geography,Justice,,,,Role%20Playing,Sewing,,,,Mixtapes,Mysteries,,,,Movies,Drawing,,,,Astronomy,Drawing,,

vs
%C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12#%C2%AE%C3%99%C3%86%C2%8B%C3%B0%16%10B%25%25-%C2%99=%C3%8Bh%C3%BF3%00Z%19%19%25%C2%BE%C3%A9%C3%A7P%C3%B2%C3%8D%10W%1E%16%09%C3%AE%C3%AE%C3%AE%C2%B2%C3%B8%7D%10X%0A

oh. and sign.

okay. now i'm getting all 132 bytes. and MOST of the players are parsing right. but hair is NaN and interests are undefined (probably other things too). What is going on?
given that i already tested charToPlayer, i suspect i'm not passing the right char string.

Okay, the plain text strings should be the easy part, but they are fucking up.

s=,,Movies,Action%20Movies,,,,Ballet,Leadership,,,,Script%20Writing,Character%20Creation,,,,Fate,Knowledge,,,,Vampires,Archaeology,,,,Musicals,Heroes,,,,Animal%20Training,Stand-up%20Comedy,,,,Geography,Justice,,,,Role%20Playing,Sewing,,,,Mixtapes,Mysteries,,,,Movies,Drawing,,,,Astronomy,Drawing,,

p1 = ,,Movies,Action%20Movies,
p2 = ,,,Ballet,

huh, yeah, that's not adding up to 5 for a thing, getting extra commas somewhere.

~~~~
hair color is being ornery. has 6 digits correctly for #000000, but generates: #6780000 instead of #678000, one extra zero. Why?

Huh.

is...that number even a valid hex, am i parsing something wrong?

That's...more than 3 bytes. Why?  Hair color should be exactly 3 bytes big. am i bit shifting wrong?

ah yes, i forgot about order of operations again. gotta put bitshifting in parens before adding

oh shit, it's rendering! There's all humans instead of having some trolls in there, but holy shit!!!

once i figure out the troll thing, can test subtler shit to see if it renders EXACTLY as the base unreplayed session does if all i do is alter hair color.

damn it looks like NONE of the bools are getting sent across. gotta figure out why. always parsing out as zero.

bluh and now interest is undefined???????????????????????????????????????????????????????????????????????????
 i should take a break : ( : ( :(



 ~~~~~~~~~~~~~
 sometimes custom players are spawning dead. infiniteEdge is helping me debug since it's their poor alt character suffering.



 dead:

b=D'%04*%C3%BE%C3%86%00g%01%01%1E&s=,,Programming,Science Fiction,

alive:

b=D'%04*%C3%BE%C3%86%00G%01%01%1E&s=,,Programming,Science Fiction,

from him:

b=D'%04*%C3%BE%C3%86%00(%01%01%1E&s=,,Programming,Science Fiction,

b=%C3%BF%C3%BF%C3%BF*%C3%BE%C2%AD%00(%20%20%1E&s=,,Automation,History,

dead is â€˜gâ€™   103

alive is â€˜Gâ€™  71



from him is â€˜(â€˜ 40

all 3 differ only on character 7.



What is difference.



Creation: 	 uint8View[7] = (json.robot << 7) + (json.moon << 6) + (json.dead << 5) + (json.godDestiny <<4) + (json.favoriteNumber)


favorite number is 4 bits.

automation? have code that generates all 255 possible values for the 8 bits, and tells me if it ever isnâ€™t the same going as coming.





CONFIRMATION.  Doing "Mage of Hope, hair type 30, species human, moon prospit, blood colour #ff0000, favourite number 8, godDestiny ticked in check boxesâ€
with "interests, which were programming and science fictionâ€ results in a url being generated that contains a dead player.

So. what is the important part in all that. what is killing it.

Also, maybe unlrelated, but check boxes arent being loaded right.




Shit. If your favorite number is 8, you die. 0 and 9 turn you to robots.

9 is: 1001 robot
8 is: 1000  dead
7 is: 0111  alive
6 is: 0110 dead
5 is: 0101 dead
4 is: 0100 dead
3 is: 0011 dead
2 is: 0010 dead
1 is: 0001 dead
0 is: 0000 robot


Shit.

Wait.

No wonder I'm not seeing a consistent pattern. DIFFERENT THINGS HAPPEN TO DIFFERENT PLAYERS.

Next player down in list turns into a robot if their favorite number is 8. not dead.

So....is the problem changing favorite number? not the raw value?

~~~~~~~~~~~~~~~~~~~~

Alright. I need to focus. I'm so busy with the Discord I'm not coding right now. I KNOW I can finish teh fan viewer (if not the fan sessions) today.

So.  I need to do:

* pagination
* text areas next to chars.

2nd is much easier than first. so. start it so you get an easy win which builds momentum. make sure display != none. make sure display: inline-block

okay, now for paginations.

i've done pagination before, but how do i want to do it here. 12 players at a time? yes, that's a nice number.
But, is there really a POINT to hiding the previous players? no rendering cost for showing them. and it's not as if i can keep everything on "one screen", as it were.
So, instead of pagination, it really should be "render the next 12 players."

Only want one helper.

No input.


So...

make a renderNext12Players()
function, and keep track of current player index.

~~~~~~~~~~~~~~~~~~~~~~~~
Okay, I am vague on HOW i want to do urls to put fan ocs into sessions. Think about the PROBLEM (not solutions) for 5 minutes on the clock:

PROBLEM:

What do I hope to achieve...

I want there to be an easy way for people to say "this group of people i am looking at? throw them into a death game.".
I ALSO want it to be easy for the Authorbot to do so as well. Both for tourneys and to use those OCs as a way to test the data string mechanism in general, at least for crashes.

The system MUSt be easy to use, and easy to modify (can pick a session with reddit+canon ocdatastrings init, for example.).

I'd want the system to use the existin architecture of 'load ocs from a text file' because i find that system to be VERY easy to add ocs to, nlike the hall of fame with [???].
I theoretically could do that OC thing forever, or even automate the process with a small server somewhere.
One useful part of those datastrings is that the user editable strings are kept in plain txt, I can easily see if somebody put something in approrpirate or full of attempts to break the sim before doing anything.
So, before i focus back up, automation IS a perfectly valid thing to pursue in the future.  Just have the system put the strings in tmp files that I have to review with my organic brain before adding to the server.

Okay
Not focus up.

So, a 'good' solution is easy to use, modifiable and uses the existing architecture. Anything else? Don't think about solutions, think about requirements...

maybe additional ways to modify...like "allow repeats" or session size between 0 and 12? I consider those less important.

Okay. Times up.

NOW that the problem space is well defined, 5 minutes of thinking of solutions.

Solution:

Okay, most obvious solution is to have the character_viewer generate data_string urls just like the SessionReplayer does. It would pick which players go into it, and NO other page would need to know about the saved text.

Pros:  Don't need to modify other pages at all.
Cons: How would I do a tournament arc/give AB random sessions based on these?

That's a PRETTY big con. And the pro is about avoiding work/possible sources of bugs, which...isn't that big a pro.

The next most obvious solution is to have the debug scrpt (which has transformed into an easter egg script) handle the oc data strings.

Just like the viewer, it would load the text files asynchronously, and then ping the scenario_controller2 or the rare_session_finder which would then take the loaded players and do stuff with them.

Pro:  Allows AB to know about data string sessions just like she does about trickster or rumpus=fruity sessions etc.

Con: Would be tricky. How would I prevent the existing scripts from continuing until the easter egg is loaded. Should it ALWAys pause until returned?  would both scripts have the same callback method once it's done (i just answered my own question, use a callback.)
	Modifying the sim in order to use an easter egg is a big 'no'. Its a bad idea.  But it's not a very big mod.


Okay.That was 5 minutes. I did'nt come up with any new solutions on top of what I already had in my head.  I did manage to put in words why I like solution 2 over solution1, even though it violates
my principle of "don't fuck with the sim for easter eggs.".

So, IF I were to make a small refactor to scenario_controller2 and rare_session_finder, I would need to have their initial methods STOP with asking about easter eggs, and have a callback to resume.
ALL easter eggs should call that callback, and the resume method should have everything that used to be after the easter egg check.

Forseen problem: I am pretty sure rumpus=fruity and similar easter eggs are called TWICE, once before initializing and once after (to blow away derived values that don't match the characters.)
I plan on refactoring it eventually, so 'carcinoGeneticist' isn't re-derived any more than 'jadedResearcher' is.   IS THIS ALREADY HAPPENING?

Current goal: look into code, see where I'd need to convert to call backs, and also see if double calling easter eggs is still necessary.

Sequence of Events:
startSession
	checkEasterEgg();
	initializePlayers(curSessionGlobalVar.players, curSessionGlobalVar); //will take care of overriding players if need be.
	checkEasterEgg();
	checkSGRUB();

	load(curSessionGlobalVar.players, curSessionGlobalVar.guardians); //in loading.js



Analysis: It seems really easy to just put checkSGRUB() and load() into a callback. initializePlayers, too, if I can confirm it's not overriding custom things.


GOAL: make checkEasterEgg() called only once, before initialization.
GOAL: make checkEasterEgg() load random smattering of Fan ocs, if appropriate easter egg is active.
GOAL:	should it replace them in checkEasterEgg and derived functions, or should it somehow convince 'initializePlayers' that it was a replay string in the url (or similar, such as a var set on session). (2nd seems better, don't have to load ocs in 2 separate places).
GOAL: have everything after checkEasterEgg in call back that is passed to checkEasterEgg(); regular easter eggs call callback at end, Fan OCs call it when players are done loading.



Working on: GOAL: make checkEasterEgg() called only once, before initialization.

Is player.reinit() ever called, or has it been replaced with initializeDerived???
Yes. it's called. BLUUUUUH.

BUT, seems to ONLY be called by guardians. Can do better.  Get rid of it and ONLY use initializeDerived. Now there's only one place I care about.

Need to say "if chatHandle == "", derive, otherwise don't".  How am I doing this for session replaying?

if(this.deriveChatHandle)  well. THAT's going to be easy. Just set that for the trolls/humans/etc in the playerTo413index or whatver.

HELL YES! It is working! Now just make sure AB only calls it once as well. also for scratches.
confirm ab agrees with reality and both can scratch. ooo, and 612 is a yard, too (equius is only surivor and was black for nepeta).
 so. test that.  oh shit, and scratched 612 was a combo session where only cronus and mituna made it to the new session. which grim dark crashed.

 Shit. wait. quirks are broked. need to fix. shit, and yellow yards. hopefully only for easter egg sessions.

 wait. no. false alarm. it was robo aradia's fault becaue of true random. dang. oh well.

 alright, quirks are ready.

 next Goal:  GOAL: make checkEasterEgg() load random smattering of Fan ocs, if appropriate easter egg is active. o
 nly load those player categories that i need.  if no space/time in all potential use generic one. always choose space/time player using findAllAspect players.  2-12 players chosen.
 ~~~~~~~~~~~~~~~~~~~~
 Okay. I have three problems that MIGHT be related.

 Characters loaded from Fan OCS are not able to render themselves, can't find their canvas.
 Blank Space players hae no chat handle.
 EVERY CHARACTER (hundreds)is in the playerSprite div, not just the ones I want to render.

 Try to fix third problem first. clear that div out once i have my pool.
 Wait. No. will clear out "real" players, which the replayers are going to overwrite.

 Okay.

 Find out WHY they are rendering. Does loading a player do that?

 Oh shit.

 Oh fuck.

 It's HAPPENING ALL THE TIME. Even if not in easter egg mode. FUCK!

 Okay. I see that I have code to create the canvas if i try to render and don't have one, but that I am ALSO creating a canvas every time I intiialize derived stuff. dumb. try not doing that.

 Hell yes, way better. now not all cloggy.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Fuck fuck fuck fuck fuck.
Yellow Yards are broken, even on main branch.
Fuck.
Okay.
I know what hte problem is.

The problem is that I had to refactor the easter eggs to handle callbacks so that the oc fan easter eggs would work.

And the yellow yard can't handle that.

Look at the code, don't panic, and don't make assumptions:

Code is:

this.addEventToUndoAndReset = function(e){
		//when I reset, need things to go the same. that includes having no ghosts interact with the session. figure out how to renable them once my event happens again.
		this.afterLife.complyWithLifeTimeShenanigans(e);
		//console.log("undoing an event.")
		if(this.scratched){
			return this.addEventToUndoAndResetScratch(e); //works different
		}
		if(e){//will be null if undoing an undo
			this.yellowYardController.eventsToUndo.push(e);
		}
		//reinit the seed and restart the session
		var savedPlayers = curSessionGlobalVar.players;
		this.reinit();
		createScenesForSession(curSessionGlobalVar);
		//players need to be reinit as well.
		curSessionGlobalVar.makePlayers();
		curSessionGlobalVar.randomizeEntryOrder();
		curSessionGlobalVar.makeGuardians(); //after entry order established
		checkEasterEgg(); //in the controller.
		//now that i've done that, (for seed reasons) fucking ignore it and stick the actual players in
		//after alll, i could be from a combo session.
		//but don't just hardcore replace. need to...fuck. okay, cloning aliens now.
		curSessionGlobalVar.aliensClonedOnArrival = this.aliensClonedOnArrival;
		//console.log("adding this many clone aliens: " + curSessionGlobalVar.aliensClonedOnArrival.length)
		//console.log(getPlayersTitles(curSessionGlobalVar.aliensClonedOnArrival));
		var living = []  //if don't make copy of aliensClonedOnArrival, goes into an infinite loop as it loops on it and adds to it inside of addAliens
		for(var i = 0; i<this.aliensClonedOnArrival.length; i++){
			living.push(this.aliensClonedOnArrival[i])
		}
		this.aliensClonedOnArrival = [];//jettison old clones.
		addAliensToSession(curSessionGlobalVar, living);

		restartSession();//in controller
	}


	Shit, isn't there a scratch versio of that, too?

	One thing at a time.

	So, problem is:


	checkEasterEgg(); //in the controller.
		//now that i've done that, (for seed reasons) fucking ignore it and stick the actual players in
		//after alll, i could be from a combo session.
		//but don't just hardcore replace. need to...fuck. okay, cloning aliens now.
		curSessionGlobalVar.aliensClonedOnArrival = this.aliensClonedOnArrival;
		//console.log("adding this many clone aliens: " + curSessionGlobalVar.aliensClonedOnArrival.length)
		//console.log(getPlayersTitles(curSessionGlobalVar.aliensClonedOnArrival));
		var living = []  //if don't make copy of aliensClonedOnArrival, goes into an infinite loop as it loops on it and adds to it inside of addAliens
		for(var i = 0; i<this.aliensClonedOnArrival.length; i++){
			living.push(this.aliensClonedOnArrival[i])
		}
		this.aliensClonedOnArrival = [];//jettison old clones.
		addAliensToSession(curSessionGlobalVar, living);

		restartSession();//in controller



everything afer check easter egg HAS to be in a callback because checkEasterEgg is now asyncronus.

BUT, if I try to make one, it fucks with 'this' and i can no longer do things like 'this.aliensClonedOnArrival'.  (I know this because i tried this.)

think.

Is there a way to pass "this" in a callback?  Off the top of my head I can pass both callback and 'this', and just have everyone else ignore it. I could also keep 'this' in a global var like a chump.

Let's try to first idea first.

Whew, fuck, okay, stop panicking 'cause that worked. look at me knowing how to deal with "this" breaking.



~~~~~~~~~~

Designing AB upgrades to allow her to do the tournament.

Noticed that ABJUnior uses "callback" and AB uses "callback restart" and don't know why. but...they seem to be working???

check if abj is sane and if abj can handle scratches without lying. Yeah, they are fine.

Okay. So, back to original problem.

I need to pass AB a callback so she'll return the results of a simulation to me instead of processing it. But she is ALREADY using callbacks for easter eggs.

Now. I can make the entire easter egg take ANOTHER call back. but that seems...wrong, and brittle.

I could store my callback in a global variable. (polluting that name space should be a last resort, but WOULD be easy.)

So, first step is research my options here on the googles.

~~~~~~~~~~~
okay, don't get ahead of yourself. AB is giving you results back. but not hte right results.  I need to be able to process an easter egg EVEN from not a param. so.
let's do this shit.  probably only need it from the "stuck" category. but...maybe from more than that.
maybe getParams itself will be moded to also check global vars.
param is the easiest place to put it, though it might be weird to have it git url vars and non url vars. but would work for ALL easter eggs.
could theretically run trickster tournament that way.

ah wait, the "stuck" stuff doesn't even use getURL vars, that's right.

cool.
easier.




~~~~~~~~~~~
It seems like any character that is stored as an ocCharacter in the text files loses any binary character that is "(" in ascii, casuse of chracter corruption.
Where is it loosing it? It appears to be correct when i call standard char processing code.

parsing one char, fine, parsing array, some are corruptionnnn....




expect 88 X11 =968 bytes, getting 966.  two bytes are being eaten before  dataBytesAndStringsToPlayers


ultimate breeder....appears to have 10 bytes, not 11. see if it ends in the mssing "("

Yes, it does.

So, "(" isn't the problem, Ultimate Breeder is problem, not enough chars. look further.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Alright, planning out new classpect stats unit testing plus fraymotif combob.

5 minutes on the clock, go:

I want for each fraymotif to be clickable. When you click it, you see the list of the players invovled in the fraymotif, and their stats underneath them.  Clicking a player name increases their power (unit testing for that).

There should also be a button for "use fraymotif".  There should be a "Dummy" game object that has it's own stats displayed, so you can see how they are reduced
(by the way, should strife title have hp/maxHp listed???)

clicking use fraymotif button should apply the fraymotif to the gameEntity.  Fraymotifs are ONLY USED in teh context of strifes with a game entity.


QUESTION: SHOULD I REFACTOR STRIFES TO BE THEIR OWN OBJECT, SEPARATE FROM GAME ENTITIES (that way can have two playes strifing each other).

What else... fraymotifs can raise our stats, lower the enemies stats...  (no longer am i trying to pretend stats can be good or bad and raising/lowering is equal).  fraymotifs can do damage (either a base level, or base plus associated stats)

Which reminds me FRAYMOTIFS SHOULD USE ASSOCIATED STATS, and a new, similar kind of object called "buff". A buff should have a stat name, and a value.

If I'm a Prince of Breath, and I find a fraymotif, that fraymotif can buff or debuff an enmy for ANY of my ASPECT originated associated stats. My class will determine exactly what happens, though???

Should class give you modifiers to buffs/debuffs and damage/healing?  This makes sense.




~~~~~~~~~~~~~~~~~~~~~~

Trying to upgrade the ShippingGrid shit.

Current State: heart OR blood players can run shipping grids, and will speculate that any currently non-quadranted-but-interested-in-each-other
pairs as being either conicillitory (blood) or concupisience (heart);  Once they are officially quadranted, though, they'll reflect resetPlayersAvailabilitya
adequately.

GOAL:  A shipping player will note any "requited" crushes and push them into going into their favorite relationship type together.
If it's a blood player trying to do ashen, the blood player is the middle leaf.  concillitory town two wheel devices that they are.

When they try to push them into a quadrant, 30% chance they will go into the quadrant they WEREN'T pushed into (flushed if blood player, for example.)

Either way, shipper will comment on it and get a huge bonus if it was their chosen ship.

can only create one ship at a time, and only when they can otherwise update their shipping grid.

now, think about this awhile.
