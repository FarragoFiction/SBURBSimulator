sim=true
2
2175

2
2175

sim=false
2
659
2870


sim == false
no intro/loading
2
1000


sim == true
no intro/loading
2
1000

even with everything off, those 2 are still being got.
why?
oh, time till reckoning and sessionType. i will initialize them to non random.


now simmode gets me 2040, with intro and loading. instead of 2175. so confused.

simodd false (so rendering) gets me
659
2870

so whether or not there is more in rendering is different for different sessions.

what if only intro, no tick
659
800

vs

1000

so rendering uses 459 more seeds. why.

okay, lets look at the "real" sim.
real page	ai finder simulation = false
977		659
2870		2870

I wonder why rendering has the console statements print
out in 2 parts, and not consistently in 2 parts?
Like...both things have 2870 as the second part.
But the first part is different. Why?

The second part seems to be the important part...
The MVP of the session was: Grim Dark Heir of Rage's Corpse with a power of: 203
The MVP of the session was: Grim Dark Heir of Rage's Corpse with a power of: 203
Both have same result, even same power (which means everything was the same, basically)

IS THE SEED GETTING RESET?
Is that why only number of seeds being got AFTER a point matter?

Nope. only called once.

Okay. What do I know?

There is a problem even in the intro stuff.
That greatly shortens the stuff I have to look into.

Simulation = false is identical to the real stuff,
so only need to debug one page.

Question: What happens in the intro (when sim=false).

Where/when does it differ from sim-true?

Both intros are identical.  But...use different amount of seeds?  Okay,
maybe directly measureing seeds isn't the best way? with regular ticks on,
 where do they start to differ?

4kmonitor ftw that i can put these side by side to compare


!!!!!!!!!!!!!!!!!!!!!!!!!
The very last thing that is the same is
The Maid of Void makes a general nuisance of themselves to the Black Queen.

Then,sim-false the Heir of Rage black flirts with Knight of Space,
 and gets rejected. Then ectobiology happens.

Then,sim-true, "
The Heir of Rage has taken an acrobatic fucking pirouette off the handle and into a giant pile of crazy. They engage Murder Mode while thinking of their enemies Knight of Space and Seer of Time and Page of Light and Rogue of Mind and Sylph of Heart and Thief of Breath. This is completely terrifying. "


Yeah, that would hella cause a difference between sessions.

So, is relationshipChat somehow using up randomness?
There is a space for a chatlog in the sim-true version...
But, the relationshipDrama should still be happening, just not being rendered....
it's not the first chat, but it IS the first relationship chat.

HR is antagonizing a jerk, which means they are indeed triggered (possibly just as much as when they engage murder mode)

printing out the text that would have been there, it is the same for both of them.
drawRelationshipChat doesn't seem to consume random.

Okay, what if I allow that thing to render, but nothing else. Does source of difference dissappear?


....What. The. Hell. It freaking APPEARS TO!? Smae MVP with same power and everything. This makes no sense.
I'm not actually even rendering anything but text, 'cause still no loading.

Alright. WHY is this happening?


Alright, well, drawChat and drawRelationshipChat are actually pretty similar. So look for their differences.

dRC gets the relationship to know if they should render heart or spade or nothing. Is that it? Doesn't appear to consume
a seed. if i comment it out, will sim-false do an accrobatic piorrette (both literally and figuarativelY)

Yep. Still doesn't make sense. But NOT rendering the heart or spade causes acrobatic pirouettes.

Look deeper.

It's not from rendering their empty buffers. still acrobatic pirouette

Is it getting the relationship? No.

Is it drawing the symbol?

Is it .....fuck. FUCK!!!!

I'm asking the relationship what type it is! That's WRONG! That's allowing it to recalculate
the relationship (for example, fall out of love). I'm supposed to be querying the savedType.
THAT was consuming the random!

!!!!!!!!!!!!!!!!!!!!!!!!!!!!I AM THE GREEEEEEETEST!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Also, now I need to go make sure anywhere i'm using type() is saved_type unless i really meant it.

Fuck. Fuck. It's still happening though, even though i found an obvious use of random seeds.

Oh god, I just realized that before when i was rendering empty buffers, I thought it was right that it was still pirouetting.
that's wrong. damng.

Wait. no, that's actually right. the rendered version is wrong. acrobatic piroutte is right because it's when less seeds.

compare both versions.










And now for something entirely different. This is the best place to put a ramble, but it's not even at the debug phase yet.

Problem: I wish to change exactly one thing in a session, at a specific point in time.

Related information.

I have a several ways to identify a point in time in session, but none of them are currently accessible in a meaninful way.

*  Tick:  There are both regular and reckoning ticks. this information is indirectly available in the sesion's "timeTillReckoning" variable. it's negative after a reckoning.
* Scene Index:  I have a list of "scenesTriggered" in the sesion, which is how I summarize a session, partly. This list is not guaranteed to be useful. I'm pretty sure it just adds the scene in the scene list. The same scene can appear multiple times, and will in fact be changed over time (for example, corpse smooch will have different players attached to it.)


Sub problems:
* Identify an important event.
* add an event before the important event.



"add an event before the important event." appears to be the easier subproblem. I will tackle it first.
Given that I have a way of identifying an event, I need to have a scene that triggers right before that event. If it's based on tick, then trigger will happen when this.session.timeTileReckoning=x. if it's based on scenesTriggered index, then it will happen when this.session.scenesTriggered.length = x; That SHOULD be all I need.  scene should not repeat, and should have absolutely highest priority...or...hrrm.

SHOULD it have highest priority? It just needs to happen before the important event, right. But "timeTillReckoning" can have many scenes called. So if i give it highest priority, it might happen several scenes before it should.

CONSTRAINT FOUND:  Scenes need to be identified by scenesTriggered index, not timeTillReckoning. This makes sense in retrospect.


PROBLEM FOUND: scenesTriggered index will not be consistent between timelines.

I need them to be.  The whole point is that the Observer (that's you, btw) gets to make a decision after a virgin doomed timeline happens.
So,they insert a scene that wasn't there before. Which by definition alters the index of the previous thingy.



Alright, think about this in more detail.

Sequence of Events:

Session procedes on the regular and ends in tear-jerking tragedy.

At the very end, AB and I show up.

I offer the Observer and time player a yard's worth of Decisions.

Session reloads, then procedes on the regular until the time player warps in to make a change.

Session is altered. Either ends in  tear-jerking  tragedy, or in less tragedy, or success.

If tear-jerking tragedy, At the very end, AB and I show up.

I offer the Observer and time player a yard's worth of Decisions, including the decision to undo their previous decision.


Session reloads, then procedes on the regular until the time player warps in to make a change.  Both THIS decision will be implemented AND the previous decision (unless you decided to undo this.)


Repeat until either Observer gives up or there is no more tear-jerking tragedy.





So, once more:



PROBLEM: scenesTriggered index will not be consistent between timelines.

Brainstorm Solutions:

add array to SaveDoomedTimeLines.  List of scene indexes to alter.  No, make new object that has index/result function pairings?

no...if being that different, make new scene.  YellowYardResult or some shit.

If I am careful to play the new scene juuust before the old one, then....wait. okay. no.
I was going to say "resave the old scene index +1", but that won't be true every time. or even consistently. if a new scene has been added before me, add 1, else it's the same. hrrrrm...

so, YellowYardResult will also have a boolean if a new scene has been added yet. (only one new scene can be added a runthrough.) if yes, increment your scene_trigger_id. if no, do nothing.






Okay, I"m sure that's not enough to work just yet, but it's enough to start. BUT, there is still another subproblem I have not yet addressed:



* Identify an important event.

How do humans do this?

Types of important events:
	* a player dying
	* a player engaging murder mode
	* a player going grim dark
	* jack being promoted.
	* frog breeding


So, how do I decide which events to include in my Yellow Yard? Through the session summary code, I know I can find if MurderPlayer has happened. But that scene can result in a murder or result in clubs/diamonds.

Okay, well, when I say "player dying", do I mean a permanent death, or any death?

Should I have scenes be capable of creating a "ImportantEvent" object to give to their session?

That might solve both sub problems. If a scene creates the important event BEFORE RENDERING, it can trigger the session to go to it's YellowYardResult object or whatever and decide whether or not the event should be altered.

I am tentatively optimistic.


So, obviously if i was in a sane language, I'd have different types of Important Events subclass out from the main one, but javascript does not give a fuck.
Should Important Events be like scenes (i.e. a different class for each event), or should it be a big stupid jumble. Problem with different classes/files is it gets cumbersome including it in html documents and also is spoilers.

big stupid jumble it is. but like, a hybrid jumble, with the different objects in a single file.

An Important Event has a human readable label, and a function that is how to prevent that Event. (both the text/image to display and the results.  like player.dead = false. or whatever.)
It should also have an importanceRating, because if I have more than a Yard's worth, I have to trim the list SOMEHOW.

when a session is done and qualifies for a YellowYard, I display the list of important events that happened this session. One is selected and saved in the YellowYardResult object or whatever.

 Then, the session is redone. Just like before, each time an ImportantEvent happens, the session asks the YellowYardResult if it's allowed to happen.  This time, for one of them, YellowYardResult says "no".
 It says "no" because the ImportantEvent perfectly matches the saved event.

 Example of match.:

 ImportantEvent.subtype = "Player dies with a living dream self without God Tiering."
 ImportantEvent.player = "Heir of Life"


Note: this means that this Important Event can be matched even if it is under very different circumstances. For example, the timeline can vastly change, but so long as the Hier of Life still dies without godtiering, this event would be altered. Do I want this?

For the authorBot, a good way to check if a session has changed before now is the check the value of the MVP. If things are mostly the same besides cosmetic stuff, this value will also be the same.

Alright,

 ImportantEvent.subtype = "Player dies with a living dream self without God Tiering."  (automatically decides importanceRating)
 ImportantEvent.player = "Heir of Life"
 ImportantEvent.mvp_value = 342

 BAM, now altered events are mostly stable.

 Okay, where was I?

 Okay, so the YellowYardResult has found a match. it tells the session, which returns to the scene that calls it. The scene does not render itself, and instead render the ImportantEvent.alternateTimeLine(); I need to make sure this function changes all relevant variables. Or...

 Hrrm...  Let's say the ImportantEvent was the GrimDark MurderMode Heir of Life dying.   The scene kills them, (which clears our their status modifiers), and then asks if it can render the result. It is told no, and ImportantEvent.alternateTimeline brings them back to life.  But it doesn't know they were GrimDark MurderMode and doesn't restore that.

 That clearly is unacceptable.

 So, the scene should create an ImportantEvent BEFORE modifying anything. Not just before rendering.  But the problem is that many scenes modify things over time. Hrrrm.  Well, the important event can be PART of a scene.   Example, jack starts to show his stabs to the Heir of Life and the Maid of Mind, but the Bard of Time warps in and carts the Heir of Life's corpse to their sacrificial slab/quest bed.

 Okay, at this point I'm just waffling to avoid coding because once I start this will be real and WHAT IF IT'S STILL IMPOSSIBLE!?  Time to code.





 TODO:   22577

 why is page of time god tier twice listed? is it just first?  in subsequent loops its life that gets repeated

 add alternate scenes for all important events
  make player not die is NOT just an alternate to god tiering. god tiering deals with corpses, but not dying needs to be the scene that MAKES the corpse

 add scene for undoing your own undoing. basically generate list from scenesToUndo.  add before killing players list.




 Problem. Trying to remove functional duplicates from importantEvents. Objects aren't literally the same, but values are.

 Current way is looping through an inner loop and an outter loop. problem is that let's say my array is:

 [1,2,3,4,1,2,3,4,1]

 In the outter loop I look for "1".  I find it two additional times, and mark the extras for removal. I succesfully don't mark 'myself'.

 But...then, the fourth element, the second 1, when i loop on THAT, I find the first 1. And mark it for removal. And thus ALL 1s are marked for removal.

 How to fix?

 Well, I could probably extend javascripts native filter thing. But i don't want to . I'm feeling intellectually lazy.

 hrrrrm.

 Well, the inner loop doesn't HAVE to start from zero. It can start from the outter loop index. that should do it.


                          ```````   `                 `  ``   `                        ```````                           `
                      ```` `   `   ````           `````   `   `````               ````  `   `` ````                ````  `   ``` `
                   ```               ````        ```             ````           ```                ```          ```             ````
                  ``                   ```      ``                 ```         ```                  ```        ```                ``
           `````..``.`..`````````.``.``-``.``..`..``.```.``..``.``.``.``.``.``-`.-``.``.`..``.``.``..`..``.``.``.```..``.``..`..````..````
           `.-............-..-...-.....-........................................................................-.......................-.`
           `.-..........................................................................................................................-.`
           `......:-....-::::::::::----:++++++++++++++oo+++::::::::::::::...::::::::::::::---------::::::::::::::::::::::::::-....-:......`
           `.-..../.                 -ohddddddddddddddddddhh+`           `.`                                                      ./....-.`
           `......+.              .+yhddddddddddddddddmmmmmddy.          `.`                            `     `                   .+......`
       `````.-....+.           `:shddddddddddddddddmNNNNNNNNmdy.         `.``.+o+.`  `.oo/.           .sh   .sh                   .+....-.` ```
     ```   `......+.         -ohdddddddddddddddmmNNNNNNNNNNNNmdy`        `.`  +d+      sd:             yd    yd                   .+......`   ```
     ```   `.:....+.         .yddddddddddddmmddNNNNmshNNNNmmNNmdo        `.`  +d+      sd-    ---:.    yd    yd    `---:.         .+....:.`    ```
    ```    `......+-          `+hdddddddddms:-hNdyo.``:shmN+omNdh-       `.`  +do------yd-  -s.``-ho   yd    yd   /o```-ss`       -+......`    ```
    ```    `.-....+:            .ohddddddy-``.:-.````````.-:`-NNdo       `.`  +d+``````yd-  yy:::://`  yd    yd  -h:    -do       :+....-.`    ```
     ```   `......+-              .+hdddds```````````````````.NNmh.      `.`  +d+      sd-  yh.    .`  yd    yd  :do    `d+       -+......`    ```
     ```   `.-..../.                .sddddy-`````````````````+Nmdo`      `.`  odo      yd:  -yho//+:   yd    yd   +h/` `/o`  /o.  ./....-.`    ``
       `````....../.                 -yddddh/```````````````/dyo-        `.``.:::.`  `.::-`  `-//:.   .::.  .::.   .::-..    -/`  ./......` ````
        ````......+.                /hddddddds:``````````.-/:.`          `.`                                                      .+......````
           `......+.               -ddmddddddddo-..-//+ohms              `.`                                                      .+......`
           `.-....+.              -hdNmddddddddddhhdddddyNh              `.`                                                      .+....-.`
           `-.....+.           .-ohddmdddddddddddhhdddddso:              `.`                                                      .+.....-`
          ``......+.          .ohdddddddddddddddhs/ddddddh:              `.`                                                      .+......`
        ````......+.         ```:hdddddddddddddh+--/hdddddh-             `.`                                                      .+......`````
      ```  `......+-      ``````.hddddddddddddho....+dddddy`             `.`                                                      -+......`  ```
     ````  `.:...-+:   ``````` `odddddddddddddo/-..-+sdds/.``            `.`                                                      :+-...:.`   ```
     ```   `....../-`````````   :sssssssyyyyyys+o++o+syyo `````          `.`               ````````````````                       -/......`    ``
     ```   `........````````````--------:::::::::::::::::.````````````````.````````````````````````````````````````````````````````.......`    ``
     ```   `....../```````      -+syyyhhhhhhhhhddddddhyo/.    ```        `.`                                                      `+......`   ```
      ``   `.....-+`   `````       ``.shdddddddddddddo         ```       `.`                                                      `+-.....`   ```
       ``` `.....-+`      `````   ````-/hddddddddddddh-         ```      `.`                                                      `+-.....`  ``
         ```.-...-+`          ````````..:oddddddddddddh.         ```     `.`                                                      `+-...-.```
           `.....-+.                 :shyddddddddddddddy.         ```    `.`                                                      .+-.....`
           `.-...-+.                 sddddddddddddddddddy.        ```    `.`                                                      .+-...-.`
           `......+`                 ydddddddddddddddddddh.        ```   `.`                                                      `+......`
        ````......+`                -hydddddddddddddddddddy`        ``   `.`                                                      `+......`````
      ```  `......+`                +hsdddddddddddddddddddds`        ``  `.`                                                      `+......`  ````
     ```   `.....-+`                +y+hddddddddddddddddddddo         `` `.`                                                      `+-.....`   ```
     ```   `.-...-+`                ys+yddddddddddddddddddddd/         ` `.`                                                      `+-...-.`    ```
     ```   `.....-+`               -d++sdddddddddddddddddddddh-        ```.`                                                      `+-.....`    ```
     ```   `:....-+`               -s++ohhhhhddhdddddddhhhhyso+        ` `..`                                                     `+-....:`   ```
      ``   `.....-+`                .++++++oooo-::::/oooo++++++.         `..`                                                     `+-.....`   ```
       ````..-...:+`                -+++++++++/      :+++++++++/         `.`                                                      `+:...-.` ````
        ```......-+.                -+++++++++/       /+++++++++.        `.`                                                      .+-......```
           `.-...:+.                -+++++++++/       `+++++++++/        `.`                                                      .+:...-.`
           `.-...-+-                -+++++++++/        :+++++++++`       `.`                                                      -+-...-.`
           ......./:...--:::::::::--://///////:......--://///////::::::::...::::::::::::::--------:::::::::::::::::::::::::::--...:/.......
           ..-..........................................................................................................................-..
           ..-........-...-..-..................................................................................-..............-........-..
           `````-``.``.```.`````..`..`..``-``-``-``..``.```-``.```.``.`..``.`..`..`..`..`.``..`..``-``.``.``..``.```-```.``-```.``.``-`````











Okay, now that THAT's out of the way....

time to update the Rare Session Finder.

my original thought was to have a new page entirely, where you can pick what you want to look for from a drop down menu, and then AuthorBot prints a list of sessions out that match your criteria.  But karmicRetribution has an intriguing idea: On the 'stats' section, have them be clickable to filter sessions out.

So: Design time.

~~~~Sequence of Events:

Page is loaded.  Can pick number of sessions to check, and click "check sessions."

Stats for All Sessions updated with each session, and stats for A session print below.

Click on a total stat line, and it filters sessions to only be ones where that value is 'true'.   Total stats now only reflect filtered list?  Button added to delete all filters.
~~~~~~~~~~~~~~~~~~~~~

So, I will have to refactor some stuff.

Right now the way total session stats are calculated is each session adds to a global variable when they are asked to summarize themselves. if i were to call that multiple times, it would inflate the value. and there is no way to get it for only a subset of sessions.

bluh. bob warned me about global variables. he told me, dog.


So, instead of having global variables, have each session contain a summary object (much like a player snapshot).  When I ask for a session's summary, it generates this object.  Move the "summary HTML" code outside of the object itself. just make it a global function. Then, I get combo stats by asking all sessions in an array to give me their stats.

have sessions array, and filteredSessions array.  Sessions array is never modified. filteredSessions array is always a object by object copy (even if there is nothing to filter by).

what happens if they check a session while it's filtered?



bluh, okay time to actually try filtering.

I can test to see if a session summary has any arbitrary variable filled. won't help with frog leve, but baby steps.

but...standard array filtering doesn't work that way. it wants you to specify the variable in advance. so maybe will have to have a lot of bullshit methods?

sequence of events:

click on collated stat. calls method, giving the parameter name to the method.  method mostly just filters based on parameter name, with a few being special.

that's what I WANT...but Array.filter only lets me pass an object in, not anything else....right? Confirm this.  yeah....seems like it.  can just write my own, linear time code.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~




okay. time for the main event.

SHIIIIIIIIPPPPING!

can label a relationship as being in a quadrant now. want to carefully refactor things to check on them.

if <> killed, super fucking trigger plus super-hate killer should be insta-murdermode.

as long as you have a relationship of type <>, less likely to engage murder mode.

if you try to kill c3<, middle leaf intervenes if able.

can do break ups, or cheat.

~~~

Man. I spent all yesterday making easter eggs and hiding links for them. And then giving a bonus to my tumblr followers by violating the easter egg aesthetic and giving them links to them.

I kind of...want to do something with that for 413. No way I'll get my next major feature (character creation) done in time...but I still should do SOMETHING, right?

I'm thinking riddles.  Ask some sufficiently obtuse question, and the answer is expected to be a seed id. if you enter a seed id that fits the riddle (from it's summary), list of various easter egg urls (including maybe a link to THIS whole mess) are revealed.

would that even be fun or cool?

......
Bluh. For the record, can I just say that the medical tv show "House"  is complete bullshit. Like, I get that it's fiction. But you still figure that there are magical hyper-competant doctors out there that can DIAGNOSE you. Like. In this day and age shit being left undiagnosed is such bullshit.
Especially when the internet is just there, telling you about all these cutting edge tests for various bullshit diseases that no actual doctor has ever heard of. Or genes that are definitely diagnostic of something that it turns out there are no commercial tests for.  Hope you live near the one lab on the planet that developed those gene tests, buddy.  Although I guess at this point the list of shit I could have is pretty incurable. So. Diagnosis is more solving a puzzle then something actually useful. bluh. /rant.
.....


Okay. Let's focus. Fo-cus. Focus! (Magic Cupcakes by Octopimp on youtube has just corrupted that entire word for me.)  Today's goal is to let people break up from their quadrants, even though that should be hella rare.

THINGS THAT CAN TRIGGER A BREAKUP:
* Feelings change
* Cheating (on either parties part.)

I figure "feelings changing" shouldn't be an automatic breakup session, after all inertia is totally a thing.   And I want to move away from using seeds if I can help it for a variety of reasons.  I dont' have enough claspect specific stuff going on right now.

Some classes will hold onto a relationship for longer, regardless of why a break up might be valid. Maybe different inertial rates depending on the event.

If I am a Knight AND I am cheating on you, I confess and break up with you. Seems chivalrous. (although maybe NOT cheating would be better, but cheating is already rare enough, I'll leave it as is.)
If I am a PAGE in the same situation, maybe I just sort of let it...keep happening.  Or a Rogue, like Rufio and Damara.

So, break things up into Active/Passive lines?  Not all the Active/Passive stuff is known...but I can make educated guesses. It's not like it'll be explicit.
I can also have a few Interests (like whatever superclass "Romance" is in) influence your odds of calling things off. I figure if you are good ar romance you migth be more likely to be honest and open? and terrible people just...arne't.

Meanwhile, if your partner is cheating on YOU, chance of finding out and breaking up with them.  This tends to result in much worse feelings.  Triggers and hate and what not.  Damara went into murder mode, basically, after she found out about Horrus.

MurderMode would probably be a MUCH more likely option in the case of diamonds cheating.

Clubs cheating is totally not a thing.

Oh! And if there is a heart player, everybody is MUCH MORE LIKELY to be open and honest (thus reducing the murder mode freak outs). Cause hell, if you don't tell them you have a new <3, then the heart player might.




PROBLEM:

If CorpseSmooch takes priority over GetTiger, then MOST players will only god tier through sacrificial slabs.  But if GetTiger takes priority over CorpseSmooch, ALL players will god tier the first time they die and not leave any for Sacrificial Slab. That's because CorpseSmooch is a one time thing. If you don't get smooched, your dream self dies and you are no longer eligible for smooching. (Note to self, maybe let usless smooches happen, creepy Gamzee style). But GetTiger happens so long as you have at least a dream self and are destined to god tier.

BLUUUUUUUUUHHHHH.

Okay. Think.

You SHOULD be able to do multiple scenes in a row. That's what the availablePLayers array is for, right? Is GetTiger ever setting a player as unavailable? If so, just undoing that will acomplish two things:
1.) If a player fails to GetTiger, they will then hit the corpse smooch, which will leave them ready for the sacrificial slab the next time they die.
2.) GodTier players get a free extra action. They are Gods, don't worry about it.

Huh, no, I don't seem to be setting available players. So...why...why isn't corpse smooch being called next?
Okay, adding some console output, and it looks like Corpse smooch thinks there are no dead players. Look into GetTiger. Is it reviving them regardless of what I do?  Yes. Yes it is. Okay then, return when random chance says no quest bed.

Heh. Also, don't render them 'reviving' if they haven't. Duh.


from DestroyerTerraria sent 11 minutes ago
"X of X is fucking pissed at X of X. They'll get thrown the fuck down by their lyrical flow, Get their asses kicked with words that cause em woe, Gonna bust every rhyme they could possibly know- X of X started some SICK FIRES, YO!"

Oh god. How much of my life is going to be sacrificed to making the worlds shittiest rap engine?  Focus:

Priorities:
* Claspect Character Creator
* Some claspect customization
* Shitty Rap Engine
* Cosmetic/Interest/KernelSprite Character Creator Upgrade.
* Refactor battle system for luck/hp, etc.
* More claspect customization


TODO: First thing is allow class and aspect to be chosen. Won't be very different from the OC_Generator (does that thing still work?). Basically, step one will be having the Observer input a session ID to replay/hijack/override. Then, load the players from that session and display them. Drop downs over the sprites let you change Class/Aspect for each player. Sprite updates with the new claspect. When it's to your liking, can click "start", and session begins BELOW character creator (don't vanish it cause they might want to see their chars in a pristine state.)

		Challenges:
		* Handling graphics.  For the regular sim, I just preload all the graphics that will be used and call it a day. This is fine, but with a character creator, I don't KNOW what graphics I will use. Should I preload dozens of hair, for example?  MB's been poking me to do asyncronous image loading, but it has it's own challenges, which is why i went away from it in the first place. I will need to stop and THINK about this.
		* Sharing sessions. Can't just use session IDs anymore. Will need to serialize the player data in some fashion. Write to image, along with pictures of their players? Might be neat.  Top border is random-looking stuff that's actually the encoded session, and underneat it is the human understandable: here's what the players look like. Ah...but...how will they UPLOAD the image so I can recreate their custom players. Do I really want to bother having a server that isn't dead simple?  I guess I could have them upload it on literally any image hosting site and then just give me the URL? But...what if the hosting site warps the image (like, by compressing it). Table this for now.


Who am I kidding, it's Rap Battle time.

So, basic idea outlined by recursiveSlacker is one of finding a word in both arrays.

wordsThatRhymeWithNo = [a,b,c,d]
nounsAboutPopCulture = [c,d,e,f]

so i might get c and d outta that.

Want to have points though, no how good the rap was and how sick the fires were....is "And it don't stop" still online? Get templates for raps.
nope. but can go to cannon.

Sit your ass back down 'cause we got shit to settle.
Just park ii on my grill you be whistling like a kettle
If rap's a one wheel device your foot don't reach the peddle.

Hrrm.when tavros and gamzee have one of teh worst rap offs in paradox space history, they talk about their INTERESTS. I really want to do that.

iMAGINE AN ARRAY OF BEATS THAT SET LIMITS,
AT: tHEY GOT A RULEBOOK, iT DOESN'T PAY TO SKIM IT,
AT: bECAUSE, tHERE'S NOT A LOT OF LATITUDE,
AT: tHEY WON'T STAND FOR AN ATTITUDE,
AT: aND, cROSSING THEM'S A HABIT YOU'D,
AT: (nOT REALLY WANT TO GET INTO BECAUSE, uHH),
AT: tHEY'D GET PRETTY MAD AT YOU,




switch gears right quick.  AuthorBotJunior has to be a thing.


objective: be able to filter by:

# of players in session (2-12)
claspect  (two drop downs, like oc_generator)
interests

want to also display other initial stats like interests, initial relationships.

Okay, the individual session summaries (junior) is working beautifully.  Players, Sprites, Interests and Ships.

But...filtering is going to be way harder. Don't want a list of 144 check boxes and then some, right?

So....think.

For number of players, could have a range bar like I do for how many sessions to show. Okay. Solid idea.
Will probably have to redo my "filter" code...dont' even remember how I did it, tho.

As far as interests and sprites, can filter by category?
HelpfulSprites
UnhelpfulSprites
DisastorSprites
FortuneSprites

etc.

Ships...don't even bother filtering. Like, seriously. Unless somebody asks.

Claspect will be the hard one. Maybe display a grid of checkboxes, click checkbox to show only sessions with that claspect?

BUT it's not just about filtering, right, also about displaying uberStats...


think.

Start with the basics.  I KNOW I want to do this by number of players, because that was the initial request. So. Do that. Everything else is a bonus feature that i don't need to do right now.

Okay, the stats look good, and I have the range input for number of players, but it's not wired up.

Without reviewing how I did filtering before, given that right now I ONLY want to filter based on number of players...
What's the best way.

Take the sessionSummaries, and reject any that have a players.length that doesnt' match the chosen value.

That doesn't seem hard, probably can extend javascripts' filter method.

QUESTION: why is the Bard of Heart doing bullshit sidequests when their land level is only 7. And their power fucking sucks.  Shouldn't land quests be a priority???
Goddammit. how long has this been going on? fucking slackig players.

oh. wait. false alarm. they only need a land level of SIX to be done? Who fucking decided that. Okay. did I do that so they fought their denizens more? fuck it, dial the difficulty up. way too much bullshit sidequests.



okay, new problem, why does the thief of space, who did NO frog breeding....do bullshit moon parties instead of their JOB??? why are all these players so distractable?

Huh...apparently players who have finished up their lan quest AND players who have done zero land quests can do moon parties. I know I don't let players do plot shit IMMEDIATELY after entering...how do i judge that?
power needs to be greater than 2. so is this space player just...NEVER leveling up? wth.
No...they end the game with a power of 9. Not, like...great. but not zero, either. Of course, they may have only gotten that high at the last minute.
Okay, maybe make moon bullshit and sidequest give them a tiny power boost.
Ah, no there we go. for bullshit side quests, player1 gets a small powr boost, but player 2 didnt'. fixed.

 I really need to implement that power graph I've been meaning to do.


Alright, no distractions, character creator time.
TODO: (in order)
*  Write a "load fucking everything script". See how long it actually takes/how stable it is. Don't worry about lazy loading until it looks like I need it.
*  Given a session ID/random session ID, render the players to the screen. Take inspiration from how far apart they are on the oc_generator.html.
* have a button that says "start session". when you press it, characters vanish, session starts.
* have the ability to change class/aspect (through drop downs) for each player. confirm can still start session.
* alert error if no space/time player on start. don't let it even start.



What are some things that freeWill can do versus luck?

Free Will:
	* decide to get out of/ into murder mode.  (but not grimdark. if you're grimdark you don't CARE that things won't end well)
	* god tier suicide.
	* kill a murdermode player.
	* Call off the "exile jack" plan.
	* Insist ectobiologist does his goddamend job. (raise their power to min requirement)
	*insist space player does their god damned job. . (raise their power to min requirement)

Good Luck:  (different events have different odds. can have different flavor text, too.)
	*die to trash mobs, but right next to your quest bed (only if god tier destiny)
	*trip over a treasure chest full of sweet sweet grist (boost to land level)
	* accidentally solve a group of consorts problem before you were even aware of it. (boost to land level)
	* find a rare enemy that gives you a BUNCH of exp when you kill it.
	* find out something that makes someone like you a lot more.

Bad Luck:  (different events have different odds. can have different flavor text, too.)
	* die to trash mobs.
	* get grist stolen from you by an enemy (lower land level)
	*accidentally ruin a quest line entirely (lose land level)
	* spend WAY too much time fighting an enemy, only to discover it doesn't drop any loot and you don't level up from beating it.
	* Accidentally say the wrong thing and someone likes you a lot less.



Okay, so, like random lucky/unluck events are easy. You roll a metaphorical dice, and do what it says.

But mind is all about DECISIONS, not luck.

How should I do this? I can't just freeWill lock certain events, because then you'll have a single player doing it every single damn turn.
It needs to be logical...think think think.

ignoring code, how would it actually work? how DID it work for terezi? She was aware of the consequences for NOT killing Vriska, and so choose to kill her when she otherwise wouldn't.

Problems:
	* I am not currently pre-simulating things.
	* It is extremely hard to actually know WHY a given outcome happens. That's the whole point of the YellowYard...it's hard even for humans.
	* not all players care about avoiding doom. some WANT shit to go bad, like Damara.

Now, I can still allow there to be non-luck based randomness. It could account for "this is a complex decision and I'm not going to get into details".

So, as an example...why would a player DECIDE to engage murder mode. Well, for one, they need to hate someone. That's non-negotiable. I guess they also need to not be spades with the person they want to kill.

So, unlike LuckStuff, I can't decide that I'm "lucky or unlucky" at trigger time and then later decide what that actually means. I need to be consistent.  I might be tripping free will, but not have anything I actually want to do.
So, decide what you're going to do at trigger time and store that till render time.




http://purplefrog.com/~jenny/SburbStory/index2.html?seed=47189
bug fix: 47189  trying to break up a relationship that no longer exists after a 3x combo session + yellow yard.

Initial thoughts: wth, that shouldnâ€™t happen. i am CLONING the foreign players especially SO they will show up after a yard.


at first yellow yard, 4 players. Maid of Time, Witch of Space, Witch of Void and Seer of Time. 2 players cloned on arrival. Witch of Void and  Seer of Time.
post yellow yard: 4 players. 2 aliens cloned on arrival. names all seem right.  is it doppelgangers again?

BLUUUUHHHH.




Goal: Have AB not get caught in glitchy, corrupted sessions. She never returns.  The first step was being able to catch session crashing, which I can now do (and print out bullshit about horrorterrors)

problem, session stops ticking after error. this is fine. my error handling code can grab mark a session as corrupt. how can i trigger AB to continue on with the next session?



GrimDark Refactoring TODO:
have stat that is CorruptionLevelOther. have various things raise it. (corrupted land, corrupted sprite, etc.) every 100 points, raise grimDark level tier and go back to zero.
make grimDark 4 level tier, not boolean. 0 is none.  1 = Zero out Relationships. Break game some. 2 = Break game more, small power boost. 3 = grim dark font, grim dark halo, do nothing but break game.


Add grim light corruption as well. think about what this means (do they counter each other?)










okay. let's think this through.

Problem:  AB is returning from a single session EIGHT GODDAMNED TIMES.

Context: I'm upgrading AB to be able to handle scratched sessions. I carefully locked out the various ways she can 'return' from a session to either be through scratching, or through winning, OR through losing a scratched session. At least...I think so.

Okay. turns out I need to check to see if a session was already scratched beofre auto scartching. duh.

but things are weird still. no session scratched, but two extra sessions show up.  session with combo and without are treated separate? and combo is twice. BLUH.

okay. so. what's going on there.

Current Behavior: Look for 1 sesssion. If scratched, renders 3 session summaries. 1 pre scratch, 2 post scratch. What the hell.


if(!session.scratched){
		console.log("scartch")
		session.scratchAvailable = true;
		summarizeSessionNoTimeout(session);
		scratch(); //not user input, just straight up do it.
}

i can confirm the above only gets called once. so...what is happening.  is summarizeSessionNoTimeout calling intro or anything like that?

intro
scartch
intro  *2
victory   *2

So. I am calling "intro" twice for the same session. How?

or...maybe not? not happening here:
start session  find_rare_sessions.js:245:2
intro  find_rare_sessions.js:648:2
scartch  find_rare_sessions.js:292:3
intro  find_rare_sessions.js:648:2
victory or utter defeat * 2

GLAR. Okay. So...is the same session returning multiple ways? look for mvp on print out. !!! That's IT!  MVP is DIFFERENT between the two sessions.


Fuck. What does this mean.


Okay, new tactic. Now for some reason session ID never changes even if hit button multiple times. Why? How? not a scratch.  huh. that might be a regular bug. or a preexisting one. looks like i only set new seed if there is more to do. if only doing one, don't.  is it related?

nope. scratch bug still there even after fixed. bluh.

okay. so. like. sometimes two intros are called.  and sometimes they aren't.  sometimes summary is called twice. sometimes it's not. and it doens't matter if intro was twice.
why might a summary be called BEFORE a session is done. seems to be my "victor or utter defeat" section.

curSessionGlobalVar.won || living.length == 0 || curSessionGlobalVar.scratched
oh damn, THERE it is.  maybe. hold on need to look around.
see, like, that code should only be called during aftermath, which should only be called once. that can't be the problem even though .scratched is a pretty generic thing.


sessions simulated has 3 sessions in it, all with same ID. should only be two.  Pre scratch and post scratch. ....




okay, new tactic. there are two places in the aftermath where the scratch button is rendered.  one if no frog. one if sick frog.  If sick frog, does combo check AND renders scratch button. what does that mean. do i...hide the button if it's a combo instead?
probably a distraction. i see the bug hits even when full frog.

change tactic again. the problem is multiple sessions are going at the same time. Or is it? How to confirm. print when tick?
okay, progress.  It looks like everything goes according to keikaku...but then...when the reckoning tick STARTS the session splits in two. one summarizes immediatly, the other goes into the reckoning. I know scratches can be called prereckoning. what else?

is....is doomedTimeline true? if it were, that might be weird.


oh shit oh shit oh shit. new theory. I'm seeing multiple "should be done" popups. Iv'e been ignoring them as a separate poblem, but very clearly they aren't. think.
before i click the first popup, i see two sessions in the print out.  it's only AFTER clicking it to I see the third session and IT's popup. Which session is wrong. Number 2 or Number 3?
Only one way to find out. actually physically visit the session and see what post scratch looks like.

Oh fuck. NEITHER of them are true. Okay. that's important, too. It would make sense if there were two simultaneous sessions going on they'd be stealing each others random seeds.

only see two sets of reckoning ticks. it's like the second one "finishes" before the reckoning and then starts up the second one?  mvp of second session appears to be the initial values of the session. so...it summarizes itself really early on?

made sure doom gets set right for scratched sessions.
victory or utter defeat  find_rare_sessions.js:368:5
summarizing: 135789202 doomed: false  find_rare_sessions.js:421:2
reckoning tick -11false  find_rare_sessions.js:348:2
no scratch  find_rare_sessions.js:297:3
victory or utter defeat  find_rare_sessions.js:368:5
summarizing: 135789202 doomed: false


so...it looks like it tries to...tick itself again?


...
...
Hypothesis: summarize setsTimeout without updating the session (somehow). tries to tick a mostly done session, which forwards to reckoning tick. cause no more time till reckoning.
no, it really looks like setTimeout for new session never called. but something there feels right. go tak ea walk. get a snack clear head.

Alright focus up, five minutes on the clock, only problems, no solutions.

* it APPEARS that a session is being run twice at the same time.
* three sessions are being rendered, and I only expect 2.
* i know there are multiple ways for a session to be "done". as such, my "time to render a session code" is hard to read.
* two sessions render before a popup, one renders after then genreates it's own popups
* a popup happens when a session is summarized adn there are no more sessions to summarize.
* i make sure to not count a prescratch sessions as towrds the session quota.
* neither post scratch session is "real".
* at least one post scratch session appears to be the initial conditions of the session. no confirmation though.
*a session can be done mid tick, before the reckoning or during it or in the aftermath.
* the repeated session summary claims to be rendering after the aftermath.
* a "scratched" session is the SAME session, just reinited.
* multiple parts of a ticking session can render the scratch button. i dodn't remember evern seeing more than one scratch button, though. do they replace each other???

five minutes are up.
if...if...I render teh scratch button and THEN do the aftermath...wouldn't i get the behavior i'm seeing? it's still the "first session" summarizing itself, but it appears to be the post scratch one 'cause it's already processed.

not perfect. but...i'm getting closer. i see that ticks are interupted by reckoning ticks midway through the first post scratch session. it must 'rescratch' then or something. okay. try....

intro  find_rare_sessions.js:661:2
victory or utter defeat  find_rare_sessions.js:373:5
summarizing: 20729783 doomed: false  find_rare_sessions.js:427:2
tick 28false

So, current observed behavior is intro, immediate AFTERMATH and then summary, and then I start ticking.  This is bass fucking ackwards.
I have a variable called "pleaseIgnoreThisSEssionAB" and it's doing nothing. so. it must be set to true....

progress. aftermath can call a scratch. the next thing the rRECKONING TICK does is check for combo for victory and render summary. see if this fixes it.
how to distinguish between a freshly scratched session a post scratch session. oh. my plz ignore variable.
so frustrated still seeing it.  I have wasted HOURS on this.
problem, can't have new session's pleaseIgnore be false on intro. intro somehow called BFORE i finishe processing after math.fucking asyncronous code.


about to trigger aftermath  find_rare_sessions.js:359:3
scartch  find_rare_sessions.js:292:3
no timeout summarizing: 143713195  find_rare_sessions.js:474:2
reinit  find_rare_sessions.js:311:2
intro  find_rare_sessions.js:661:2
aftermath rendered  find_rare_sessions.js:362:3
checking if i should do summaries  find_rare_sessions.js:368:3
victory or utter defeat  find_rare_sessions.js:374:5
summarizing: 143713195 please ignore: false  find_rare_sessions.js:427:2
tick 13false


k.
just triggering the aftermath is enough to cause a scratch.  even before it renders.  and intro for scratched session called before...before....Fuck.
Okay. this suddenly makes sense.

Sequence of events.  Aftermath triggered. Aftermath begins to render, midway through renders the scratch button which CAUSES a scratch which CAUSES an intro.  async bullshit. then the scratch returns, which lets the aftermath finish rendinger.

How to fix?

How to distinguish between a fresh session and a old one. number of ticks!

fucking FINALLY. AB can do one scratched session correctly. okay. lets see if she can do more than that.

yay. new problem. i think AB is scratching too early or something. maybe need to let the aftermath finish rendering. i don't know. the scratched sessions' she's finding are all wrong.



~~~~~~~~~~~~~~~~~~~~~~~BLUH~~~~~~~~~~~~~~~~~~~~~~~~~~~


Bluh. New brainstorming session. The next feature I want to work on is denizens.
I want denizens to have 'infinite' of their aspects associated stat. will that make them unbalanced? always dodging, for example. always getting a lucky break.  maybe...maybe "infinite" means "1 more than the player has." or something like that? bluh.

in addition to denizens, i want denizen minions (like the typheus minion) to be a mini boss.

if landLevel < 6, then do any of first 6 quests (completely generic). fight minion.  If landLevel < 12, then do any of second 6 quests (3 from class, 3 from aspect).  fight denizen. then, do any of third set of quests. (post denizen). these quests give you fraymotifs. can also get fraymotifs through luck events (isntead of raising power)

so......what's stopping me here? there's no real cognitive challenge. is it just inertia? deniznes won't even be that special 'till i do fraymotifs and i won't do those just yet.

Okay. Step one, make a list of "generic quests" that anybody can do.  Make sure DoLandQuest pulls from them first and not their claspect quests.

wait, no backwards. existing quests are pretty generic, make new ones that reference the denizen. glitch faq had some good examples. denizen fucked over your planet in some way, you have to fix it.


what should I do?

damn. grist might have to be a thing for ultimate alchemy.






Alright, I was in the middle of letting the ghost powers work during battles when it was brought to my attention that yellowYards aren't working as well as I thought they were.

I have confirmed that ghosts are still banned from interacting with the session until the timelines divurge...so....what is different.

First guess would be that the seeds are being eaten differently.  gonna look at the same session side by side, one yarded and one not and see what is different.
I know at first glance the yarded one has a total party wipe, so my hypoethesis has legs.

Yes. very, VERY obviously seeds are different early on. WV is doing different stuff, quests are going randomly different



"The Bard of Time initiates a strife with the Hephaestus Minion.



The fight is over. Hephaestus Minion is dead. "
Whelp. That's what I get for blaming ghosts.

Whelp. Thatâ€™s what I get for blaming all my problems on ghosts like a superstitious oldtimey dude. Looks like the problem is that after a yellow yard, the fucking BOSSES ARE SPAWNING DEAD. And OF COURSE when I tested, I apparently chose the least competent sessions in Paradox Space, so they hadnâ€™t managed to really defeat anything so their session were going pretty much the same even after a reset.








~~~~~~~~~~~~~~~~~~~!!!!!!!!!!!!!!!!!!!!!


slowest thing is swap colors.  what if i kept characters in memory and only rerendered when necessary? Or.........what if...what if I
 rendered each sprite to a dedicated hidden canvas. And then just grabbed that sprite as needed. Each player knows where their sprite lives and knows .....wait.

 wait wait

 Okay.  Base sprite is body, hair, colors, horns, fins, etc. all that shit.

 Render stuff on top of that right? blood, stabs. grim dark aura goes behind.

 So, the only time the BASE sprite changes is:

 *  When you go grim dark (skin color darkens)
 *  When you go god tier ( body changes )
 *  When you are a dream self  (body changes  )


everything else is layers and rotations and.....



.....

it might finally be time to upgrade the rendering engine.




Okay, let's fucking do this. I've long since been hiding canvases. What's 12 more canvases?

Problem: when should the first render occur. If it happens at charcter creation, won't get custom character or easter eggs.  If it happens at intro, what happens
if char is chatting with char this not yet rendered.  if happens in big stupid pile at sesion start, won't there be slow down???

that last one was a question. so. answre it.


Okay: What part of a character is DYNAMIC other than base sprite:

* grim dark aura (but we changed your skin color anyways, so throw that on)
* wings, but we changed you to god tier body anways, so throw that on.
* stabs...but you're dead....if you get revived....think about this.
* MURDER MODE SCRATCHES/SCARS!!! There we go. um.

honestly, probably easier to re-render the sprite at ANY change.  but how to know there was a change? oh wait, that's right
I render to the sprite in the scene or wherever the change happened. drawSpriteNew only called from scenes and only called TO the secret
canvas.






AB has gone a little crazy, specifically with combo sessions. :(

seed=670898551

When viewed by me, does a combo session.

but when viewed by AB, she scratches it before the combo happens, and then reports that the scratched session is a combo session.


To me, this means she needs to not scratch if it's going to keep going.


let's find otu how to make this a thing.

Alright. Let's refresh my memory on exactly how AB scratches sessions.



if it's a combo session, i don't even render the scratch button. Right?  So AB is somehow getting the option to scratch sessions that should be combo.
regular sessions only have scratches be an option AFTER process combined session.

I remember in this very text i was upgraded AB to handle scratches.  So...why did I choose to do things different.  let's review.







~~~~~~~~~OK, AB is acting up.

If there is a sick frog that is NOT a combo session, shes' not scratching.

Need to find out why.   (She is totally sulking about how I told her she can't scratch mid-combo session)

~~~~~~~~~~~~~~~~~~~~~

Huh, the light player is being revived with a mind control symbol, but isn't being mind controlled until the next turn. setting a break point on mind control reveals that they are in fact not yet rendering the revival.

Do i have a stray timeout wandering around?  I am definitely making a snapshot of the light player, should i make one before even calling renderSprite?

light player IS rendered as being mad at the breath player befoer the mind control happens, no mark.

AHAH, yes, stray timeout that ALSO explains why sometimes god tiers would "revive" dead.  that bug is fixed!



~~~~~~~~~~~~~~~~~~~~~

Okay, let's plan this out, sequence of events:

* players edited in character creator
* link generated to send into SBURB (you monster)
* index2.html loaded.
* session.makePlayers called.  makePlayer generates correct number of players, but then replaces them with players from URL.  (IF AND ONLY IFF SESSION.SESSION_ID == PARAM SEED (don't do this for combo sessions you dunkass)
	*  recalculates all things that were part of initialization.  chatHandle. Land. level names.   dont' recalculate other things, like kernel sprite (even if you're a troll now), or relationships.
	*  guardians match players that DID exist, not replayed players.
	* should handle things for yellow yards??????????????????????????????????????????????????????????????????????????????????????????????????????


Alright, let's compare this plan to reality.

scenario_controller2.js has:

curSessionGlobalVar.makePlayers();
curSessionGlobalVar.randomizeEntryOrder();
curSessionGlobalVar.makeGuardians(); //after entry order established

So, if I implemented my change in MakePlayers, then the entry order would get randomized from the char creator. And the guardians would resemble the created characters (do I want that?)

But if I make it by a fourth call, run the risk of forgetting to call it sometimes.  Could have a session far be all "init" and it calls all four?

What does a yellowyard or otherwise reinitialized session look like, just in the controller?

function reinit(){
	available_classes = classes.slice(0);
	available_aspects = nonrequired_aspects.slice(0); //required_aspects
	available_aspects = available_aspects.concat(required_aspects.slice(0));

	curSessionGlobalVar.reinit();
}


function restartSession(){
	$("#story").html('<canvas id="loading" width="1000" height="354"> ');
	window.scrollTo(0, 0);
	initializeStatsForPlayers(curSessionGlobalVar.players);
	intro();
}


function processCombinedSession(){
	var tmpcurSessionGlobalVar = curSessionGlobalVar.initializeCombinedSession();
	if(tmpcurSessionGlobalVar){
		curSessionGlobalVar = tmpcurSessionGlobalVar
		$("#story").append("<br><Br> But things aren't over, yet. The survivors manage to contact the players in the universe they created. Their sick frog may have screwed them over, but the connection it provides to their child universe will equally prove to be their salvation. Time has no meaning between universes, and they are given ample time to plan an escape from their own Game Over. They will travel to the new universe, and register as players there for session <a href = 'index2.html?seed=" + curSessionGlobalVar.session_id + "'>"+curSessionGlobalVar.session_id +"</a>. ");
		checkSGRUB();
		load(curSessionGlobalVar.players); //in loading.js
	}else{
		//scratch fuckers.
		curSessionGlobalVar.makeCombinedSession = false;  //can't make a combo session, so scratch
		renderScratchButton(curSessionGlobalVar);
	}

}

and yellowYard specifically is:
curSessionGlobalVar.addEventToUndoAndReset(null);
and  restartSession (in controller)


Okay. So, it looks like initiazeStatsForPlayers is called on the existing players. But the players themselves aren't remade. So, might not even have to worry about YellowYard?

EMERGENCY:~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~found the source of yellow yard shenanigans.  PLAYERS are being reinitialized, but their sprites are NOT!!!!!!!!!!!
	this is a good opporunity to have a method to reinit all things, including land and levels so that created players can be called with this.
	method should have programtic shit, not random shit. don't re-roll hair, do recalc land.

Okay. things seem to be working. had to stop testing cause stuff. need to reorganize my thoughts.

I honestly think new char creator is working. Just need to test yellow yard. test by changing player hair colors (trolls are an obvious target). should cause the sim to have 0 changes, but be obvious that it's a custom character.




  ~~~~~~~~~~~~~~~~~

  Okay, I finally want to finish AB's corpse party mode. I just made it so she prints out class and aspects like so:

  Witch: 2(17%)
Thief: 1(8%)
Maid: 2(17%)
Seer: 1(8%)
Bard: 1(8%)
Prince: 1(8%)
Rogue: 1(8%)
Knight: 1(8%)
Sylph: 1(8%)
Heir: 1(8%)
Rage: 2(17%)
Breath: 1(8%)
Light: 2(17%)
Blood: 1(8%)
Doom: 1(8%)
Life: 1(8%)
Space: 1(8%)
Void: 1(8%)
Time: 1(8%)
Heart: 1(8%)


My goal is for there to be checkboxes by each of these. Clicking on a check box will filter the AFTERLIFE ONLY to display only those deaths of players that fit the check boxes.

There is a challenge inherit here: existing filters assume you want ALL session data, and are just filtering out whole sessions.

First question: Does a multiSessionSummary know about ALL ghosts within it, or is it just a number?

Sure it does: for(var i = 0; i<this.ghosts.length; i++){

Okay, so. Rather than have a global function like the other filter methods, it would make sense to call a method inside the specific MSS that generated the html.

have generateHTML take in a ghost array rather than use the class one.  when called normally, iti's passed the class ghost array.
when you filter, it grabs all check boxes (How does it know what "all" means?).  If your class/aspect matches a check box you are in (even if it doesn't match another check box.)
ghosts that pass teh filter are passed to generate HTML.

EXCEPT: It would erase classes/aspects that aren't part of the filter, you woldn't be able to add them to the filter. So, classes/aspects keys needs to be hardcoded.




~~~~~~~~~

Okay. I've done a bunch of little shit here and there, but I need to work on AB again.

Feature Goal: MultiSessionSummary lists  out classes and aspects.  Clicking on a check box next to a class or aspect filters the session .......

Wait.

Fuck.

No.

That is too specific. Back that truck up.

Feature Goal:  Be able to determine if certain aspects, classes, or classpects are over or under powered. Be better able to balance SBURBSim.

Forseen Problem:  With the corpse party class/aspect update, Clicking on "Heir" and "Mind" gets me all Heir OR Mind players, which is not want I want. But if I make it be
AND instead of OR, that has additional problems.  For example, clicking on "Mind" and "Time" would get me no players, as it is a logical impossibility.

Before I can move forward on the AB ugprade, I should fix this problem in the corspe party and let it be the basis for the other mode.

So.

Sequence of events:

Click on "Heir".  All "Heir" ghost stats shown.

Click on "Mage".  All "Heir" OR "Mage" ghost stats shown.

Click on "Time".  All Heir AND Time or Mage AND Time ghost stats are shown.

Click on "Space".  All Heir of Time OR Space AND Mage of Time OR Space stats are shown.


That reveals a path forwards. It's two levels.   Within just class or just aspect, it's OR but when both it's AND.

 Don't panic about how lost you are. Find a way to move forwrds and do it. So. What does the code look like right now?

 if($("#"+ghost.class_name).is(":checked") || $("#"+ghost.aspect).is(":checked")){
   filteredGhosts.add(ghost)
 }


 Okay. That makes sense, it's an "OR" just like I thought.


 So. that sequence of events was complicated. What would it look like to get to level 3?

 Well....first of all, I am only checking if the ghosts class_name or aspect is checked. I'm not looking at other classes/aspects.

 So, my "sequence of events" is user facing, not code facing. Redo sequence from the code's perspective.

 Sequence of Events:

 looping through array, I find "Heir of Time."

 Is heir clicked?  Yes. Is Time clicked? Yes.

 Fuck. If I restrict myself to ONLY checking boxes for one ghost at a time, I dont' know that there's an AND.

 Think.

 Okay, open things up a bit.

 I'm pretty sure jQuery can give me an ARRAY of selected. Let's pretend I get that.


2 classes selected.
2 aspects selected.

for each ghost:
  check if ghost class is ANY selected class.
  if so, check if ghost class is ANY selected aspect.

  isnt that...the same code, tho.

ok. new approach.  check ab.

220 ghosts.
Click "Heir", get 16.
Click "Time", get 56.

Want ghosts to be equal to or LESS than 16. Want ONLY heirs of time. Not ALL heirs and ALL time.




If NO aspect is selected....then only class.
if NO class is selected, then only aspect.
If both, AND?



2 classes selected.
0 aspects selected.

for each ghost:
  ghost.class.isSelected?

2 classes selected
1 aspect selected

for each ghost:
    ghost.class.isSelected? AND ghost.aspect.isSelected?


I think...that might be it. I need to know how many of a set of classes or aspects is selected (0 or more than 0).

so, is the html already set up so jquery can get what i need??? No. find where i set names.


if(classFiltered && !aspectFiltered){
  if($("#"+ghost.class_name).is(":checked")){
    filteredGhosts.add(ghost)
  }
}else if(aspectFiltered && !classFiltered){
  if($("#"+ghost.aspect).is(":checked")){
    filteredGhosts.add(ghost)
  }
}else if(aspectFiltered && classFiltered){
  if($("#"+ghost.class_name).is(":checked") && $("#"+ghost.aspect).is(":checked")){
    filteredGhosts.add(ghost)
  }
}else{//nothing filtered.
  filteredGhosts.add(ghost)
}


okay, now just need to actually set classFiltered and aspectFiltered.


Done, and it's fucking working beautifully. I am a GENIUS!!!!

But...am a genius who should probably sleep now and finish upgrading AB in the morning.






~~~~~~~~~~~
Okay, major barrier compared to corpse party mode and regular mode is that the classpect filters have to ALSO be compatible with the regular filters.

Can choose to see all sessions with a Knight of Time and also MurderModes.

Regular properties call a generic "filter" method kept in the rare session finder itself.  So. Claspect filters should do this as well.

Okay. So, classes and aspects aren't wired up seprearte any more, just a simple onChange.


so. next step would be to review how existing filters work and see how to add the new functionality.
don't panic just cause i can't remember how it works. And don't come up with fascinating sounding ways to procrastinate, like fuck around on tumblr or discord.

Okay.


function filterSessionSummaries(){
	var tmp = []
	var filters = [];
	sessionSummariesDisplayed = [] //can filter already filtered arrays.
	for(var i = 0; i<allSessionsSummaries.length; i++){
			sessionSummariesDisplayed.add(allSessionsSummaries[i]);
	}

	$("input[name='filter']:checked").each(function(){
		filters.add($(this).val());
	});
		for(var i = 0; i<sessionSummariesDisplayed.length; i++){
			var ss = sessionSummariesDisplayed[i];
			if(ss.satifies_filter_array(filters)){
				tmp.add(ss);
			}

	}

	////console.log(tmp);
	sessionSummariesDisplayed = tmp;
	printSummaries();
	printStats(filters);
}



So, use my words.
First, I make sure to only grab the summaries that are ALREADY displayed. already match existing filters.

this step might be useless, because I'm still probably gonna look at all filters anyway, not only the one most recent one. But it probably doesn't hurt anything, either.

Okay. What happens next? I look at each checked filter (fucking told you) and.

Wait.

Back that truck up.

Next I Look at each checked box with a name of "filter". This ONLY includes traditional filter shit, not the complicated classpect stuff.
I have a method called "satisifies filter array".  I remember thoth helped me work the logic out on that one 'cause it kept kicking my ass.

Now, before I look into "satisfies_filter_arary".....what happens next?

I call printSTats on FILTERS, but tmp.  "satisfies_filter_array" is called for tmp, not filters.

Why am I passing filters to print stats?   sessionSummariesDisplayed is a global it looks like, is printStats using it???  Why bother passing filters?

var mms = collateMultipleSessionSummaries(sessionSummariesDisplayed);

Okay. yes, it's using the global variable like an idiot, but whatever. it works.  but what about filters? Is that useless code dragged forward by my own laziness?

AH!  Filters is used to decide which boxes should be checked when the session stats are rerendered. Good job pastJR, for not being a complete fucking idiot.


Okay. so. make a note there to also do class/aspect

So.

Backing up, I decide whether or not to add a particular session to the stats by calling satisfies_filter_array.

Would this be a good place to have my new class/aspect algorithm I use for corpse party? Pretty sure that happens on a single session basis?
No, it doesn't. corpse party is just it's own thing. like an asshole.

Okay.


Well, look into satisfies_filter_array.

Options:
* Modify satifies_filter_array
* make new method that is called after satisfies_filter_array
* process classes/aspects in printStats directly. (probably dumb)


I think that the cleanest implementation would be to NOT fuck with satisfies_filter_array, and instead a new method.

Maybe it takes the filtered sessions and then REMOVES any that don't fit the class/aspect filter.

So:

Here's all sessions with a god tier in it.  Return only those with a Knight of Time.

Remember, same alg as corpseParty in that it's one, or the other or BOTH.




	this.matchesClasspect = function(classes, aspects){
		if(aspects.length > 0 && classes.length == 0){
        //???
		}else if(classes.length > 0 && aspects.length == 0){
      //???
		}else if(aspects.length > 0 && clases.length >0){
      //???
		}else{
			return true; //no filters, all are accepted.
		}

	}


  need to fill out that stub, but first wire it up.



  nice. i think I've leveld up at jquery, cause the way i was getting filters before was baby shit comapred to how i figured out how to do it for the fraymotif test page.


  wait. no false alarm, it's the same.





  *GASP*
  There is a problem.  Why is time and space sometimes showing up in MORE THAN 100% of all sessions? Is it a rounding error???


  sessionSummary.js:700:48
Total is: 63and Time is 68  sessionSummary.js:700:48
Total is: 63and Space is 66  sessionSummary.js:700:48

So. Despite there being only 63 session, I think there is 68 sessions with time players in them.

What the fuck.

....oh. it's combo sessions. well. shit. that's not a bug, then.


Fuck.

Shit.

FUCKING HELL.

Okay.

Don't panic.

But it turns out you designed everything terribly because you suck.

You suck so much.

Fuck.

Define the problem.

Despite my best efforts, clicking "Bard" and "Time" does NOT show only those sessions that contain a Bard of Time.

This appears to be because SessionSummaries keep track of class and aspect separately, in hashes.

So,  a Session with a Rogue of Time and a Bard of Light look the same as a session with a Rogue of Light and a Bard of time.

Just because I am displaying the classes/aspects separately doesn't mean that the data needs to be kept that way.

Fuck. Just look at the corpse party, that was using actual ghosts rather than disembodied ghost stats.


Okay. Time for a break.

When you come back, expect to:

* Refactor session summaries to store mini player objects {class: "Heir", aspect: "Time"}, not {"Heir": 0}.
* Refactor MSS to take this into account.  MSS should still have classes and aspects divoruced.
* Refactor SS matchesClaspect to take this into account.


Break obtained.

pffft....okay. One thing at a time.

Store mini player objects, NOT a count of "number of heirs in a session" (which was that source of 120% time player bs earlier, anyways)

huh. mss will have to be refactored too.  Not leave class and aspect divourced. Or...fuck.

Think about this.

FILTERING happens on an individual session level.  All the MultiSessionSummary cares about is printing out stats. It can have separate class and aspect arrays, sure, no problem.

But....how will it count?

Oh sweet, i was smart enough to make them seperate methods, integrateAspects and integrateClasses. pastJR from a few hours ago did a good job.
Fucking nice, that was painless as shit.

Now i just gotta wire up filtering to work with the new system.
I LITERALLY just coded it and yet have to review the code anyways because fuck using meat to remember shit, amirite?

Alright, so, the actual "click the chekc box and a thing happens" is still wired up, 'cauase rendering the html didnt' change any. That just means that
a single session return "true" or "false" as to whether it has the class/aspect/classpect in question needs to be updated.
And then it might work.

Which would mean, what, less than an hour of extra work 'cause of  my mistake. thats not bad. I might still meet my bullshit self-imposed deadline of "tonight" to finish up AB.

Man, I REALLY have leveled up at coding btw. Like. My old shit is monolithic functions that are hard as FUCK to modify and read, but I've leaned towards
little single purpose functions that turn out to be WAY easier to mod. SBURBSim is the gift that keeps on giving.

;alskdfj

Oh. My. Fucking. God.

How is this STILL Happening??? AB is STILL giving me knights OR Blood players when I ask for Knights of Blood.

Is it the algorithm?  Fuck.  Yes. I am doing:

else if(aspects.length > 0 && classes.length >0){
  console.log("returning and")
  return this.matchesClass(classes) && this.matchesAspect(aspects);
}

which still treats them as separate.

That's an easy fix though, and the code being so modular makes it obvious to see that.  pastJR from a few hours ago is WAY better at pastJR from a few months ago.
It took me, like two days to work though pastJR of a few months ago code, and only a few hours to do pastJR from a few hours ago. Although, yes, obstensibly
I should have clearer memories of the more recent code, but this is clearly not the case. This shit is a safari of discovery.

Holy fuck, it looks like it might be working. Now to have AB run through a bunch of sessions to confirim (which is where i found this bug last time)
http://www.threepanelsoul.com/comic/on-infinite-loops  <-- true facts


:/  Can't tell if bug. But....  Having "Heir, Maid" and "Blood" isn't working like I would think it would.
Observation:

Total: 138 Sessions, No filtered
83 sessions with an Heir.  check
115 with an Heir OR a Maid.  check.
3 sessions with an Heir Blood OR a Maid of Blood

7 Sessions with Heir of Blood.
3 Sessions with Maid of Blood.


So.

It looks like things aren't right.  It's not an OR for multiple classes.

Okay.

Well, theoretically I didn't look too hard at the corpse party classpect algorithm once I realized it applied to a MSS and not a SS.

Before I spend time reviewing it, confirm corpse party works how I think.

"Heir,Maid", "Blood" should be bigger than EITHER "Heir", "Blood" or "Maid", "Blood"

Confirmed that corpse party does what I think it should.

Man, I really hope other people's instincts match mine. It would suck to do all this work and other people are all "it doesn't do what i think it should"

Okay.

Review CorpseParty algorithm while trying to acount for the fact that it's acting on a MSS.


In words: what is going on. don't panic that it initially looks like what you are already doing:

have a bool for filtering by any classes.
have a bool for filtering by any aspects.

Loop on all ghosts.
if filtering by only classes, check to see if the checkbox corresponding to the ghosts's class is checked.
if filtering by only aspects, check to see if the checkbox coresponding to the ghosts' aspect is checked.
if filtering by both class and aspect, check to see if checkbox corresponding to BOTH class AND aspect of ghost is checked.


So. Right away I see that my current code can be improved. rather than looping on classes/aspects, can only loop on ghost and check for
existance of class/aspect in array. way more efficient, probably.

But...does it change the algorithm? Think.

Heir of Blood: classes = [Maid, Heir], aspects = "Blood"

CorpseParty algorithm says:

is "Heir" in class array && is "Blood" in aspect array.  YES.

Current Regular Claspect algorithm says:
is "Heir of Blood" Maid and Blood? NO.
is "Heir of Blood" Heir and Blood? YES.

should....be same thing.

Think.  But don't think too long, other way is improvement anyways and if it is somehow "right', then bonus. Can implement the code without knowing how the two are different.

God damn it.

fucking typos.

inner loop was getting aspects[i], not aspects[j].  So, what it was REALLY doing was:

is "Heir of Blood" Maid and Blood? NO.
Is "Heir of Blood" Maid and ...oh, I don't have a second aspect. Done.

fucking hell.

Okay. well. confirm this hypothesis. If it's really the problem, then no reason to refactor code to be slightly more efficient. probably. though bug wouldn't be here if i were smart.
fuck it, no, refactor. futureJR will thank you.

There, way better. single line instead of confusing nested for loop.
if(classes.indexOf(miniPlayer.class_name) != -1 && aspects.indexOf(miniPlayer.aspect) != -1) return true;

~~~~~~~~~~~~~

Okay, it's been awhile since the sim proper has been updated with more than just a tweak. Been doing AB and char creator all weekend.

One thing that effects the sim in a huge way is adding Quardrant dialogue. Especially if it costs a turn to do romantic bullshit like that.

Don't want to have fully hardcoded dialogue like with the intros, though. Nor do I want to redo the entire dialogue engine.
So. I know what I need to do. Bust out the ElderScrolls style "call and response" pairs randomly smooshed together.

Pairs can be about: interest both player have in common, the quadrant they are in, the value of their relationship (like, literal value, to foreshadow if they are close to breaking up).
maybe other stuff too, like jack or a dead player.

You know, it's been awhile since I made a new scene entirely. Not since Luck/FreeWill i think.  It's nostalgic. All full of hope and promise 'cause I haven't actually made it, yet.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Okay. Letâ€™s try to roll our own url solution.


If I did not have any dynamic strings, I could shove all my binary variables into a single variable.


{aspect: this.aspect, class_name: this.class_name,hair: this.hair, causeOfDrain: this.causeOfDrain, doomed: this.doomed, influenceSymbol: this.influenceSymbol, ghost: this.ghost, godTier: this.godTier, victimBlood: this.victimBlood, hairColor: this.hairColor, isTroll: this.isTroll, bloodColor: this.bloodColor, leftHorn: this.leftHorn, rightHorn: this.rightHorn, quirk: this.quirk, isDreamSelf:this.isDreamSelf, murderMode:this.murderMode, leftMurderMode:this.leftMurderMode,grimDark:this.grimDark, causeOfDeath: this.causeOfDeath };



Binary:  doomed, isTroll, isDreamSelf, murderMode, leftMurderMode
Int:  leftHorn (0-46), rightHorn(0-46), hair (0-60) ,grimDark (0-4), favoriteNumber(0-12)

String:  causeOfDrain, influenceSymbol, causeOfDeath

String, but can make int:  Class(0-12), Aspect(0-12), victimBlood(3 bytes), hairColor(3 bytes), bloodColor(3 bytes)

 Object:  quirk  (only fav number for now, can bring up and make int)

Proposal: params (for ghost) look like: i=1932873124987&s=â€nWSZzne4F3RMBBnpMCcX3DcmHEfQwkIAB9Et3BoGIIEIAA6Rxwj0BDdzWO0tkPQhURwZkwDdBg2SuAjuSOP16VSsiHzgSjxWo18QXERilQiFâ€

Where i stores ints and binaries in defined way (i.e. 1 bit for binary, 4 bits for class and 4 for aspect, etc), and s stores the lz compressed comma separated strings.

 Foreseen Difficulty: That is all well and good for ONE player, but how to do arbitrary amount?


Can just concatenate?  Ex: First 52 bits are p1, next 52 bits are p2, next 52 are p3, etc. How to do for strings? Well, they are comma separated, so first 3 strings are p1, second 3 strings are p2, etc.
 Alright.

Need to have a method where I pass it a list of players and a list of attributes and it turns it into  i = numbers&s=encoding.  This way can reuse for ghosts or players or pretty much anything.

No. How would you decode that? Dumb.

Instead, always encode â€œas playerâ€. Yes, afterlife needs LESS variables than char creator, but less likely to be shared.

 So.  Fuck pastJR, and go grab the attributes Iâ€™m using for players, not ghosts before I make my encoding.
But also include ghost attributes, like murderMode and dreamSelf.


var json = {aspect: this.aspect, class_name: this.class_name, quirk: this.quirk, hair: this.hair,  hairColor: this.hairColor, isTroll: this.isTroll, bloodColor: this.bloodColor, leftHorn: this.leftHorn, rightHorn: this.rightHorn, interest1Category: this.interest1Category, interest2Category: this.interest2Category, interest1: this.interest1, interest2: this.interest2  };



Binary:  doomed, isTroll, isDreamSelf, godTier, murderMode, leftMurderMode

 Int:  leftHorn (0-46), rightHorn(0-46), hair (0-60) ,grimDark (0-4), favoriteNumber(0-12)

 String:  causeOfDrain, influenceSymbol, causeOfDeath,interest1, interest2

 String, but can make int:  Class(0-12), Aspect(0-12), victimBlood(3 bytes), hairColor(3 bytes), bloodColor(3 bytes), interest1Category(0-13), interest2Category (0-13)


I format:

Doomed, isTroll, isDreamSelf, murderMode, leftMurderMode, leftHorn, rightHorn, hair, grimDark, favoriteNumber, class, aspect, victimBlood, hairColor, bloodColor, interest1Category, interest2Category

12 bits, 1 bit, 1 bit, 1 bit, 1 bit, 1 bit, 1 bit, 6 bits, 6 bits, 6 bits, 3 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits, 4 bits


So, total of: 67 bits. 9 bytes?  Yes. Do I want zero padding on left or right?  left, I guess.

 Example player:


Doomed: false, isTroll:false, , isDreamSelf:true, godTier: false, murderMode true, leftMurderMode false , leftHorn 13, rightHorn 13, hair 47, grimDark 2, favoriteNumber 3, class 4, aspect 2, victimBlood,2 , hairColor 0 , bloodColor 12, interest1Category 14, interest2Category 12



0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000



000000000000000000000000    001010  001101  001101 0011111 010  0011 0100 0010   0010   1100 1110 1100



00000000000000000000000000101000110100110100111110100011010000100010110011101100

Or

11491338063326444 (base 10)

Or



28D34FA3422CEC (base 16)



275 characters down to 14. That is impressive as shit.
80% reduction in size for integers.  If keep these savings across the whole url (strings donâ€™t compress much, tho), I can expect a url to be ~650 characters long, which is way better.



Of course, that IS with black hair, which is basically free to compress since I shoved it at the front.



Okay.



Now the question is, how good is javaScript at byte sequence generation? I know it can do the << and what not operators, is that good enough? How do I want to code this?


2 bytes: hairColor, favoriteNumber

1 byte: class/asspect

1 byte victimBlood, bloodColor

1 byte interest1Category, interest2Category

1 byte grimDark,isTroll, isDreamSelf, isGodTier, murderMode, leftMurderMode

1 byte  leftHorn

1 byte  rightHorn

1 byte hair

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!WARNING TO FUTUREJR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
the below stuff probably won't work on older browsers. for older browsers, use old url generation????
//https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays
var buffer = new ArrayBuffer(9 * num_players);

var uint8View = new Uint8Array(buffer);

Wait, but I'm pretty sure my compression library uses ArrayBuffers or SOMETHING...does IT work in older browsers or IE?  Yes it does, and has UInt8s. double nice.




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
So tired.....But it's finally time to figure out interests for the replay sessions. At least before I try compressing the url.
Overarching goal:  Pick Interest1 category out of a list of the 14 interersts. Pick actual interest out of second drop down menu that is list of all InterestCategory interests. Same with second interest (4 drop downs total).

Example:

Pick "Comedy" out of interest categories......

Wait.

Better idea.

TWO DROP DOWNS ONLY. And TWO text boxes.  And TWO buttons.

Drop down 1 = InterestCategories
Drop down 2 = interests within that category.
Button1 = set value textBox1 to be value of dropDown2  (Set hidden interestCategory1 to be value of drop down 1)
Button2 = set value textBox2 to be value of dropDown2.   (Set hidden interestCategory2 to be value of drop down 1)
And Text boxes can be edited.

That way can use default values AND allow customization.

Wait. Problem.


If interestCategory1 and 2 are only set implicitly, what happens if player writes in "rap" for interest category 2.  no button press.

No, need two interest category boxes. and two drop down interests bluh. no buttons though.

~~~~~
Okay, the UI problem is solved, now I just have to USE these values.

my objToPlayer code SEEMS to be doing find with whatever I pass it. but the interests still aren't being set.

> Investigate

Two possible sources of lack of custom interests:

objToPlayer isn't getting them
and
they are being overridden by some derived bullshit.

Test: ask objToPlayer what attributes it's handling. Yeah, it's getting it.

Maybe it's not being overridden. This gives me A player, but pretty sure I copy it's attributes over to a different player?

~~~~~~~~~~~
And now to debug my byte generation code. i still feel l337 as shit.  i am leveling the HELL UP.  At the end of this I'll probably be up 3 rungs.

Okay, I am expecting:
1101000010000010000
But only getting:   0000010000

why am I missing ....
huh.

oh.
well.
fuck.
that's obvious now. i must be confusing left shifting and right shifting again.

Okay, I have a 12 bit number. I want only the left most 8 bits.

1111 1111 0000 0000

What I WAS doing is num >> 4. And then being made when it gives me only the ...huh.

Alright, time to review right and left shifting:

My brain says:

Right shifting  1111 1111 0000 0000 by 4 should give me, 1111 1111 0000.   and left shifing by 4 should give me 1111 1111 0000 0000 0000.
What does internet say. It agrees.

So. Stop, think about this.

my unint8 value is CORRECTLY only showing 0000010000, which is to say 8 bits.  Expecting  "1101000010000010000" is a dumb fuck thing to do because that is more than 8 bits. (but the non uint8 print statement is correct for saying that.)

What is the hair color really look like, with no bit shifting.

11010000100000100001010

Okay, how many bits is that? ....23. What the hell? Why? I expected only 12 bits.

Okay. Think about this. WHY did I think it should be 12 bits?  Because...fuck you pastJR.  Because I know that rgb is 3 bytes long and for some reason my brain thought a byte was 4 bits again like a dumb asshole.
BLUH!!! Why are bytes 8 bits if they are grouped in sets of 4!??? And why can't my brain remember this basic fucking fact!???

Okay. So, hair color is 3 bytes WHICH IS 8 * 3 WHICH IS 24 BITS!.  don't shift by 4.

Have 24 bytes, need it to be destributed amont 3 bytes. that's easy baby shit, but it does mean that favorite color has to live somewhere else.  luckily i had exactly 4 bits free in one of the boolean bytes.

huh, apparently "+" has a higher order of operation than "<<". explains my missing data.

Okay, how about decoding the 4+4 bytes (like class + aspect)

1010 1111

>> 4 gets me class (1010).

& 15 gets me aspect (1111)


~~~~
Starting to parse urls and getting random bullshit.
Thinks byte array is 10 bytes long, when it should be 12 x 11.
Oh, i bet it's cuz i used decodeURI instead of decodeURI component.
huh. nope. damn.

What is going on?

b is: Â¿Ã°Ã·sÃ¸Â™U and raw is: %C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12and nonraw is: Â¿Ã°Ã·sÃ¸Â™U

okay, so the problem is it's getting caught on a pound sign, just stop having raw care about that shit.

Still getting caught on something, now thinks is 53 bytes.

%C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12#%C2%AE%C3%99%C3%86%C2%8B%C3%B0%16%10B%25%25-%C2%99=%C3%8Bh%C3%BF3%00Z%19%19%25%C2%BE%C3%A9%C3%A7P%C3%B2%C3%8D%10W%1E%16%09%C3%AE%C3%AE%C3%AE%C2%B2%C3%B8%7D%10X%0A&:%C2%96%C2%97%C3%91%C2%91%C3%B0%19%10%5C(%18%1C%C2%80%C2%80%C3%BF6%C3%BF%C2%B0%00W%15%15&%00%C3%BF%00%15%C3%BF%C3%96%00X%06%06%05%C2%80%C3%BF%C3%BFI%C3%B9%C2%B8%10C%08%08%25%C3%BF%00%00*%C3%BF%16%00Z..%01%C3%BF%C2%80%C2%80%C2%A4%C3%BF%C2%92%10J%20%17%20%C2%80%C2%80%00%07%C3%BF%C3%92%00W%16%16%0F&s=,,Movies,Action%20Movies,,,,Ballet,Leadership,,,,Script%20Writing,Character%20Creation,,,,Fate,Knowledge,,,,Vampires,Archaeology,,,,Musicals,Heroes,,,,Animal%20Training,Stand-up%20Comedy,,,,Geography,Justice,,,,Role%20Playing,Sewing,,,,Mixtapes,Mysteries,,,,Movies,Drawing,,,,Astronomy,Drawing,,

vs
%C2%BF%C3%B0%C3%B7s%C3%B8%C2%99%10U%1B%12#%C2%AE%C3%99%C3%86%C2%8B%C3%B0%16%10B%25%25-%C2%99=%C3%8Bh%C3%BF3%00Z%19%19%25%C2%BE%C3%A9%C3%A7P%C3%B2%C3%8D%10W%1E%16%09%C3%AE%C3%AE%C3%AE%C2%B2%C3%B8%7D%10X%0A

oh. and sign.

okay. now i'm getting all 132 bytes. and MOST of the players are parsing right. but hair is NaN and interests are undefined (probably other things too). What is going on?
given that i already tested charToPlayer, i suspect i'm not passing the right char string.

Okay, the plain text strings should be the easy part, but they are fucking up.

s=,,Movies,Action%20Movies,,,,Ballet,Leadership,,,,Script%20Writing,Character%20Creation,,,,Fate,Knowledge,,,,Vampires,Archaeology,,,,Musicals,Heroes,,,,Animal%20Training,Stand-up%20Comedy,,,,Geography,Justice,,,,Role%20Playing,Sewing,,,,Mixtapes,Mysteries,,,,Movies,Drawing,,,,Astronomy,Drawing,,

p1 = ,,Movies,Action%20Movies,
p2 = ,,,Ballet,

huh, yeah, that's not adding up to 5 for a thing, getting extra commas somewhere.

~~~~
hair color is being ornery. has 6 digits correctly for #000000, but generates: #6780000 instead of #678000, one extra zero. Why?

Huh.

is...that number even a valid hex, am i parsing something wrong?

That's...more than 3 bytes. Why?  Hair color should be exactly 3 bytes big. am i bit shifting wrong?

ah yes, i forgot about order of operations again. gotta put bitshifting in parens before adding

oh shit, it's rendering! There's all humans instead of having some trolls in there, but holy shit!!!

once i figure out the troll thing, can test subtler shit to see if it renders EXACTLY as the base unreplayed session does if all i do is alter hair color.

damn it looks like NONE of the bools are getting sent across. gotta figure out why. always parsing out as zero.

bluh and now interest is undefined???????????????????????????????????????????????????????????????????????????
 i should take a break : ( : ( :(



 ~~~~~~~~~~~~~
 sometimes custom players are spawning dead. infiniteEdge is helping me debug since it's their poor alt character suffering.



 dead:

b=D'%04*%C3%BE%C3%86%00g%01%01%1E&s=,,Programming,Science Fiction,

alive:

b=D'%04*%C3%BE%C3%86%00G%01%01%1E&s=,,Programming,Science Fiction,

from him:

b=D'%04*%C3%BE%C3%86%00(%01%01%1E&s=,,Programming,Science Fiction,

b=%C3%BF%C3%BF%C3%BF*%C3%BE%C2%AD%00(%20%20%1E&s=,,Automation,History,

dead is â€˜gâ€™   103

alive is â€˜Gâ€™  71



from him is â€˜(â€˜ 40

all 3 differ only on character 7.



What is difference.



Creation: 	 uint8View[7] = (json.robot << 7) + (json.moon << 6) + (json.dead << 5) + (json.godDestiny <<4) + (json.favoriteNumber)


favorite number is 4 bits.

automation? have code that generates all 255 possible values for the 8 bits, and tells me if it ever isnâ€™t the same going as coming.





CONFIRMATION.  Doing "Mage of Hope, hair type 30, species human, moon prospit, blood colour #ff0000, favourite number 8, godDestiny ticked in check boxesâ€
with "interests, which were programming and science fictionâ€ results in a url being generated that contains a dead player.

So. what is the important part in all that. what is killing it.

Also, maybe unlrelated, but check boxes arent being loaded right.




Shit. If your favorite number is 8, you die. 0 and 9 turn you to robots.

9 is: 1001 robot
8 is: 1000  dead
7 is: 0111  alive
6 is: 0110 dead
5 is: 0101 dead
4 is: 0100 dead
3 is: 0011 dead
2 is: 0010 dead
1 is: 0001 dead
0 is: 0000 robot


Shit.

Wait.

No wonder I'm not seeing a consistent pattern. DIFFERENT THINGS HAPPEN TO DIFFERENT PLAYERS.

Next player down in list turns into a robot if their favorite number is 8. not dead.

So....is the problem changing favorite number? not the raw value?

~~~~~~~~~~~~~~~~~~~~

Alright. I need to focus. I'm so busy with the Discord I'm not coding right now. I KNOW I can finish teh fan viewer (if not the fan sessions) today.

So.  I need to do:

* pagination
* text areas next to chars.

2nd is much easier than first. so. start it so you get an easy win which builds momentum. make sure display != none. make sure display: inline-block

okay, now for paginations.

i've done pagination before, but how do i want to do it here. 12 players at a time? yes, that's a nice number.
But, is there really a POINT to hiding the previous players? no rendering cost for showing them. and it's not as if i can keep everything on "one screen", as it were.
So, instead of pagination, it really should be "render the next 12 players."

Only want one helper.

No input.


So...

make a renderNext12Players()
function, and keep track of current player index.

~~~~~~~~~~~~~~~~~~~~~~~~
Okay, I am vague on HOW i want to do urls to put fan ocs into sessions. Think about the PROBLEM (not solutions) for 5 minutes on the clock:

PROBLEM:

What do I hope to achieve...

I want there to be an easy way for people to say "this group of people i am looking at? throw them into a death game.".
I ALSO want it to be easy for the Authorbot to do so as well. Both for tourneys and to use those OCs as a way to test the data string mechanism in general, at least for crashes.

The system MUSt be easy to use, and easy to modify (can pick a session with reddit+canon ocdatastrings init, for example.).

I'd want the system to use the existin architecture of 'load ocs from a text file' because i find that system to be VERY easy to add ocs to, nlike the hall of fame with [???].
I theoretically could do that OC thing forever, or even automate the process with a small server somewhere.
One useful part of those datastrings is that the user editable strings are kept in plain txt, I can easily see if somebody put something in approrpirate or full of attempts to break the sim before doing anything.
So, before i focus back up, automation IS a perfectly valid thing to pursue in the future.  Just have the system put the strings in tmp files that I have to review with my organic brain before adding to the server.

Okay
Not focus up.

So, a 'good' solution is easy to use, modifiable and uses the existing architecture. Anything else? Don't think about solutions, think about requirements...

maybe additional ways to modify...like "allow repeats" or session size between 0 and 12? I consider those less important.

Okay. Times up.

NOW that the problem space is well defined, 5 minutes of thinking of solutions.

Solution:

Okay, most obvious solution is to have the character_viewer generate data_string urls just like the SessionReplayer does. It would pick which players go into it, and NO other page would need to know about the saved text.

Pros:  Don't need to modify other pages at all.
Cons: How would I do a tournament arc/give AB random sessions based on these?

That's a PRETTY big con. And the pro is about avoiding work/possible sources of bugs, which...isn't that big a pro.

The next most obvious solution is to have the debug scrpt (which has transformed into an easter egg script) handle the oc data strings.

Just like the viewer, it would load the text files asynchronously, and then ping the scenario_controller2 or the rare_session_finder which would then take the loaded players and do stuff with them.

Pro:  Allows AB to know about data string sessions just like she does about trickster or rumpus=fruity sessions etc.

Con: Would be tricky. How would I prevent the existing scripts from continuing until the easter egg is loaded. Should it ALWAys pause until returned?  would both scripts have the same callback method once it's done (i just answered my own question, use a callback.)
	Modifying the sim in order to use an easter egg is a big 'no'. Its a bad idea.  But it's not a very big mod.


Okay.That was 5 minutes. I did'nt come up with any new solutions on top of what I already had in my head.  I did manage to put in words why I like solution 2 over solution1, even though it violates
my principle of "don't fuck with the sim for easter eggs.".

So, IF I were to make a small refactor to scenario_controller2 and rare_session_finder, I would need to have their initial methods STOP with asking about easter eggs, and have a callback to resume.
ALL easter eggs should call that callback, and the resume method should have everything that used to be after the easter egg check.

Forseen problem: I am pretty sure rumpus=fruity and similar easter eggs are called TWICE, once before initializing and once after (to blow away derived values that don't match the characters.)
I plan on refactoring it eventually, so 'carcinoGeneticist' isn't re-derived any more than 'jadedResearcher' is.   IS THIS ALREADY HAPPENING?

Current goal: look into code, see where I'd need to convert to call backs, and also see if double calling easter eggs is still necessary.

Sequence of Events:
startSession
	checkEasterEgg();
	initializePlayers(curSessionGlobalVar.players, curSessionGlobalVar); //will take care of overriding players if need be.
	checkEasterEgg();
	checkSGRUB();

	load(curSessionGlobalVar.players, curSessionGlobalVar.guardians); //in loading.js



Analysis: It seems really easy to just put checkSGRUB() and load() into a callback. initializePlayers, too, if I can confirm it's not overriding custom things.


GOAL: make checkEasterEgg() called only once, before initialization.
GOAL: make checkEasterEgg() load random smattering of Fan ocs, if appropriate easter egg is active.
GOAL:	should it replace them in checkEasterEgg and derived functions, or should it somehow convince 'initializePlayers' that it was a replay string in the url (or similar, such as a var set on session). (2nd seems better, don't have to load ocs in 2 separate places).
GOAL: have everything after checkEasterEgg in call back that is passed to checkEasterEgg(); regular easter eggs call callback at end, Fan OCs call it when players are done loading.



Working on: GOAL: make checkEasterEgg() called only once, before initialization.

Is player.reinit() ever called, or has it been replaced with initializeDerived???
Yes. it's called. BLUUUUUH.

BUT, seems to ONLY be called by guardians. Can do better.  Get rid of it and ONLY use initializeDerived. Now there's only one place I care about.

Need to say "if chatHandle == "", derive, otherwise don't".  How am I doing this for session replaying?

if(this.deriveChatHandle)  well. THAT's going to be easy. Just set that for the trolls/humans/etc in the playerTo413index or whatver.

HELL YES! It is working! Now just make sure AB only calls it once as well. also for scratches.
confirm ab agrees with reality and both can scratch. ooo, and 612 is a yard, too (equius is only surivor and was black for nepeta).
 so. test that.  oh shit, and scratched 612 was a combo session where only cronus and mituna made it to the new session. which grim dark crashed.

 Shit. wait. quirks are broked. need to fix. shit, and yellow yards. hopefully only for easter egg sessions.

 wait. no. false alarm. it was robo aradia's fault becaue of true random. dang. oh well.

 alright, quirks are ready.

 next Goal:  GOAL: make checkEasterEgg() load random smattering of Fan ocs, if appropriate easter egg is active. o
 nly load those player categories that i need.  if no space/time in all potential use generic one. always choose space/time player using findAllAspect players.  2-12 players chosen.
 ~~~~~~~~~~~~~~~~~~~~
 Okay. I have three problems that MIGHT be related.

 Characters loaded from Fan OCS are not able to render themselves, can't find their canvas.
 Blank Space players hae no chat handle.
 EVERY CHARACTER (hundreds)is in the playerSprite div, not just the ones I want to render.

 Try to fix third problem first. clear that div out once i have my pool.
 Wait. No. will clear out "real" players, which the replayers are going to overwrite.

 Okay.

 Find out WHY they are rendering. Does loading a player do that?

 Oh shit.

 Oh fuck.

 It's HAPPENING ALL THE TIME. Even if not in easter egg mode. FUCK!

 Okay. I see that I have code to create the canvas if i try to render and don't have one, but that I am ALSO creating a canvas every time I intiialize derived stuff. dumb. try not doing that.

 Hell yes, way better. now not all cloggy.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Fuck fuck fuck fuck fuck.
Yellow Yards are broken, even on main branch.
Fuck.
Okay.
I know what hte problem is.

The problem is that I had to refactor the easter eggs to handle callbacks so that the oc fan easter eggs would work.

And the yellow yard can't handle that.

Look at the code, don't panic, and don't make assumptions:

Code is:

this.addEventToUndoAndReset = function(e){
		//when I reset, need things to go the same. that includes having no ghosts interact with the session. figure out how to renable them once my event happens again.
		this.afterLife.complyWithLifeTimeShenanigans(e);
		//console.log("undoing an event.")
		if(this.scratched){
			return this.addEventToUndoAndResetScratch(e); //works different
		}
		if(e){//will be null if undoing an undo
			this.yellowYardController.eventsToUndo.add(e);
		}
		//reinit the seed and restart the session
		var savedPlayers = curSessionGlobalVar.players;
		this.reinit();
		createScenesForSession(curSessionGlobalVar);
		//players need to be reinit as well.
		curSessionGlobalVar.makePlayers();
		curSessionGlobalVar.randomizeEntryOrder();
		curSessionGlobalVar.makeGuardians(); //after entry order established
		checkEasterEgg(); //in the controller.
		//now that i've done that, (for seed reasons) fucking ignore it and stick the actual players in
		//after alll, i could be from a combo session.
		//but don't just hardcore replace. need to...fuck. okay, cloning aliens now.
		curSessionGlobalVar.aliensClonedOnArrival = this.aliensClonedOnArrival;
		//console.log("adding this many clone aliens: " + curSessionGlobalVar.aliensClonedOnArrival.length)
		//console.log(getPlayersTitles(curSessionGlobalVar.aliensClonedOnArrival));
		var living = []  //if don't make copy of aliensClonedOnArrival, goes into an infinite loop as it loops on it and adds to it inside of addAliens
		for(var i = 0; i<this.aliensClonedOnArrival.length; i++){
			living.add(this.aliensClonedOnArrival[i])
		}
		this.aliensClonedOnArrival = [];//jettison old clones.
		addAliensToSession(curSessionGlobalVar, living);

		restartSession();//in controller
	}


	Shit, isn't there a scratch versio of that, too?

	One thing at a time.

	So, problem is:


	checkEasterEgg(); //in the controller.
		//now that i've done that, (for seed reasons) fucking ignore it and stick the actual players in
		//after alll, i could be from a combo session.
		//but don't just hardcore replace. need to...fuck. okay, cloning aliens now.
		curSessionGlobalVar.aliensClonedOnArrival = this.aliensClonedOnArrival;
		//console.log("adding this many clone aliens: " + curSessionGlobalVar.aliensClonedOnArrival.length)
		//console.log(getPlayersTitles(curSessionGlobalVar.aliensClonedOnArrival));
		var living = []  //if don't make copy of aliensClonedOnArrival, goes into an infinite loop as it loops on it and adds to it inside of addAliens
		for(var i = 0; i<this.aliensClonedOnArrival.length; i++){
			living.add(this.aliensClonedOnArrival[i])
		}
		this.aliensClonedOnArrival = [];//jettison old clones.
		addAliensToSession(curSessionGlobalVar, living);

		restartSession();//in controller



everything afer check easter egg HAS to be in a callback because checkEasterEgg is now asyncronus.

BUT, if I try to make one, it fucks with 'this' and i can no longer do things like 'this.aliensClonedOnArrival'.  (I know this because i tried this.)

think.

Is there a way to pass "this" in a callback?  Off the top of my head I can pass both callback and 'this', and just have everyone else ignore it. I could also keep 'this' in a global var like a chump.

Let's try to first idea first.

Whew, fuck, okay, stop panicking 'cause that worked. look at me knowing how to deal with "this" breaking.



~~~~~~~~~~

Designing AB upgrades to allow her to do the tournament.

Noticed that ABJUnior uses "callback" and AB uses "callback restart" and don't know why. but...they seem to be working???

check if abj is sane and if abj can handle scratches without lying. Yeah, they are fine.

Okay. So, back to original problem.

I need to pass AB a callback so she'll return the results of a simulation to me instead of processing it. But she is ALREADY using callbacks for easter eggs.

Now. I can make the entire easter egg take ANOTHER call back. but that seems...wrong, and brittle.

I could store my callback in a global variable. (polluting that name space should be a last resort, but WOULD be easy.)

So, first step is research my options here on the googles.

~~~~~~~~~~~
okay, don't get ahead of yourself. AB is giving you results back. but not hte right results.  I need to be able to process an easter egg EVEN from not a param. so.
let's do this shit.  probably only need it from the "stuck" category. but...maybe from more than that.
maybe getParams itself will be moded to also check global vars.
param is the easiest place to put it, though it might be weird to have it git url vars and non url vars. but would work for ALL easter eggs.
could theretically run trickster tournament that way.

ah wait, the "stuck" stuff doesn't even use getURL vars, that's right.

cool.
easier.




~~~~~~~~~~~
It seems like any character that is stored as an ocCharacter in the text files loses any binary character that is "(" in ascii, casuse of chracter corruption.
Where is it loosing it? It appears to be correct when i call standard char processing code.

parsing one char, fine, parsing array, some are corruptionnnn....




expect 88 X11 =968 bytes, getting 966.  two bytes are being eaten before  dataBytesAndStringsToPlayers


ultimate breeder....appears to have 10 bytes, not 11. see if it ends in the mssing "("

Yes, it does.

So, "(" isn't the problem, Ultimate Breeder is problem, not enough chars. look further.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Alright, planning out new classpect stats unit testing plus fraymotif combob.

5 minutes on the clock, go:

I want for each fraymotif to be clickable. When you click it, you see the list of the players invovled in the fraymotif, and their stats underneath them.  Clicking a player name increases their power (unit testing for that).

There should also be a button for "use fraymotif".  There should be a "Dummy" game object that has it's own stats displayed, so you can see how they are reduced
(by the way, should strife title have hp/maxHp listed???)

clicking use fraymotif button should apply the fraymotif to the gameEntity.  Fraymotifs are ONLY USED in teh context of strifes with a game entity.


QUESTION: SHOULD I REFACTOR STRIFES TO BE THEIR OWN OBJECT, SEPARATE FROM GAME ENTITIES (that way can have two playes strifing each other).

What else... fraymotifs can raise our stats, lower the enemies stats...  (no longer am i trying to pretend stats can be good or bad and raising/lowering is equal).  fraymotifs can do damage (either a base level, or base plus associated stats)

Which reminds me FRAYMOTIFS SHOULD USE ASSOCIATED STATS, and a new, similar kind of object called "buff". A buff should have a stat name, and a value.

If I'm a Prince of Breath, and I find a fraymotif, that fraymotif can buff or debuff an enmy for ANY of my ASPECT originated associated stats. My class will determine exactly what happens, though???

Should class give you modifiers to buffs/debuffs and damage/healing?  This makes sense.




~~~~~~~~~~~~~~~~~~~~~~

Trying to upgrade the ShippingGrid shit.

Current State: heart OR blood players can run shipping grids, and will speculate that any currently non-quadranted-but-interested-in-each-other
pairs as being either conicillitory (blood) or concupisience (heart);  Once they are officially quadranted, though, they'll reflect resetPlayersAvailabilitya
adequately.

GOAL:  A shipping player will note any "requited" crushes and push them into going into their favorite relationship type together.
If it's a blood player trying to do ashen, the blood player is the middle leaf.  concillitory town two wheel devices that they are.

When they try to push them into a quadrant, 30% chance they will go into the quadrant they WEREN'T pushed into (flushed if blood player, for example.)

Either way, shipper will comment on it and get a huge bonus if it was their chosen ship.

can only create one ship at a time, and only when they can otherwise update their shipping grid.

now, think about this awhile.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
oh shit.

time for my first post-dart ramble.

AB is not returning  from all sessions.

She prints:

"Starting session 52369603
 VM942:1 Starting session 404506237"

 and i can see that the session she ends on does not match the only session she summarizes.

 So, she DOES do the next session, but doesn't summarize it.

 I note that she DOES summarize the next session if it's a crash or a scratch.  Except the session she finished on is a grim dark crash.

 So. the first think i need to look for is what places does AB call "summarizeSession" from, which is gonna be much easier in Dart than in javascript.

 I see it in:

 *process combined session
 *reckoning
 *reckoningTick
 *recoverFromCorruption
 *scratchAB


 The one that SHOULD be most common, that I think I am not seeing is reckoningTick

  if(curSessionGlobalVar.won || living.length == 0 || curSessionGlobalVar.scratched){
           ////print("victory or utter defeat");
           summarizeSession(curSessionGlobalVar);


  }
  I'll see if it ever gets just above that if statement....

  I'll run the code, but right now what has me worried is that the code itself seems weird. what happens if that
   if statement is wrong? it doesn't seem to scratch....but it does seem to match js code. i guess scratch haappens just above it.


That else i added is literally never printing out. what the hell. So...is it stopping in a timeline doomed even before the king fight?

It doesn't seem like it....


oooo fuck. wait, nevermind.

VM46:1 debugging AB: reckoning tick for 3725716184
VM46:1 debugging AB: about to see if i should summarize session 3725716184
VM46:1 debugging AB: victory or utter defeat in session session 3725716184
VM46:1 debugging AB: reckoning tick for 4218245970
VM46:1 debugging AB: about to see if i should summarize session 4218245970
VM46:1 debugging AB: victory or utter defeat in session session 4218245970
2VM46:1 debugging AB: reckoning tick for 1976868187
VM46:1 debugging AB: about to see if i should summarize session 1976868187
VM46:1 debugging AB: victory or utter defeat in session session 1976868187
4VM46:1 debugging AB: should never get here 1976868187

so 4x AB should never get here at the end... okay, let's run a few more sessions see if that's always why she stops.
(and also, session id matches the one for "victory or utter defeat")...might just mean i was wrong
that ab can't get there. look at that first...yeah, didn't have a return statment after summarize)

Yeah, that was a a false positive. more debug statements.

Debugging AB: Starting session 2947509373
VM130:1 debugging AB: reckoning tick for 2947509373
VM130:1 Debugging AB: Summarizing session 2947509373
VM130:1 Debugging AB: Starting session 3168072245
VM130:1 debugging AB: reckoning tick for 3168072245

so it does reckoning, but nothing else....okay, back to there.

okay, same set of sessions, more debug statements:

Debugging AB: Starting session 2947509373
VM174:1 debugging AB: reckoning tick for 2947509373
11VM174:1 Debugging AB: reckoning tick in session: curSessionGlobalVar.session_id
VM174:1 Debugging AB: Aftermath in session: curSessionGlobalVar.session_id
VM174:1 Debugging AB: Summarizing session 2947509373
VM174:1 Debugging AB: Starting session 3168072245
VM174:1 debugging AB: reckoning tick for 3168072245
11VM174:1 Debugging AB: reckoning tick in session: curSessionGlobalVar.session_id
VM174:1 Debugging AB: Aftermath in session: curSessionGlobalVar.session_id

nothing looks wrong.  Look at aftermath more closely

Okay. I notice I am confused. AB is in the aftermath and somehow does NOTHING in it. none of the paths
are lighting up.

make a debug stament RIGHT after that aftermath line.

...I see nothing. Either that print sttment has a copy somewhere....or the srver needs restarted.
The vm doesn't let me see wehre these print statements are coming from, so look for the words in source.

also restart server just in case. yeah, that did nothing. okay.

a search of source reveals no others and also...changing the content of that debugging line shows up.
Is it...CRASHING between the lines? fuck. why is it not being caught.can only one crash be caught per page or some shit?

Okay, that aftermath was a false positive. there's plenty of non-aftermath sessions she's not returning from. yes,
it can be important to focus on specific results but...what do they have in common.

Some of them end on a crash. Haven't seen more than 1 crash ever, but have seen zero crash.
So that debunks my "can only recover from a crash once" hypothetsis.

Okay, here's something I haven't tried.  Is it something to do with SESSIONS, or with AB.
Take a session that dies, and run it as the first session she tries.

Fuck okay, that gives me interesting results.

AB took a session that stopped her previously, and ran 4 new sessions from it.
The session that stopped her was  crash.

Try again.

Ended with: Debugging AB: Starting session 3985658339

then put that as the first session and...

Debugging AB: Starting session 3985658339
VM371:1 Debugging AB: corruption msg in session: 3985658339
VM371:1 Debugging AB: trying to recover from corruption now.
VM371:1 Debugging AB: Summarizing session 3985658339
VM371:1 Debugging AB: Starting session 1128973609


so is the final session always corrupt?  again



Debugging AB: Starting session 1128973609
VM401:1 Debugging AB: corruption msg in session: 1128973609
VM401:1 Debugging AB: trying to recover from corruption now.
VM401:1 Debugging AB: Summarizing session 1128973609
VM401:1 Debugging AB: Starting session 2919195549
VM401:1 debugging AB: reckoning tick for 2919195549
11VM401:1 Debugging AB: reckoning tick in session:  2919195549
VM401:1 Debugging AB: Aftermath in session:  2919195549
VM401:1 Debugging AB:made aftermath session:  2919195549
VM401:1 Debugging AB: triggered Aftermath in session:  2919195549
VM401:1 Debugging AB: done with Aftermath in session:  2919195549
VM401:1 Debugging AB: not a combo in session:  2919195549
VM401:1 Debugging AB: going to scratch in session: curSessionGlobalVar.session_id
VM401:1 debugging AB: reckoning tick for 2919195549
11VM401:1 Debugging AB: reckoning tick in session:  2919195549
VM401:1 Debugging AB: Aftermath in session:  2919195549
VM401:1 Debugging AB:made aftermath session:  2919195549
VM401:1 Debugging AB: triggered Aftermath in session:  2919195549
VM401:1 Debugging AB: done with Aftermath in session:  2919195549
VM401:1 Debugging AB: not a combo in session:  2919195549
VM401:1 debugging AB: about to see if i should summarize session 2919195549
VM401:1 debugging AB: victory or utter defeat in session session 2919195549
VM401:1 Debugging AB: Summarizing session 2919195549
11VM401:1 Debugging AB: should neever get here, should be combo or scratch or victory or SOMEThing.
VM401:1 debugging AB: should never get here 2919195549
10VM401:1 Debugging AB: should neever get here, should be combo or scratch or victory or SOMEThing.
VM401:1 debugging AB: should never get here 2919195549



whoa, that's new. don't normally get to "should never get here" and it got there....twice?
and the session it ended on WAS corrupt...

first, look into "should never get here".

Okay, that could be on me. looks like if they manage to reckoning tick they'll get to at least one of those.

I finally got one that freezes stand alone AND with multiple.

no crash.

2919195549


it prints out:

Debugging AB: Starting session 2919195549
VM469:1 debugging AB: reckoning tick for 2919195549
11VM469:1 Debugging AB: reckoning tick in session:  2919195549
VM469:1 Debugging AB: Aftermath in session:  2919195549
VM469:1 Debugging AB:made aftermath session:  2919195549
VM469:1 Debugging AB: triggered Aftermath in session:  2919195549
VM469:1 Debugging AB: done with Aftermath in session:  2919195549
VM469:1 Debugging AB: not a combo in session:  2919195549
VM469:1 Debugging AB: going to scratch in session: curSessionGlobalVar.session_id
VM469:1 debugging AB: reckoning tick for 2919195549
11VM469:1 Debugging AB: reckoning tick in session:  2919195549
VM469:1 Debugging AB: Aftermath in session:  2919195549
VM469:1 Debugging AB:made aftermath session:  2919195549
VM469:1 Debugging AB: triggered Aftermath in session:  2919195549
VM469:1 Debugging AB: done with Aftermath in session:  2919195549
VM469:1 Debugging AB: not a combo in session:  2919195549
VM469:1 debugging AB: about to see if i should summarize session 2919195549
VM469:1 debugging AB: victory or utter defeat in session session 2919195549
VM469:1 Debugging AB: Summarizing session 2919195549


...There are TWO aftermaths for the same session. Is this normal?  Oh, it scratched.

huh.

and i have code that says "if you already saw this session, don't do anything with it."
maybe that code used to be broken? what if i just....commented....it out?

~~~~~~~~

Okay, fresh day, fresh start. What is AB doing right now.  Okay. Crashing on the "Type GameEntity is not subtype of Player" thing
I thought PL talked me through fixing. Restart server.

Alright,I found a session where this is happening:

Debugging AB: going to check for combo in session: 2094419576
VM52:1 Debugging AB: Checking process combo session


even though I theoretically have the two paths in combo session printing shit, neither thing happens.
Stop trying to find a single cause, just start putting out fires.

 if(newcurSessionGlobalVar){
 ...
 ...
 ...
 pastJR, you dunkass. that's not a bool and dart cares about shit like that.

 There is a chance that this is it, the bug I've been looking for. If she even CHECKS for a combo session she'd crash.
 But of course, all my notes from last night don't show that she always ends looking at combo. Bluh. Still. Progresss.

 Woo.

 She made it one whole extra session. Godddamit. Clearly there is more.

 (btw, seed i was testing was 3855200721)

 Alright, new problem is starting session 3067887099.  It starts, and then I never see anything else print out,
 not even the Reckoning.   Should I be as annoying as to check for ticks?

 ~~~
 okay, hell fucking yes, AB is working.
 But still isn't filtering because I made the filters inline and need to fix it.
 So.
 What now?

 i know i got those "todo" printouts, so go find them.  heh, intellij, this is a text file, why turn blue.
There it is, in session summary.



for checkboxes, the method is
onchange='filterSessionSummaries()

i do the same thing for every filter. can i make them all a class and just have all of them have the same onchange?
how do i normally grab all the filters?

okay, what about the toggle buttons, i think that just sets a formerly-global-variable?



Open Questions:
* How do I normally get "all the filter checkboxes" and can i leverage it to give them all the same onchange?
*  How do I get the toggle buttons?

~~~ookay...
SOMEtIMES filters are working.

debugging ab: I think i have found this summaries after removing non matching claspects: 5
VM302:1 debugging ab: I think i have this many session summaries: 2

~~~~~~~~~~~~
Alright, let's define the problem, no panicking:

On the character viewer page, a single character is rendered, and then a bunch of data boxes.

If I go to the html, the mouse over says that other divs that would contain canvases are 0x0.

All the canvas divs appear to be identicle at first glance.  Examples:

<canvas id="canvasSummarycanvas0" width="600" height="300">  </canvas> <-- shown

<canvas id="canvasSummarycanvas1" width="600" height="300">  </canvas>  <-- not shown


What about the parent divs?

<div class="standAloneSummary" id="createdCharacter0"><div id="canvasSummary0" class="optionBox" style="display: block;"><canvas id="canvasSummarycanvas0" width="600" height="300">  </canvas></div></div>

<div class="standAloneSummary" id="createdCharacter1"><div id="canvasSummary1" class="optionBox"><canvas id="canvasSummarycanvas1" width="600" height="300">  </canvas></div></div>

Okay, right away for free I see they are different lengths.  Where is that coming from?

 style="display: block;"

 ...
 ...
 ...

 Why...

 Okay, well, I know where to focus my efforts now.

 Initial creation is:
 str += "<canvas id='canvasSummarycanvas${player.id}' width='" +width.toString() + "' height='"+height.toString() + "'>  </canvas>";

 Let's think. Would I be calling show/hide on individually summaries?  For the viewer itself,
 I am literally only rendering only 12 at a time, no showing or hiding.
 But....for the char creator I am showing/hiding tabs. Is something like that happening?
 Put an alert on the show/hide methods.

 Okay, well, I thought it was obvious I was calling show/hide. But....nothing.
 BUT I do get a 4x showing combo...so. What is up with that?  All of the shows are for canvasSummary0, the one visible one.

 Break point seems useful here.

 Okay, drawSinglePLayer summary makes sure to show.

 		show(querySelector(".optionBox")); //unlike char creator, always show

But... it's only calling it on the data?

Okay, extra logging has revealed whole new classes of future problems, but let's focus on this.
that "show" is being called on a class, and apparently in Dart it only gets called on the first member of the class
not every member of the class. how droll.

I still don't know why things are defaulting to being hidden, but I do know how to fix this.
~~~~
Okay, that is done. Two problems remain:  Only the Creators are being loaded (oh yeah, need to add PL to that list)
and also everybody is sideways (and thus corrupt).

~~
Okay, the sideways thing was hella easy. it was just that chars were sideways unless causeOfDrain was null, and it was "" and not null.

~~~

Now for the hard part, nothing is loading from file.

Huh, okay, maybe not so hard, logs say that things are actually being read from file, so, what's the problem here?

*gasp* I bet it's the arrays. I was doing meta shit, I remember now.

  void parseFileContentsToArray(arr, fileContents){
    //this[arr] = fileContents.split("\n");
	  //TODO: parse machine broken -PL

    ////print(arr);
    ////print(this[arr]);
  }


  ~~~~~

  Okay, figuring out how to select elements in dart is annoying. And the render players to url is getting "JSON is not string" kinda deal.

  Haven't tested creating or destroying players, either.



  TODO:
    *  Render Url Doesn't work
    *  Test Create/Destroy Players
    *  What the fuck is up with Right Horn? Form isn't initing and changing doesn't change sprite.
    *  Make sure all elements work.
    *  Test loading a char.
    *  convert from inline CSS to stylesheet files (maybe, looks like it's actually working)


    Right horn:  It LOOKS identicle to left horn. If I comment out this line, it is fine, but the underlying value is still blank:
(querySelector("#rightHornID${player.id}")as SelectElement).value = (player.rightHorn.toString());







  lololol

  Okay, well, now it's not a mystery.  Time to figure out how to do this right. Hash map this bitch maybe?




~~~~~~~~~~~~~~~~~~~


Okay. Time to find my zen.

I banged my head for too long on AB's filters, then gave up and did other pages.

But now AB is standing between me and being mostly done with this shit.

Define the problem:

* EVERY time I click "timesAllLived" it works as intended.
* clicking other things, like 'ectoBiologyStarted' triggers the code, but it believes no filter has been applied.


Alright, first step: how is "timesAllLived" treated differently than ectoBiologyStarted.

Checked boxes is the same and correct for both, so next step is: satifies_filter_array

Okay, there we go:

            } else if (this.getBoolStat(filter) == null && this.getNumStat(filter) == null) {
vs
            } else if (filter == "timesAllLived") {


So i would expect timesAllDied and combo and frog shit to ALSO be working, and only that line to not work.

Yes, my expectations match reality.

Cool.

Seems a simple fix. i'm checking for null, but not "false", which in js was the same thing.


~~~~

Okay, i've been debugging shit for AB and ran into one more filter stumper.
Every filter seems to work: EXCEPT FOR SCRATCHES.

I am not sure what to think about this.  There are 16 scratches, I click it, and then 0.

I need to look for how scratches are different.

"scratched" is the name of the box and contents.
setStat("scratched", 0) is how it's initialized.


Huh, okay, is it a bool stat in sessionSummary, then?

Oh.
shit.

It's not in the hash. It's still a var.
summary.scratched = session.scratched;

I guess I thought it was important enough to be easily accessible.
That's an easy fix, tho, just gotta make it a special case, just like timesAllLived


~~~~~~~

Alright, here's another bug I abandoned:  why are initial relationships so low.
And free will, come to notice.  and Mobility is kinda high.

You would figure this would be easy to debug, cuz it's just initial conditions.

Let's find out.

Okay, free will is on the lower side cause of time, probably.

What about relationships.

I turn off associated stats entirely, and they are still just as low. Is it interests?

Huh, somehow it is lower.

Turning off intiailize relationships entirely doesn't help either. Is it from makeTroll? or decideTroll? whatever.

No, no relationship stuff.

Okay.

generateRelationships then.

which really is just: Relationship.randomRelationship(this, friends[i]);

which is
        Relationship r = new Relationship(source, source.session.rand.nextIntRange(-21, 21), targetPlayer);


I notice I am confused.  I put it into robot mode. And correctly get 0 ships. Everyone is 0_0. But...
the relationship value is still -5.  Why? is it from heiress trolls?

~~~~~~~~~~~

alright, it's like days later, can i figure this shit out?  I can confirm that relationships are set to 0 fo ra completely new player.
What about a new "random player"? should be the same cuz no generateRelationships or whatever called.

And really this is kinda barking up the wrong tree, cuz it's not the getStats("REALTIONSHIPS") that is the problem, it's the individual ones, too.

Like....too many spades and clubs in init relationships. where are they coming from?

Earlier tests showed i could weight the initial values as highly positive as i wanted and it did nothing.  Can i reproduce those tests?


TO FUTURE JR: HOLY FUCKING SHIT, ABJ IS LYING TO ME. SET RELATIONSHIPS TO ABSURD HIGH VALUES AND THEY INIT FLUSHED/PALE, BUT 'AVERAGE RELATIONSHIPS VALUE' IS STILL -4

I should have paid attention to the fact that earlier when i put it into robot mode it was still negative. omfg. gotta notice when i'm confused.

getAverageRelationshipValue(curSessionGlobalVar.players)
67499994

Okay, so that's clearly not negative 4.  is that just like....on ABJ's part then?

self.allSessionsSummaries[0].averageRelationshipValue
4
self.allSessionsSummaries[2].averageRelationshipValue
-7
self.allSessionsSummaries[3].averageRelationshipValue
-13
self.allSessionsSummaries[4].averageRelationshipValue
4


The summaries themselves truly belives the values are that low. So. What gives?

OMFG i have to stop now, but there is no fucking reason why abj would be doing shit like this. the makePlayers calls genereate relationships, and this happens before abj summariezes.

futureJR: good luck to you.

~~~~~~~~~~
Okay. I'm finally at the waste update. I've been fighting the faqs for an entire day already, which is just such flagrant bullshit.
Right now, they are saying they can't find things like Light.xml. Even though I just wrote it. What gives?

Let's review the possibilities:
*  There is a typo in the file, so it can't find it.
* Somehow the file path is valid in windows but not mac (but wasn't I seeing some files work on mac last night?)
* The error is actually something else, and being misreported.
* Cause and event have become unhinged and logic has no place in this universe.


I'd say the liklihood of possibilities are probably 1,3,2,4. So, first step: check for typos, even though I did already. Let's
do it again with a clear head.

I get a 404 for: http://localhost:63342/SBURBSimulator/GameFaqs/Light.xml

Step 1: Check my file structure.
    I see GameFaqs/Light.xml   .  Inside of it, I see the standard bullshit test section.
    Although I'm not yet at bullet point 3, I note that I remember sometimes needing /web and sometimes not.
    And that that was basically windows/mac.  Am I accidentally looking at it /GameFaqs and not GameFaqs?

    Stored File path is:     String filePath = "../GameFaqs/";

    That's because it's relative to inside the FAQEngine folder. BUT....that's not true is it? That folder itself is inside of scripts.

    Think.

    This was working last night on pc. Yes, I was tired, but I know I was getting it to load.

    Do I really need to have the file path relative to scripts? I don't think so. I think just not starting with a / makes it relative to
    the top level of the site.  But then i remember stuff like html css importing needing to be relative to the page and
    bluuuuuuuuuuuuuh.

    Okay, Maybe it will be different on windows, but for now just make it GameFaqs and no ../

    Yep, that did it. So at least I know what the problem is. And i'll see if it still works on windows l8r.


~~~~~~
alright, current problem is an inability to get sections for the generatedFAQ.

I can see that the sections are being created, but wheenver I do f.getRandomSection(rand), it returns null.

My initial instincts is that it's async stuff, and that i'm returning from the call before i've finished loading the sections.

One argument against taht is i went out of my way to use callbacks so it WOULDN't happen.......

Hrrrm....but.....actually....

if(sections.isEmpty && !loadedOnce) {
            //print("can't find any sections for $fileName, gonna load");
            loadWithCallBack(_getRandomSectionInternal);
            loadedOnce = true;

right. I'm dumb.  It returns immediatly afterloadWith Callback. sure i have my nice call back and all.
but doens't matter if control is returned to calling method immediatly.

Let's look at what is calling this.

 FAQSection s = f.getRandomSection(rand);
        //print("chose section $s");
        if(s != null) sections.add(s);
        if(sections.length < numSegmentsPerFAQ && numTries < 10) findRandomFAQSection();

Yup, look at this dumb shit. I'm doing shit after a potentially async call.  Gonna mark that shit.

  FAQSection s = f.getRandomSectionAsync(rand);
        //FUTURE JR: THAT CALL UP THERE IS ASYNC SO YOU CAN'T DO ANYTH1NG ELSE NOW. ONLY CALLBACKS
        ////print("chose section $s");
        //if(s != null) sections.add(s);
        //if(sections.length < numSegmentsPerFAQ && numTries < 10) findRandomFAQSection();


Okay. So. I can't return anything at all. It's gonna have to be a void method.  I need to pass the callback
when i call it......what even happened to the callback?  I also need to have the callback method in
GetWasted take in a FAQSection.

~~~~
Alright, what am I doing now? I'm styling the faqs to look like popups, maybe with that drop shadowy thing PL uses.
I also want to edit at least some of the placeholder xml to say How bullshit is Life/Time/Breath etc so I know where it's
getting the faqs from.

I need to confirm that the "found" faqs are appropriately random and not just one element.

Oh, and somebody on the discord made ascii art of aspects and I want to ask if i can use it.

Oh yeah and i wanted to look into the combo session bug somebody found, too

Alright: Confusion.  Why...why do all the faqs claim to have zero sections when I can see that they are loading right?
This problem is familiar from yesterday, but didn't I fix it?  Or is this async bullshit again?

trying to find random faq in session: 20170823, this is 1 time
VM166:1 can't find any sections for Light.xml, gonna load
VM166:1 found sections: []
VM166:1 gonna display generated faq with 0 sections []


I'm making html for a generated faq with 0 sections
VM166:1 <span class = 'FAQ'><br><br>TODO: make the faqs be here with fixed position. There are 0 sections to this faq.</span>
VM166:1 made FAQSection with header
             +++++++++++++++++++++Question: How bullshit is Light.+++++++++++++++++++++++
         and body
            Extremely.



So yes, it does seem I attempt to display before creating sections.  Why?  Did I forget to commit on my other machine or something?

Hrrrrm....do I know it was ever working? Current observations show it shouldn't have been.  It looks like I need to handle async
further up the chain than anticipated.

getRandomFAQSection();  <-- this will return immidiatly, with 0 sections
print ("found sections: ${sections}" );
displayFAQ(div, false);

Actually, in retrospect, I bet it DID work before and my memory is accurate, it's just on my other computer
it would manage to load in time.

~~~~~~~~~~~~~

Okay, i'v egot the basic css of the faq pages working. no "dismiss popup" code yet, tho clickingon the button again toggles it.
But what I need to figure out is why the contents of a faq are true random. Where is that coming from, and why isn't is the same thing each time.

First: Confirm it is NOT true random. Am I sure I'm in the same session each time?
Second: track down where the generated faq is getting the random from.

Okay, befoe i do anything else, i think i need loads to stop crashing. async crashes could b ea source of randomness. I'm gonna rip out all the
non placeholder faqs that aren't xml, readd them later.

Okay....how instead of randomly starting with an faq open it ALWAYS starts with an faq open. WHY???

Alright, also, clicking on the button that used to show/hide is causing it to be called TWICE so it show/hides in same click. WHY???

Wait, what, why is there multiple GetWasted things in the same scene. what is even happening

~~~~~~~~~~
Okay my current problem is that using the FAQs at all is leaking seeds like crazy. Async means that seeds are happening in different orders.

Is there any way i can plug this hole? PL suggested making a copy of random for the process to use, but that
hasn't helped.  Is there a hole I'm missing?

I continue to be tempted to just do away with the async problem entirely and pre-load the faqs just like i'm doing for images.

BUT PL thinks they have a solution.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Why.  Why is this happenining.

*head desk*

ranting on the discord is getting distracting, and it's always less clear than ranting here. What do I need to be doing, what am I obbserving:

Observations:

*NonDeterminism
    * mvp changes, sometimes it crashes, sometimes a faq popups without me clicking (before that meant there was two divs with same id)
* Popups without clicking (two divs same ID?)

~~~~~~~~~~~~~~

Alright, I wanna get one more bug out before I move on to gnosis 4.

 This bug has been around awhile, and I've gotten multiple bug reports from it even though I consider it extremly minor.
 It will save EVERYBODY some time if I can just fix it.

 Specifically, when you load a char it somehow syncs EVERY field except for Interest1 and 2 Drop down.

 This is, quite obviously, because the interest loaded might not BE a regular interest.  Though I seem to recall that when I load a new char
 I add the interest if appropriate, and I completely redid the interest mechanic at the tale end of The Great Refactoring...so....

 Let's see what we got.

 First up, what steps happen when I click: "Load".

    * parse out b, s and x
    * convert to a player.
    * redraw single player.

Okay, what steps happen in 'redraw single player'?  (god i love that i can just jump to definition instead of ctrl fing around like a tool. Dart > JS)

this.syncPlayerToFields(player);  seems to be the relevant method.

 (querySelector("#interest1${player.id}") as InputElement).value = (player.interest1.name);
 (querySelector("#interest2${player.id}") as InputElement).value = (player.interest2.name);

 Alright, working hypothesis has not changed.   Becasue the interest in question is not ALREADY in the drop downs, setting the value does not change the drop down.
 Wait. interest1....isn't that the text box and not the drop down? I might not even have the drop downs here. that would be fucking lame.

 Yes.

 SelectElement interest1DropDom = querySelector("#interestDrop1${player.id}");
 SelectElement interest2DropDom = querySelector("#interestDrop2${player.id}");

 That's what I need. And it's not there currently.

 If I set it to a value that doesn't exist within it, I wonder what will happen? will it add a new option?  Will I have to do that manually/?

Alright, problem numero uno: It's the wrong fucking select box entirely.
Going from category "Comedy" to category "Fantasy", the option isn't there even if it ISN'T a custom one.

So, it's not enough to set the value. FIRST I need to recreate that box.

If I switch categories it must already be happening. (I guess "on Change" isn't being triggered by manually setting it). Let's go see what I do onchange.

Alright, I need to stare at this:


OptionElement icDropDown = interestCategory1Dom.selectedOptions[0];
            InterestCategory ic1 =
            InterestManager.getCategoryFromString(icDropDown.value);
            interest1DropDom.setInnerHtml(that.drawInterestDropDown(ic1, 1, player));
            helpText
                .setInnerHtml(that.generateHelpText("Interests", player.class_name.name));
            player.interest1.category.removeInterest(player.interest1.name);
            player.interest1.category = ic1;
            player.interest1.category.addInterest(player.interest1.name);

What is that doing?

It's fetching the Category object. It's taking interest1DropDom and ....oh. set InnerHtml. that's what I want.

Aright, that's working.   Now I just need to see what it looks like for custom interests.  Yup, works for free.

Okay, time to look in pile to see if there are any other major bugs, and then I can justify adding a bunch via gnosis tier 4.

Oh yeah.

AB is lying about combo sessions. That's major, I can't ignore that.


~~~~~~~~~~~~~~~~

Time to debug AB lying.  I think WooMod said that while the MSS section listed no combos, if you ctrl-fed for it you'd see
a bunch.  So is MSS just adding up the wrong value?

First step: replicate the bug.  I"ll have AB start looking up sessions while I look in her code.

Alright, yes, in the MSS section it says 0, but just a few seconds of searching shows over 4 in this set of 50.

Relevant line:

            if (ss.getBoolStat("parentSession")) mss.incNumStat("comboSessions");
Oh my fuck. It's not a bool stat. It's literally a session.  Why....Why is it EVER triggering. When the fuck would a session have a bool stat with that name???

~~~~~~~~~~~

Light players exist to drive me insane.

Could not find relationship with God Tier Waste of Light (wickedLupin) in [ <font color = 'black'>&#x263A</font>(5) God Tier Waste of Space (worryingSpacer),  <font color = 'black'>&#x263A</font>(16) God Tier Waste of Light (wickedLupin),  <font color = 'black'>&#x2639</font>(-18) God Tier Waste of Light (windowsLaptop)]

What that up there says is that EVEN THOUGH I WENT OUT OF MY WAY TO GIVE LIGHT PLAYERS RELATIONSHIPS WITH THEMSELVES, they
still can't find that relationship. What the actual fuck.

They are clearly in the list. what gives?

Alright, let's think this through, step by step.

Step 1: Does this happen only for light4, is is it always happening? Doesn't seem to be.
Step 2: Does this only happen for wastes? doesn't seem like it
Step 3: does AB say it happens for wastes of light, or is it just this shitty session? 70%. Yup. Fuck.

Alright.

Let's review the problem.  More debug statments

Okay current hypotehtis is that the problem is that r.target is what is being queried, which is always the spotLightPlayer.



3x God Tier Waste of Light (wickedLupin) is not God Tier Waste of Light (windowsLaptop) because 144 is not 146
VM570:1 Could not find relationship with God Tier Waste of Light (wickedLupin) in [ <font color = 'black'>&#x263A</font>(5) God Tier Waste of Space (worryingSpacer),  <font color = 'black'>&#x263A</font>(16) God Tier Waste of Light (wickedLupin),  <font color = 'black'>&#x2639</font>(-18) God Tier Waste of Light (windowsLaptop)]

Alright. What am I seeing here.

I am looking for windowsLaptop, but I only ever get back wickedLupin.

Why am I looking for windowsLaptop if they are'nt the spotlight player?

Relationship r1 = player.getRelationshipWith(helper);
Relationship r2 = helper.getRelationshipWith(player);

Oh, there's an easy fix.  Make helper ALWAYS be spotLightPlayer.  I think
I just refactored how getting the helper works, too, so it should be easy adn happen only once.

I susepct that even if the light player dies they are gonna be stuck helping everyone.

Careful what you wish for, etc. etc.

~~~~~~~~~~

Okay. Fuck the Entire World.  I can't figure this out.  Spend five minutes defining the problem without looking for solutions.

I KNOW that sometimes players have null denizens and denizen minions. These players are existing players (such as a Waste of Time).

These playes are only in a session with Wastes of Rage.

I know that when a player is created, their denizen and  minion are created at the same time.

I know that when a tier4 blood player brings a friend in, that friend has no denizen (but never bother to null the minion.

Okay. Let's see EXACTLY when a denizen is created in the player creation process.

It's called exactly once, in Intro.  So blood plyaers would have both be null anyways.




Avenues of Investigation:
    * is INTRO being interupted for any players in the rage update.....

    Oh.


    Oh fuck.

    Of course it is.

    Because I have that SimController.stopped flag....and I only restart tick. Not intro. (do I even stop Intro?)

    I am like, 90% confident that this is the problem, and I'm about to hit the five minute mark anyways.  Time to code.

Steps towards a solution:

    * have intro ALSO be stopped by flag.
    * figure out whether you should be calling intro or tick when restarting.  prefereablly make a method in SimController for restart.


    Alright, the problem with intro is that it's assuming no informatio is stored between method calls besides recursive things
    unlike tick, which takes no input.

    So. What to do. Obvious answer is to make the passy innny thingy be a field on SimController. How much will this fuck me over?

~~~~~~~

Yay for another absolutely bug shit bug.

AB says that 3323477308 is a combo session with a tier 4 gnosis event in it (presumably in the second session).
But clicking the link and VIEWING that session shows that Skaia gets destroyed by meteors. So it's IMPOSSIBLE for it to be a combo session.

Querying AB says she believes the makeCombo var is true, that var is set to be true in only one place. I guess next step is put a print out in that place and see if it goes.

Wait.  AB thinks that rocks did NOT fall in that session. What?

I need to check mvp power levels between the two.

They are different.   And putting it in images=pumpkin mode makes it the same as AB.

I've poked and prodded but I'm not making any progress.   First thins I tried were disablin the few rendering things I"d changed in rage.

(cuz i noticed that images=pumpkin (which KR sets when killed) didn't prevent mourning and char sheets from being rendered).

I see that char sheets just don't even work in images=pumpkin. tries to render them (when it shouldn't) and then crsashes

And looking into THAT error shows that even in images=pumpkin in that one moment it thinks it's supposed to render. doNotRender = false. WHY.

~~~~~~~~~~~~~~~~~~~

Okay. I need to stop and think, just focus and think.

I have two windows open showing the same session. One is in images pumpkin, one is not.

Somewhere in the middle, this happens:

God Tier Maid of Rage (mightyRunner) skyrockets up the ECHELADDER to a new rung: MUSCLES HOARDER and earns 37 BOONBUCKS.

And then they divruge.   Image mode does shipping, pumpkin mode does void.

Last time this happened with AB, it turned out a rendering thing used a seed in a non obvious way (calling a method that itself called a seed).  This was like, 7 months ago.

I need to examine what happens when a god tier levels up from start to finish.

One problem with this is that iti's not the first god tier level up in the session, just the first with a living player.

So is there something that wouldn't ALWAYS eat a seed?

Hrrm...... what about FAQs?  They shouldn't eat seeds because they clone the random, but let's find out.

If I refresh the pages, do they divurge in the same spot?   If yes for several sessions, probably not ACTUAL randomness like network times.

Okay. It seems stable enough. Don't go down the rabbit hole of faqs yet.

Let's just...examine every step in the level up process.

    @override
    void renderContent(Element div) {
        String narration = "";
        for (num i = 0; i < this.playerList.length; i++) {
            Player p = this.playerList[i];
            ////session.logger.info("Level index is: ${p.level_index} while my levels length is ${p.mylevels.length}");
            //it's a var so i debug this nightmare without end
            bool canLevel = p.leveledTheHellUp && ((p.level_index + 1) < p.mylevels.length);
            if (canLevel) { //can't level up if max level
                ////session.logger.info("going to level up");
                this.renderForPlayer(div, p);
                p.leveledTheHellUp = false;
            }
        }
    }

    nothin gjumping out at me there....


 if (levelName != null && !player.godTier) {
            String canvasHTML = "<br><canvas id='canvas" + divID + "' width='" + canvasWidth.toString() + "' height=" + canvasHeight.toString() + "'>  </canvas>";
            appendHtml(div, canvasHTML);
            var canvasDiv = querySelector("#canvas" + divID);
            Drawing.drawLevelUp(canvasDiv, player);
        } else if (levelName != null && player.godTier) {
            //god tier has to be taller.
            String canvasHTML = "<br><canvas id='canvas" + divID + "' width='" + 1000.toString() + "' height=" + 572.toString() + "'>  </canvas>";
            appendHtml(div, canvasHTML);
            var canvasDiv = querySelector("#canvas" + divID);
            Drawing.drawLevelUpGodTier(canvasDiv, player);
        }

So I call different methods based on if god tier, becasue i need to allocate a differently sized canvas. So far so good.

COMMENTING OUT OUT ALL OF GOD TIER. let's see what happens.  nope, not that.

okay, let's try shipping next. Wait. I am p sure shipping and void both don't do rendering.

Okay. Well. what about renderSelf()? Does that get called in any of them? that isn' t"on screen" but is still a thing.
Nope, never called ever in images = pumpkin (or at least never gets past doNotRender)

Also, i can have it so god tier levling always renders no matter what and see if that has an effect.

even if i always render. no change. okay.

let's check faqs then.

wait. except images=pumpkin doesn't effect faqs like ab does.

i know i found a few other sessions like this. compare another one see if anything in common.


~~~

post sleep.

The seed is the same begining and ending for RelationshipDrama. And yet, the next scene begins with a different seed.

This seems confusing, but I realize that triggers can eat seeeds without causing a scene.

I need to see what triggers are considered.

All the triggers are the same with the same rand.  it's just that UpdateShippingGrid triggers with images and does not without.

What does it mean. Both find the same player, with the same power.  The only thing left is what they think the saved ships are.

This is so dumb.

~~~~~~~~~

Okay. That's outta the way. Time to tackle Mind Gnosis4.

On the one hand it should be 'easy' since it's just a remix of my YellowYard.

But it's not JUST that. I want custom graphics (their avatar and not mind, and they dont' get the yard stick
which i guess makes it easier to CONTROL the cataclysm or some shit lets say). I also
want custom things they can do (x3) AND I want the displayed options to be scrolling, not constrained to a yard.

Problem with custom graphics: Gnosis4 doesn't let you render. There's no div or anything.

If I'm fine with it being 100% image, then I can work with this. If I want their avatar, then I'd need a canvas....

which would need to be appended to the dom and THEN javascripted.

Let's go for no avatar for now.  And no custom graphics, though custom code for displaying the graphics.

Then as I get close to being done and know what I want, I can make a "only the 4th wall" or whatever grpahic.


What is the steps I need to do:

*  Figure out how to implement 3 new YellowYardEvents
    * Kill all bosses pre-entry
    * GodTier all players pre-entry
    * Destroy All Rings PreEntry, Give Everyone a huge amount of Sanity PreEntry (basically get rid of all doom sources).
* Display something LIKE a yellow yard in the middle of a session.

~~~~
Alright. Got some frameworks to do. Foundation step is get a YellowYard displaying right after
 the Mind4 event with no filtering.  Different image, too.

 Okay, looks like the rendering of the yellow yard happens in the scene, so I'll just have the mutator have it's own version
 and if the field is up, the scene uses the mutators instead (JR blocked out entirely)

 ~~~~~~~
 Alright, we're reaching the home stretch.

 I can either do Space next, or Time.

 Space has the advatage of using built in systems (besides having to PAUSE before a combo session unlike reality)

 Time has the advantage of seeming to be easy AND not need that "pause".

 I guess I'll do time first. That lets me leave the 'canon' effect for last.

 Easy is important 'cause I don't have much time today.

 So, let's describe the time effect.   In the aftermath, where it prints out mvp or the afterlife url or whatever,
 add a NEW button that allows you to click it.  Doing so resets the session.

 Custom code on entry "kills" the time player (i.e. makes a ghost) and then replaces them with the time player
 saved by the mutator.  It also resets the seed to represent the time player changing shit randomly around.

 Step 1: if timeField, display a button.
 Step 2: clicking button resets session
 Step 3: if timeField on entry, if player.id == timePlayer.id, replace.
 Step 4: if timeField on entry, randomize seed.

 ~~~~

 Current problem. "replaced"  time player has no relationships. even though i'm not really replacing them. I'm overriding them.

 Okay, that's fixed, but like, now the saved time player has no relationships. Which is....what?

 Where are they going? do they have relationships when they are first saved? when i query in the method?

 ~~~~~~~

 Alright: we're at the home stretch. I want to get Space4 done today. I THINK it will be very very easy.

 All I need to do is have spaceField mean that combos don't happen automatically, but instead get locked by a button press
 just like scratches/resets. And then have it so a spaceField means as long as their is a frog, you combo.
 And post scratch you ALSO combo. (unless a life player kills you all, I guess. rip).

 So, other than the fact that there can end up being WAY too many players in a session.... It shouldn't
 have anything new.

 What image should I use for Waste4's button? I wanna go with maybe infinite layered 4th walls?

 Alright. Time for the code.

 Problem: there is currently no "make a combo session" method. Instead it's ina  few places. Like:

 Session tmpcurSessionGlobalVar = curSessionGlobalVar.initializeCombinedSession();
         if (tmpcurSessionGlobalVar != null) {
             curSessionGlobalVar = tmpcurSessionGlobalVar;
             //maybe ther ARE no corpses...but they are sure as shit bringing the dead dream selves.
             appendHtml(querySelector("#story"), "<br><Br> But things aren't over, yet. The survivors manage to contact the players in the universe they created. Their sick frog may have screwed them over, but the connection it provides to their child universe will equally prove to be their salvation. Time has no meaning between universes, and they are given ample time to plan an escape from their own Game Over. They will travel to the new universe, and register as players there for session <a href = 'index2.html?seed=${curSessionGlobalVar.session_id}'>${curSessionGlobalVar.session_id}</a>. You are a little scared to ask them why they are bringing the corpses with them. Something about...shipping??? That can't be right.");
             checkSGRUB();
             load(curSessionGlobalVar.players, <Player>[], ""); //in loading.js
         }



 Think through the steps.

 The aftermath hits. (it will ALWAYS hit, no more ectodoom for space, they will just make themselves in new session).

 processCombinedSession is called. It renders the button because there is a space field. clicking the button should:

 *   curSessionGlobalVar.initializeCombinedSession()  (this NEVER returns null)
 * curSessionGlobalVar = tmpcurSessionGlobalVar;
                //maybe ther ARE no corpses...but they are sure as shit bringing the dead dream selves.
                appendHtml(querySelector("#story"), "<br><Br> But things aren't over, yet. The survivors manage to contact the players in the universe they created. Their sick frog may have screwed them over, but the connection it provides to their child universe will equally prove to be their salvation. Time has no meaning between universes, and they are given ample time to plan an escape from their own Game Over. They will travel to the new universe, and register as players there for session <a href = 'index2.html?seed=${curSessionGlobalVar.session_id}'>${curSessionGlobalVar.session_id}</a>. You are a little scared to ask them why they are bringing the corpses with them. Something about...shipping??? That can't be right.");
                checkSGRUB();
                load(curSessionGlobalVar.players, <Player>[], ""); //in loading.js

Okay, so put the if tmpSession != nul shit into it's own method. simple.

I shouldn't ONLY call it from processCombo though. Button should be rendered for ANY aftermath. So don't render combo from process Combo. Instead, render where time button would be renedered.


~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Okay.

I spent an ENTIRE FUCKING DAY not working on the land update yesterday, which means I , of course, no longer remember waht i was doing. That's just how it goes.

My goal here is for quest chains to be as dynamic as possible. Now, when I CREATE a quest chain, quite obviously there won't BE a
 denizen or a player or an aspect or anything like that.

So. WhatI need to do is, much like FRAYMOTIFS, define a simple word replacement scheme thingy.

Any mcguffins will be aspect related.  Play the wind, play the rain, play the bones, etc. etc.

So:  ASPECT_MCGUFFIN is one key word.
PLAYER1 is an obvious one.
PLAYER2, being an optional one.
DENIZEN is another (especially since in dead sessions they'll just be CALLED like LORAS boss).
CONSORT and CONSORTSOUND.
SMELL, SOUND, FEELING of course, though mostly I want it to use the built in shit.

What's the pipeline I'm expecting here?


I create a quest chain, with a quest in it like:

"The Heir of Breath and the Thief of Light are in the Land of Wind and Shade. They are reassured by how calm it feels.
Suddenly a Salamander runs towards them, glubbing up a storm.  It turns out that Typheus has woken up!  It is now up to the
Heir of Breath to play the wind in an attempt to calm them.  The Thief of Light appears to be taking fortune from the Heir of Breath and keeping it for themself. "

 so that would translate to:

 text from quest start scene + "Suddenly a CONSORT runs towards them, CONSORTSOUNDing up a storm.  It turns out that DENIZEN has woken up!  It is now up to the
  PLAYER1 to play the ASPECT_MCGUFFIN in an attempt to calm them down. ${interaction_effect}"

  ~~~
  Alright, I've got the mcguffin words set up.

  What now. I guess....I need to look at the pipeline again.

  I create a quest chain in like, Thief.dart.  It's attached to the Bank/Vaults/Safes/Money theme.

  It has a lot of text, with things like ASPECT_MCGUFFIN inside of it.

  Then, later, DoLandQuest or it's new equivalent calls shit.

  The land is asked "what's your current quest chain." It says, shit, I don't have one.

  It checks all it's quest chains that are stored in the "pre denizen" list, and sees if they are triggered.

  It takes all triggered chains, and picks one at at random and sets it's variables that the things like ASPECT_MCGUFFIN are going to look for.

  Now that's the 'current quest chain.'  I then say "quest chain, are you finished? ".  It says no.

  So then I say "okay, here's one or two players and a div. Do whatever with it."

  The quest chain then gives it to the current quest.

  The current quest prints some text out to the passed in div.

  It then returns, and the Quest chain itself says "okay, am I done now? ".

  If the quest chain IS done it marks it's flag and also distributes it's Reward (which it prints out to the screen as well).

  ~~~

  Okay, is there a reason that a Quest doesn't just return a string? does it NEED that div?  Let's go with no.  You can only have canvas shit at the end of a QuestChain, let's say.
  Hell, let's just say that Rewards know how to render themselves.


  Alright, let's start with QuestChain.

  ~~
  Okay, a lot of the structure is there, minus the deeper stuff.  So I need to start wiring things up. I'll start with the dead session stuff.

  A planet like "colors and mayhem" needs to start off with completely bullshit menial stuff to do. That is the "pre denizen" parts.

  Once that first quest chain is completed, then the special do Dead Quests will know to switch over to mini planets until they are done,
   with a Colors and Mayhem quest in between each full mini planet. Then, all the denizen quests.

 ~~~
 Alright, current status is that the pre denizen meta land shit is printing out, then crashing when finished
 (since there are no denizen quests.)

 What I want is for denizen quests for the meta land to be all sports themed.  huge weighting.

 And I want the ordering to be like,

 Do denizen quest, do the entirity of a mini planet chain, do denizen quest.

 And denizen quest is like.

 Oh shit, the medium has turned into a giant bowling alley. You have to beat knock all 10 planets down to win. Luckily two
 got knocked down when things started.

 All of the quests for one planet.

 With an echoing crash, the planet tumbles into the black hole. You are really getting the hang of this bowling thing.

 (when no planets left, skip to end, 16 total denizen quests but might not need all of them).

 You get a STRIKE! You are officially declared the bowling champion! Congratulations to you! Now, all you need to do
 is make you way to the Denizen Yaldobooger.  You barely even care what sorts of annoying things are in the way, you are
 so close you can TASTE victory.




 ~~~

 Okay muse is in.  I see no crashes at this point with quests, BUT it only does one land of quests and then just stops until the reckoning.

 Need to track that shit down after lunch. Actually there is a few crashes still. bluh.

 Okay. *bangs head on desk* I am removing the quests when I should be changing a pointer or some shit. bad JR.
 It wouldn't be a problem, except the same theme is getting reused for new lands and i should have been able to handle that.

 What do I do here, what if this happens in a multiplayer session? then the same "quest chain" will be happening for multiple players
 and it will be jumping around.

 Should I just make a clone of the quest chain and it's quest?  actually, both quest and reward seem to be stateless so....just the chain.
 that's not too bad.

 ~~~~~~

 Okay, I'm fleshing out these first three dead session themes. I probably should just say "is over when no more quests" instead
 of keeping track of a number. Would be easier than "doing quests in order but when run out of numbers do last quest";

 dunno though yet, will wait till it's time to do the third set of quests (which we know the least amount about).

 ~~~~~~~~

 Alright, my two goals here are to make interest/class/aspect quests, as well as to get boss fights hooked up.

 The first is basically just brainstorming/creative writing work.

 Boss fights will be a bit different. Unlike regular quests, boss fights can be failed.

 Right now, my thoughts are that if you do not win the strife, you have to do it again.

 Right this second, quests are just dumb. They do their thing. and nothing else.

 Quest CHAINS handle "remove this quest" and "pay out this reward. "

 First and foremost, I should make each quest you do increase your power. That's how it was before, don't want to make power way lower.

 This means that each time you challenge a boss you are slightly stronger than previously. (more so than just a regular strife would make you).

 Print out something about how you go grind against regular enemies when you are done getting your ass handed to you to justify.

 Okay, so how are the actual mechanics going to work?   Pre-Derse JR was all "okay, if a quest returns null, it failed"...

 This actually makes sense to me. If a quest is failed, you don't remove it from the array, so you have to do it again
 next time.

 Do I want 'regular' quests to be failable? No.  BUT I DO want the special dead quests to be failable. Can let me control
 the odds of winning a dead session.

 new DeadQuest(odds, failMsg) maybe? then tweak the odds in dead session.

 ---
 before i get lost down that rabbit hole tho....


 ~~~~~~~~~~~

 Okay.  Bosses are done, and even give the right fraymotifs as rewards.

 so. What now.

 Well theoretically, I need to start up the third set of dead session quests.

 First set is doing random bullshit.  Second set is completing the themed challenge.

 Third set is...hrm.   Boss fight?


 But before i can even do that, MOST sessions get to the reckoning before completing all the shit. Which. Why?

 I thought i Made the reckoning stupid long.


~~~~~~~~~~~~~~~~~~

Okay.  Time to figure out how I want moons to work.

Obviously moons will be an array on a session. Prospit/Derse.

Should they be Lands, or a sub class of land?

If they are subclass, then I know to do things like kill dream selves when they are exploded. Good enough for me.

Anything else special they do?

My thinking is the DoLandQuest equivalent (DeadQuests right now) has a random chance of either calling the next quest
on the planet, or the next quest on the moon.

Moon quests should be infinite though. Like, no pre, denizne, post, just....keep going, forever.

Once NPC update hits, though, it might have different categories. Dunno.

What can you do on a moon?

1 Bullshit (dance parties, drink tea, etc.)
2 Augery (moon/horror terror etc)
3 Royalty shit  (work to weaken the queen, get the rings, etc)
4 NPC shit. (recruit clubs deuce, maybe?)

For now just implement 1 and 2.   Once dead sessions are done i can implement part of 3

I want the land update to get rid of bullshit sidequests and moon quests as separate scenes entirely.

~~~~~~~~~~~~~~~~~~~~

Dammit, multiplayer quests aren't going to work how I thought they were.

God fuckin dammit.

The problem here is that while I can REQUIRE a quest chain have multiple players to be started, I can't guarantee that the second player will
be available for every quest in the chain.  So it might change who p2 is, or even outright not HAVE a p2.

Okay.

Okay.

What's the laziest fucking way I can fix this?

Well, if I reference Player2 and there is NOT one, then I can fill the text in with "a random fucking skeleton." or whatever.

What if Player2 is a npc or sprite or whatever? just roll with it.

Let's see how this looks.

But seriously: WHAT ABOUT SHIPPING DUNGEONS?

Well....can just have it be weird and awkward the whole time and when you get the ShippinReward it comments if p2 is not a player.

Shipping rewards should get a 2 player fraymotif AND shoves you flushed/diamonds/spades etc together.

~~~~~~~~~~~~~

Okay. Not really debugging but I want to plan how I want to redo the intro scenes, they are really showing their age, especially
with the new land system.

Obvs will have conversational pairs, much like the land system.

Can try to break the conversation into three parts (or six lines).

* I am in the medium
* my land is x
* i prototyped a x

Completely different set of possible things for grim dark or alien.

Conversational pairs should have different conditions like, here's how you can respond if you're a seer, etc. etc.

and can add different sets entirely based on interests.


~~~~~~~~~~~

Okay this bug is complicated enough to deserve a solid ramble.

Observed behavior: if the same quest hits multiple times, then the TEXT says that the first player
to do the quest is the one to get the reward, but the CANVAS show the right player getting the reward.

And they seem like they are actually getting the reward in practice.

Can easily test by having all the same aspect players.

Step 1:  Get a session up with the behavior.
Step 2: Find out how drawing the reward differs from narrating the reward.
Step 3: ???
Step 4: Main Release

Okay. So. Drawing happens in super. But replacing text might happen in a child?

Let's experiment.

okay, well accroding to logs the narrationa and drawing and end of quest ALL know the right player
so why does it narrate wrong one?

is it the div?  is it......hrrrm. well. can i find the right phrase ANYWHERE on the page?

hrrrm, i can confirm that the right player doen's thave the right fraymotif at all either.

fuck. what is going on.

okay. NOW right fraymotif is given out, but text is still wrong. WHY.


AHAH!

the text is wrong in the super. see, it says 'maid'.

I've finished quest chain The Mail Goes Through!,player is MageBreath
VM102:1 narrating player 1 is MageBreath
VM102:1 applying base reward, text is  The <font color='#3399FF'> Maid of Breath</font> (<font color = '#A10000'>musingBaker</font>) gains the fraymotif Denizen Htaerb's Refrain , as well as all that sweet sweet grist hoarde.
VM102:1 drawing player 1 is MageBreath



I can see why, too.  or.... hrmr.


no, that would only make sense if it were static
or if the.......


if the reward didn't get reset
fuck.
fuckity fuck

don't have the text be a field on the thingy, have it be passed in.


Debugging Alchemy:

<h1>Test Cases: Conclusion: Working as intended. (So what the fuck was going on with traits before? Do i need to deeper? three x combo?)</h1>
		<li>Pistol AND Sword = Pointed Pistol, shooty,metal,a pistol,edged,pointy,a sword</li>
		<li>Sword AND Pistol =  A Pistol Sword ,edged,metal,pointy,a sword,shooty,a pistol</li>
		<li>Pistol OR Sword = A Sword Pistol, ,shooty,metal,a sword</li>
		<li>Sword OR Pistol = A Pistol Sword, ,edged,pointy,metal,a pistol</li>
		<li>Pistol XOR Sword = Pointed Pistol, shooty,a pistol,edged,pointy,a sword</li>
		<li>Sword XOR Pistol = A Pistol Sword, edged,pointy,a sword,shooty,a pistol </li>
		<li>Pointed Pistol (from AND) AND Whip = Fabric Pistol, ,shooty,metal,a pistol,restraining,cloth,a whip </li>
		<li>Whip AND Pointed Pistol (from AND) = Metal Whip, ,restraining,cloth,a whip,shooty,metal,a pistol</li>
		<li> CLAWS AND ((Pistol AND Sword) AND WHIP) = Metal Claws, edged,bone,claws,shooty,metal,a pistol , <h1> Yessssss it finally fucks up. BUT WHY???</h1></li>



So, first of all, something alchemized 3 times shoved into something alchemized zero times results in a single name.
In retrospect, this makes sense. I should add the two items descriptions together, so I can get the right amount of things.

But what about those fucking traits.

ALL operations are AND, so nothing should be lost, but I go from

restraining,cloth,a whip,shooty,metal,a pistol

to

edged,bone,claws,shooty,metal,a pistol

i lost cloth, restraining, whip. It's like....it forgot about the whip part entirely and only remembered the raw pistol shit.

Which.
Shouldn't be a thing that can happen? It shouldn't know what traits are native to the pistol or not?
They ARE native, right?

Yeah.

Pistol <= Sword <= Whip.

Hrrrrm. Maybe. Is something glitching so it resets the item?

Ask the log to tell me what the objects are before combining with AND. It could be in 'apply', too.


Combining Pistol and Sword
(program):1 Combining  Pointed Pistol and Whip
(program):1 Combining claws and  Fabric Pistol

Alright, that all looks correct.

........

Wait.

Hypothesis.

It's a fabric Pistol in the player's inventory, but still a pistol in the drop down maybe?

I remember there's a point where I go and fetch the real thing?

Like, there's the version I have local, and then i get the array version? That's probably a dumb unnecessary
thing i'm doing since they are the same damn object. but maybe it's not?

Adding a new descriptor. First item has 3 traits, second has 6 traits. Difference is 3 big.


Hrrrrm. So when it does the descriptors it seems to know about the whip?

Is it because claws is the default object? What if i pick hammer instead? Yup, still happens.

Have to leave soon, guess I'll keep debugging later with a fresh head.


~~~~

Okay, back. Let's do this shit.

If I do Pistol AND Sword and then then shove that straight into claws, I get
,edged,bone,claws,shooty,metal,a pistol

which LOOKS right. Except it doesn't  have "a sword." or "pointy" it just has "edged"

So, this is a data point. it's not like I lose ALL traits, just, some each time.

So I need to stop pursuing caching as a potential problem.

Wait. Edged is from claws. Fuck. God damn.

Okay.

Well.

Then never fucking mind. But at least this is faster than the other.

Time to just walk through each step of AND.



 result = items[0].copy();
      //skip first item
      for(int i = 1; i<items.length; i++) {
          Item item = items[i];
          for(ItemTrait t in item.traits) {
            result.traits.add(t); //will handle not allowing duplicates.
          }
      }


      First test. After result = items[0].copy, how many traits do I have? If it's zero, then that's a problem.
      (though first item is probably the sword)
      Second Test. Print out item when I'm adding it.


      just copied the first item. result has 3 traits.
      (program):1 going to shove  Pointed Pistol into claws.


Alright, neither test shed any light. What now?

Well, what does item.traits looke like? print that fucking out.

just copied the first item. result has 3 traits.
(program):1 going to shove  Pointed Pistol into claws.
(program):1 adding trait shooty
(program):1 adding trait metal
(program):1 adding trait a pistol



......What the actual fuck.

Okay. So THAT is wrong. But why? It SHOULD have ,shooty,metal,a pistol,edged,pointy,a sword.

So why only three?




just copied the first item. result has 3 traits.
(program):1 going to shove  Pointed Pistol into claws.
(program):1 adding trait shooty
(program):1 adding trait metal
(program):1 adding trait a pistol
(program):1 Adding a new descriptor. First item has 3 traits, second has 6 traits. Difference is 3 big.



Okay, so there's three traits, but then when it's time to do a descriptor it knows about 6 traits?
i notice i am confused.


okay. "second" is the result, nevermind.

Is it a sync issue after all? What is displayed on screen has six, but what is processed has 3.



Oh ho ho! Wait right the fuck

I have it open right now and I can fucking sEE that result is:

,shooty,metal,a pistol,edged,pointy,a sword

But then when I pick it from the drop down I only see
,shooty,metal,a pistol

Even though both are named "Pointed Pistol" What the actual fuck?

Alright, is it wrong when it gets applied? Wrong when it gets rendered to the list?

How do I correlate an item to a drop down thingy?


        Item item = findItemNamed(firstItemSelect.selectedOptions[0].value);
hrrrm.



So when searching through my sylladex....i get this:
found possible match  Pointed Pistol with 3 traits

Which means it is ADDED TO MY SYLADDEX WRONG. somehow.

grrr.

result is  Pointed Pistol and has 6 traits  and modified is  Pointed Pistol and has 3 traits

result != modified but WHY?

        result.traits = result.traits;

...
...
...
...
...
God I'm an idiot.
How did I typo so hard to turn modified.traits = results.traits into THAT tautology?

So now comes the question: How did this EVER fucking work?
Oh, it only appeared to cuz result is what gets displayed, but modified is what gets saved.

Oh yeah, should make sure i copy the list too instead of referencing



~~~~~~~~~~

Alright. I guess I can take a break now, but before I do I want to spend 5 minutes on the clock thinking about item names
cuz the way I'm currently doing it just doesn't fucking cut it.

Alright, first up, I don't want to think about what I'm currently doing. Instead, I need to define the problem.

What I want, is for an object's name to vaguely describe the object,
but with it's initial traits being not part of it.

We can fucking assume a Sword is metal and sharp and a sword.

But a Sword augmented with a Lighter is a Flaming Sword.

Okay, tempted to talk solutions, but not until the 5 minutes are up.

So, what other parts of the problem exist.

1) Un-modified item uses base name based on traits.
2) Modified item has additions to the name only from non base traits.

What about if you REMOVE a trait from the object?

Do I want UnSharp UnMetal Sword, for example?

What if I remove a trait from an object that wasn't base?

Flaming Sword || Fiduspawn Plush

Might get me a soft and unflaming sword. Or something.

Flaming Sword to Soft Sword?

So, should the name always be related to the traits and never cached? Rerolled entirely when I alchemize?


Flaming Sword becomes Blazing Stone Sword? (since flaming word gets rerolled?)

Or even Icy Stone Sword (ice was always there, just wasn't in the name for hte first version?)

Hidden traits DO seem p canon, Wizard status probably wasn't magical, but had magic that alchmized shit could get.

Liek a recessive genetic trait.

Hrrrrm.



Okay, I think I have my problem defined:

Ran out of time, too, so here's the write up

1) Un-modified item uses base name based on traits.
2) Modified item has additions to the name only from non base traits.
3) Traits that no longer are part of the item are no longer part of the name.
4) I think "base" traits that have been removed would be too awkward to put into name.

Solution brainstoring really quick.

AlchemyResult could reroll the name each time the object gets alchemized?
Pick x traits where X is the number of times the object has been alchemized?
 (or should it keep the total number of names from both sides? Flaming Metal Brick AND Icy Stone Tablet should make a Flaming Icy Metal Stone Tablet. No. That sucks.)

 Traits themselves should also know if they were part of the object on creation. Maybe? Except traits are singletons.

 Maybe the item itself has a set of base traits it copies on creation?  Knows not to consider any base traits
 when doing name shit.


((Also: Before I forget, I think AND needs to be nerfed right hte fuck down and take 50% of everything from both soruces
cuz it's redonk how much better AND is than OR right now))




Oh shit, MI just had a great idea:

"Idea for names: If traits translate to name modifiers, maybe certian combinations of traits can also have words?
 So if you have an item with "Firey" and "Metal" it could print "Forge God's" as a part of the name?"

Let's chew this over before coding.....

So one obvious benefit is that it allows traits that expected to co-occur to be condensced instead of having
big stupid jumble names.

Shooty Pointy = Bayonet, for example.



maybe can have ALL traits displayed at all times? ???

Honestly, that would be a p ideal state.

Think about it.

Don't need to ingore base shit with that.


Also, for the things that are "a sword" or whatever, they should not be allowed to be a part of Names, just descriptions.

So should be a diff type of itemtrait.

Okay, diff item trait exists, so,

TODO:

Change descriptions to just always be a list of traits. Have framework for condensening traits to be diff combo words.
Since descriptions will always reflect traits, don't need to worry about traits being lost.


~~~

Doop. Okay. Step 1. If no alchemy levels, then NO extra names.

No SHARP METAL POINTY SWORDS to start out with, assholes.

If >1 alchemy levels, then names come from traits. all traits. go hog fucking wild.

Then see what you need to compress. Be memey as fuck.

~~~~~~~~~~~

Okay, Step 1 is done.


But how do I want to handle combos?

for(ItemTrait t in traits) {
            if(t is ItemObjectTrait) {
                //skip
            }else {
                ret.add(" ${ capitilizeEachWord(rand.pickFrom(t.descriptions))}");
            }
}

That's it without combos.
So. What.

Well, one way to handle it is to have some traits just straight up be combos?

Forged = Metal and Sharp, for example.

In the actual traits list, it will stay separate.

But when it comes time for descriptions it will return the combos instead.
And higher level items can use those combos directly.  Like, here's a sword that can't be edged without also being metal?
Or whatever.


I don't HAVE to use those combo traits, but that makes sense to me.

Just need to have a function mapping an array of traits to any and all combos it works for
without repeting any traits.

Now, normally a function mapping shit should be, well, a map.

But I'm not sure if a map is complicated enough here?

Let's walk through a use case.



I pass in: ,paper,blunt,a book,metal,pointy,a needle

A book and A Needle are filtered out.

paper,blunt,metal,pointy,soft


It goes through them and finds:

Needly (metal, pointy)
Foil (metal, paper)
null (blunt, pointy)

Now, it needs to decide which things should get priority.

null means two features canceled out. So. Do that one first.
Both Needly and Foil have the same number of traits used up, so have equal priority.
Needly goes, but can't apply itself because pointy has been used.
Foil goes, and takes both metal and paper away.

Foil and Soft is returned.


Okay, that was a solid exercise.

What did I get out of that?

I need some sort of CombinedTrait object to hold thigns in interm.

It has "new name" and "traits that make it up" and a priority it can be sorted by.
If it is null, it's priority is like, 1300 or some other big dumb memey number.
Otherwise it's priority is how many traits it would suck into itself.

Once I've fetched the correct CombinedTraits, I need to process them.

* Make a copy of the traits that were passed into me.
* Sort the CombinedTraits by priority.
* For each CombinedTrait, check to see if all subtraits are in the copyList. If they are, add the CombinedTrait
to the return list of traits and remove all subtraits from copyList.

When done, add all remaining traits in the copy list to the return list.
return.

~~~~~~

Okay. I've coded it. But I know I'm getting fucking tired. I'm having trouble thinking through the steps.

I've coded it. But I haven't wired it up. What should call it? What was I doing?

When....I want to mamke a name, get the traits i do shit on from the new method.

That's right.



~~~~~~~~ 12/5/17

Alright.

The important thing is not to panic.

Everything is on fire.

The entire experimental branch crashes. Just. All the time.

It's fine in dart. It's fine in dartium.

The second I compile, it crashes. The compile itself is fine, besdies one warning in a controller
that isn't even used, but fine, i'll update that.

The actual crash log is gibberish, because it's fucking compiled code.

When I dug a bit deeper in it, it seemed to be looking for a dart file, which...I'm pretty sure that's a red herring.

So.

I'm waiting on a compile to see if fixing that warning fixes anything.

If it still crashes once it's compiled, my plan is to look at the crash log harder and to see what is going on.

Alright.

It says Gristmas line 100 is the problem. Somehow.

          if(player == null && p.getStat(Stats.ALCHEMY) > 0) { //you don't even bother trying alchemy if you can't figure it out
 "is not a function.";



Think.

Think.

Is it really that line? It takes so long to compile that I can't afford to just change shit and see what shakes out.

I use p.getStat in plenty of other places. Strifes for example. Nothing uses Alchemy direclty tho. Till now.

But I used it to calculate if an item is above the threshold....

Shit like:       if(p.land != null && !p.land.firstCompleted) ratio = p.getStat(Stats.ALCHEMY)/expectedInitialAverageAlchemyValue;

So what's different? What's p?

Alright, recompiling again, this time with:

    print("P is ${p}");
    print("P stats is ${p.stats}");
    print("P alchemy is ${p.getStat(Stats.ALCHEMY)}");

In dart, I see shit like:

  P is KnightSpace
  (program):1 P stats is (SBURB Lore, Minimum Luck, Maximum Luck, Free Will, ..., Alchemy, Experience)
  (program):1 P alchemy is 567.0



Okay, in the compiled version I see:

P is HeirSpace

And then NOTHING ELSE.


~~~~~~~~~~~~~~~


Okay.

I need to think clearly about this.

I fixed a bug in Your Story. This required only a single line of code outside of the Your Story controller.

NOW, all regular sessions are crashing 100% of the time at Gristmas.
Even if I comment out the single line of code I changed.

Why?

If I murder gristmas, it all works.
It seems to be upset about being asked to sort on alchemy skill.
I WAS just in the stats for the Your Story thing.

I restarted intelli-j just in case some dumb shit thing happened.


Investigate: did I REALLY only change a single line of code? Ask git hub.

Results: I changed a single line in player.dart, and a few lines in the Your Story controller.


Alright.  Don't panic.

One quick test you can do is to confirm the source of the gristmas problem.
After all: you notice you are confused.

Gristmas isn't the only thing that you sort by a stat. You sort by mobility for fights and for quest help.
You probalby sort by free will for mind shit, etc. etc. So why is Gristmas special? Is it that it's referring to alchemy?

There are two related, but different problems here:
    * WHY IS THIS HAPPENING?
    * HOW DO I STOP THIS FROM HAPPENING.

I can't get too bogged down by the first and ignore the second.





~~~~~~~~~~~~~~~~~~~~~~~~~~~~

It's been a month.

WigglerSim had me.

Now I need to sit down and SOLIDLY think about the npc update.

First thing: reread manic's npc doc. Where did it go?

Oh shit, manic made that ALL THE WAY IN AUGUST. Why does it take me so long to code??? Gotta go faster.



Summary:

Activated agents are like WV in that they can do shit on their own without a player.
This will be in the Shenanigans update. (god i literally forgot WV was in this sim).

Agent quests are based on their stats (specifically sanity???)

Agents can spontaneously party up with a player.

Some of the stuff, like sabatoging land quests doesn't apply anymore. Hrrrm.

most of midnight crew is shenanigans. reviewing ut not planning it yet.

BEHOLD MY ROBES
 is going to be the meat of this one i think.



 "Consort assistants can show up at any time, one per player. They are guaranteed to show up for Pages. "
 definitely redoing since the new quest mechanic is a thing.

 I think I want to have RANDOM quest rewards possible, like a new category that can give you a fraymotif, item OR npc companion.
 time to start a trello cat.

consort categories are great.

"In other news, Hope players can have imaginary friends who function exactly the same as a consort Assistant, except they have different flavor text. ""
hell yes.



then a bunch of shenanigans
then a bunch of horrorterror stuff that would ALSO make for great shenanigans.

alright. i think i have a solid bead on how i want to do the npc companion foundation.

EXCEPT: I need to have a list of all active NPCS, not just ones that are shoved into a player's inventory.


SO.

How to do this? Part of this will be in the shenanigans update, but I want to have the foundation right.

I definitely want a folder of NPC Scenes.

I know I have an NPCHandler object? What's that all about?

Oh shit i already have a whole folder for "NPCEngine.". ....Cool. pastJR does it again.

    Session session;
    GameEntity king = null;
    GameEntity queen = null;
    GameEntity jack = null;
    GameEntity queensRing = null; //eventually have white and black ones.
    GameEntity kingsScepter = null;
    GameEntity democraticArmy = null;


    Can have a list of "active npcs" as well.



    Once it's time for shenanigans, though, how do I associate an npc with quest lines?

    Should it be attached to the npc itself? A scene they create that gets added to the npc scenes?
    the way jack and wv add scenes right now?

    which is another good point, need list of npc scenes attached to session.


~~~~~~~

Okay i want to have the title system manic worked out expanded to care about high stat AND low stat.

That basically means you find the consort's title in a 2 dimensional matrix.

one axis is high stat name and one axis is low stat name

how to code this? maps? stat to name?

map of maps.

first map is highest stat.  contains a map of all the lowest stats and the titles they have.


~~~~~~~

Alright consorts were finished in two days.

What to do now about carapaces?

Carapaces aren't as random. Instead, CD is always going to be CD, he just might be Clubs Deuce
or Capering Destroyer or Courtyard Droll.

So Carapaces have an array of first names, an array of last names, and then an array of
RINGED first names and RINGED last names.

CD will always act like CD. That's just how it works.

So, what carapaces are there? (check glitch faq as well)

Jack (goes by Jack Noir unless something changes)
CD
HB
DD
PM
WV
AR
JS (jazz singer)
RB  (royal baker)

Royalty: go by special names unless something changes
WQ
WK
BQ
BK


So immediately it shakes out that if I pass a carapace a specific name
it will use that name unless something changes in which case it rerolls it's name.



alright i've got the discord brainstorming carapaces for me. Now what.

Well, the obvious next route is to figure out how these carapaces get created.

Things like the Midnight Crew are special and canon.

Same with the Problem Sleuth team.

So NPCHandler can have 4 arrays:

Special Dersites
Rando Dersites
Special Prospitians
Rando Prospitians.

The carapces in general will be harder though.

manic's 'active' system is especially important.

Hrrrrrm.......

I almost CAN'T do carapaces without at least thinking through shenanigans a bit. since carapaces have teams and shit.

OR would things like that be in scenes.

oh man "pose as a team" would be such a good scene to have, triggers if entire team is active.


Alright.

Without going into details, I want to spend 5 minutes (fuck i don't have my watch, whatever) 5 minutes
thinking about use cases for the Shenanigans update in relation to carapaces.

Existing shenanigans include: Depowering the Royalty (WV), Depowering the Black Queen in particular (Jack).

New:

Mail Quests for PM will give players random items (not related to their classpects).
Misc Quests (baking, singing, painting, etc) will give stat bonuses? (multiple of the same scene?, just diff flavor text set)
Rebel

Midnight Crew Quests: Weaken Black Queen
Problem Sleuth Quests: Strengthen White Royalty?

Do Crime Quests:   Weaken Associated Royalty
Solve Crime Quests: Strenthen Associated Royalty


Alright, the temptation is to leave carapaces entirely till i'm ready for shenangians, but that's not
gonna happen over night. Get them existing first.



~~~~~~~~~~

Alright.

Time for the less mession critical npc companions.

We have Brain Ghosts of friends/rivals/heart players, Robot versions of yourself, Leprechauns, and activated Dream Selves.

First up will be Leprechauns, but I want to get everything brainstormed in one place.

Dream Selves will be from a moon quest I think. If you're a heart player or there EXISTS a passive heart player of any type,
you can get a Dream Quest to wake your dream self up permanently.

If you do it, then you lose your dream self, and a player gets added to the party that is you, but dream.
They have your exact same land, not a copy of it.

I think all dream selves should be Players now, and an array, too, so you can sometimes have two of them.


Alright, what about Brain Ghosts?  I say that's hope only. It should be a QUEST REWARD possibility, so I'll need
to do random quests first. But basically, your best friend or rival OR the heart player can be a Brain Ghost.
They aren't added to the Player list. They should be transparent like a ghost? THEY SHOULD BE RENDERED.

What about RoboSelves?  If you have high enough alchemy skill, Alchemy scene can give you a RoboSelf
(first NPC companion that isn't from quest line). RoboSelf will be of you if Active, and of someone else if Passive.
RoboSelf will either be added to YOUR party, or to somebody you care a lot about (whether red or black). THEY SHOULD BE RENDERED.


So both Brain Ghosts and RoboSelves, as players, should be rendered whether in combat or in quests.
It MIGHT automatically happen, not sure.

And now for the one I want to do first. Should be simple, though I want to sit down and think about Leprechaun naming schemes.
I know the Brope has a doc somewhere. Here's what I remember?

Basically, the first Leprechaun you get should have a name with a "1" pun in it, or similar.
Second should have a two pun. So need to check companion list and see what  you got.

For dead sessions should get exactly one per land? Not sure. Maybe part of Denizen questline.

Alrigiht I found the doc from the Brope:

READ FIRST: Clover, Crowbar, and Snowman are constants other than that do whatever


1 and 2 and 6 will do mobility, 3 and 5 do freewill, 4 increases minluck and maxluck, 7 does sanity, 8 does all stats, 9 does hp, 10 does sanity, 11 does alchemy, 12 and 13 do freewill, 14 does sanity, and 15 does power

seems solid, and this reminds me that they also need to give stat bonuses to the lord somehow.
can either be permanent when they are added, or somehow linked to them being alive and in lord's party

Didn't I do something like that at some point recently?

....what was it?

there we go. buff specibus.

shit actually this looks easy.

So, if a player is a lord, they get a minion buff, which lasts as long the minion is alive.
minion buff just straight up adds the minions stats to the lord. sure, lords might be OP
but isn't that the point?

alright, so first thing first: get a lord buff.
second thing second, add a "random reward" kind of reward

actually maybe do opposite style. random reward calls some other reward's apply and gives you it's text, right?

~~~~
current bug, all leprechauns are getting the first name.
oh, duh. never adding them to party.
~~~~~~

alright, time for robots.

i think they'll be easy. if alchemy is high enough, make a bot, either of yourself,
or of your best friend.


~~~~~~

BUG: each time you're rendered dead, it flips the context. maybe?

robots and combo sessions are rendering upside down.

WHY.


What I have it doing now (that STILL isn't working)
is that it saves the context before rendering for make dead, then restores it.

i confirm the robot is only made dead once.

is it rendered from scrat.... wait even if it was the restored context should......hrrrrm
maybe not?

let's test

Drawing sprite from scratch Doomed RoboWitch of Blood's Corpse
2VM144:1 Drawing sprite from scratch Witch of Blood's Corpse

why.
what about caching?

in fact....nothing seems to be caching?
should have a change in title if it renders again.
fuck.

looks like "render self" is called twice. why.


WHY???

render self should only be called on state change.
right?

fuck it , time to add debugging



~~~
Alright that took way too long but:

rendering Doomed RoboWitch of Blood's Corpse from initSpriteCanvas
VM166:1 Drawing sprite from scratch Doomed RoboWitch of Blood's Corpse
VM166:1 rendering Doomed RoboWitch of Blood's Corpse from makeDead
VM166:1 Drawing sprite from scratch Doomed RoboWitch of Blood's Corpse

Look at that shit.  Why is their dead self getting initSpriteCanvas??? That should happen ONCE.
........
i even made sure it would only happen if null right there.

and it keeps saying the canvas is null.

this is not right.
not right at all.

~~~~~~~~
i want to enable yellow yards for dead sessions.

i think they are normally called by the aftermath.

so now i just call it via the reckoning.

Basically, for dead sessions, either the lawn ring is up, or you have a good relationship with your meta player
(or it's the special session)

the meta player will be all "Okay. I feel bad for you. I'll see if JR can do anything." (unless it is JR or AB?).

Then yard.

But.

A secret.




            timePlayer = findAspectPlayer(this.session.players, Aspects.TIME); //NEED to have a time player here.;
            var s = new YellowYard(this.session);
            s.timePlayer = timePlayer;
            s.trigger(null);
            s.renderContent(div);


alright that looks simple enough


~~~~~

Alright, dead sessions are not allowing yards to happen. Look at this flagrant bluushit:

Before Yard: Scene ID: 1 Name: DeadIntro Session Health: 130000.0 TimeTillReckoning: 397 Last Rand: 1140900365
After Yard: Scene ID: 182 Name: DeadIntro Session Health: 130000.0 TimeTillReckoning: 397 Last Rand: 3086440375

For the very first fucking scene the rand is differnet.
WHY!?

        this.rand.setSeed(this.session_id);
is happening in reinit....hrm.

okay i think i got it
the session reinit isn't doing everything it needs to


dead session on start up does:

 mutator.sessionHealth = 13000 * Stats.POWER.coefficient;
        sessionHealth = mutator.sessionHealth;
        //have a metaplayer BEFORE you make the bullshit quests.
        mutator.metaHandler.initalizePlayers(this);
        metaPlayer = rand.pickFrom(mutator.metaHandler.metaPlayers);
        metaPlayer.setStat(Stats.EXPERIENCE, 1300);
        makeThemes();
        timeTillReckoning = minTimeTillReckoning; //pretty long compared to a normal session, but not 16 times longer. what will you do?


 compared to regular session

       this.rand = new Random(session_id);
         PotentialSprite.initializeAShitTonOfPotentialSprites(this);
         npcHandler = new NPCHandler(this);
         mutator = SessionMutator.getInstance();
         this.setUpBosses();
         this.setupMoons(); //happens only in reinit
         stats.initialGameEntityId = GameEntity.getIDCopy();
         print("Making sesssion $this with initialGameEntity id of ${stats.initialGameEntityId}");
         ////print("Made a new session with an id of $session_id");

         logger = Logger.get("Session: $session_id", false);

         mutator.syncToSession(this);
        resetAvailableClasspects();


fucking hell.
i don't think the dead reinit is even being called



wait, no, it is.

dammit.


so what is happening? why is the random number not changing?

bluuuuuuuuuuuh

okay, let's do something dumb, set the random number to something really wrong

........................

Scene ID: 1 Name: DeadIntro Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 1140900365
vs
Scene ID: 90 Name: DeadIntro Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 1140900365

What.
The.
Hell.

I did:

        this.rand.setSeed(131313131313);
as the last thing in reinit. Why.

What?

((and more importantly. HOW. ))

The session definitely doesn't go the same, either.

Scene ID: 2 Name: DeadQuests Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 3514035271
vs
Scene ID: 91 Name: DeadQuests Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 3086440375


it's count bullshit bugs vs count bullshit rocks, too.
hrrrm.

and that number....3086440375 is the one i kept seeing before. does that mean one extra seed kept being eaten?
but then....why isn't 2 the same?

i am so confused.



A wave of destruction heralds the arrival of the God Tier Lord of Rage. They have many INTERESTS, including Classism and Genocide. They are the only Player. SBURB was never meant to be single player, and they have activated the secret 'Dead Session' mode as a punishment. Or is it a reward?

Skaia is black and lifeless. What can they even do now? Is there even a way to win?

They stare hopelessly at what was their former planet, now transformed into the Land of Heavy Balls and Blaze.

Some asshole called Waste of Mind (jadedResearcher) is bothering them too, claiming to somehow both be a player from another session AND responsible for SBURB? This is bullshit. The local Skeletons begin flipping the fuck out. Do they ever stop rattleing?
Scene ID: 2 Name: DeadQuests Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 3514035271


A wave of destruction heralds the arrival of the Doomed Murder Mode God Tier Lord of Rage. They have many INTERESTS, including Classism and Genocide. They are the only Player. SBURB was never meant to be single player, and they have activated the secret 'Dead Session' mode as a punishment. Or is it a reward?

Skaia is black and lifeless. What can they even do now? Is there even a way to win?

They stare hopelessly at what was their former planet, now transformed into the Land of Charles and Rot.

Some asshole called Waste of Mind (jadedResearcher) is bothering them too, claiming to somehow both be a player from another session AND responsible for SBURB? This is bullshit. In the distance, you can hear the relaxing sound of rustling.
Scene ID: 91 Name: DeadQuests Session Health: 130000.0 TimeTillReckoning: 350 Last Rand: 3086440375

The land is different.

And.....huh.


~~~~~~~

Okay.

Combo sessions with a player who WINS works. It's not a dead session.

But the easter egg I'm working on is NOT working and I don't know why. Jesus fuck.

I guess first i need to find a winning player.


alright, i can see the new intro scenes are right and not deadIntros.


it's even not calling the dead session intro scene. am i changing the controller out?

Yes. I confirmed it switches over to Sim Controller (instead of DeadSimController) somehow.



anger.

~~~~~~~~

Okay. I've found a session that AB lies about.

I need to focus up. I haven't had to do this in a while and I feel rusty and overwhelmed.

And weirdly tempted to just....sweep it under the rug. But no. Dear sweet precious AuthorBot needs help.

Session is: 2544085392

and i found it ~43 from the session 737292437 in AB.


So, first step is to see if it's still wrong with images = pumpkin, although that hasn't been true since
that very first time.

Yep. That was a bust.

Okay.

So. Next step is to see if the session is wrong on it's own through ab.

And the step after that is to see how far back i have to go before it's right.

Alright so yes, looking for it directly shows everybody dying instead of better than expected.

Let's go one back.

Huh. Okay. Sessions even before that are busted too. How far do i have to go back before i find one that isn't?


check second session in pile, then go back and do binary search

alright, higher up wasn't but 3/4 through was, 2702805258.

alright hopefully getting closer.
AB is saying that 1348701762  is a combo session but it raw isn't (everybody dies)

Okay i think i have found it.



: 847410037 is normal.

But it's SCRATCH does some fucked up shit.

and the next session is a completely differenet seed depending on if : 847410037 was first or not.

but what's weird.....wait.

the two scratches are identical
but the next session is different anyways?

hrrrrm........

maybe only sessions that do whatever is broken are different? I'm gonna look a few sessions up and see if anything
is wrong higher.

Going one up the session above the scratch is still different. Hrrm.  In both the smaller chains, it's a void waste session.

id of 3867145154 vs 2702805258

it's weird that it divurges so severely there.

1027738496 is still differnt from what i see at the end, too. How high must i go before it divurges.

or.

different question. did the code change? what happens if i search for the first one

the session after 847410037 is what i am interested in....


yeah..... it's different.

i guess..... that was just a page that was cached? fuck. well let's see if that original divurgent session is fixed.

Nope.

Fuck. Like seriously. Goddamn.

Gotta focus up.

My current goal is the same: find a session where the divurgence seems to start.

So, is the one directly up different?

930109068 in the big mess is mvp: Witch of Time With a Grist Level of: 508.0, but asked for directly is mvp: Witch of Time With a Grist Level of: 550.0

That's pretty subtle.  What about one up from that?

260330609 is a combo session in the big pile and a regular one stand alone. fuck. it heavily divurges there.

subtle differences in 4118832719
1348701762 goes from combo to tpk
2690788458 is only subtly different and is wasted both times


there we go.

3867145154 is the same in both sets and is wasted.

fucking wastes.

honestly. at some point i should work on giving AB an upgrade where she literally blows everything away and recreates it.
let NOTHING be preserved between sessions.

just to make sure, going one back to 847410037

yup.

Alright then. asking 3867145154 if it's the same with images vs non.

wait no that doesn't make sense.

but anyways, looking at the sesssion in question.... it has one wasted  hope event....

so i wonder if it's hope gnosis that's the problem.  one way to test: ask waste of hope stuck

~~~~~~~~~~

alright jesus fuck the sim is being a dick.

/*holy fuck nothing i do keeps us from dying. oh well.
        for(Player p in curSessionGlobalVar.players) {
          p.addStat(Stats.HEALTH, 100);
          p.makeAlive(); //why is this necessary, shogun stop killing us before you even get in.
        }*/


no more "oh well".

But. If that isn't working.

What would work?

I don't even know why sb is dying? are they the original meta player for 4037 and gets superceded by jr?

is it really noone else? fuck that is. i'm so sorry.

gotta focus up.

first step: check.

Okay. First fact. It happens whether it's a "redemption" or "invasion".  This is important. I thought it was invasion only.

It happens twice. But both times to nobody.

Fuck. How is that even possible?

First step, that piece of code represents "making sure players with zero health count as dead".
So.
When the session starts, print out all players and their stats. Probably a useful thing anyways. Maybe he never had
init stats called?

Okay.  nobody starts life with their health at -508. jesus fuck.

I also see that even the "redeemed" FU is spawning doomed and murder mode because my life can never just be easy, can it?

alright. I think that both problems have the same root:

I need to re-generate the meta players.

I'd also like to find out why nobody has negative health, but I think regenerating him will be good enough.

there we fucking go. I'm TRYING to reinit the players, but as long as JR exists it wiill refuse to do so.

so now i added code so it can insist on doing it anyways. i bet this was causing some yard bullshit or AB bullshit, too.

alright. i THINK the reason sb is taking damage is because of that bug a few people have reported where
dead sessions with a FORCED meta player will sometimes report the wrong meta player as being involved.

.....

I reinited all players.

I fucking did it.

I KNOW I did it because FU isn't spawning doomed and murder mode.

But.

Nobody still has negative hp.

What.

.........

Is.

Is it because he's a Lord, somehow? That's the other thing I changed.

Fuck. It is. I make him a Page and he has a whopping 1 hp SOMEHOW. WHAT IS GOING ON.


and now the invading sauce player doesn't exist anymore at all. wth. focus on nobody first tho.

Okay.
Okay.
Okay.

Step 1. Ask a regular lord nobody from session 13 how much hp he spawns with.

76.

Step 2.  Ask an invaded nobody how much hp he spawns with.

.......................76. And he dies out of nowhere anyways.

Clearly i need to go into that scene.

Is anybody stealing hp?

aw?

It's still happening.

I at least now know that the Lord buff can run into negative hp. But I don't know why. Nobody spawns with companions.

that code isn't even hitting.

but nobody still has 1 hp now anyways.

hwy.

~~~~~

now that i at least have a bandaid mark II, i need to figure out why session invasions don't work anymore

the player is rendered, they are a known foreign player. but then nothing happens.

i guess... i just need. to find out why. that happens.

or what normally happens.

is it happening to combo sessions, too? i guess?

Yes.

I broke all combo sessions.

I don't know why.

it could be they aren't being added to the player list for some reason? how are they normally?

aliensClonedOnArrival is null?

        addAliensToSession(newSession, this.players); //used to only bring players, but that broke shipping. shipping is clearly paramount to Skaia, because everything fucking crashes if shipping is compromised.
right before it's called it says:
about to add: 1 aliens to new session.

about to add: 1 aliens to new session.
VM93:1 in method, adding 6 aliens to session with 11 players already
VM93:1 after adding 6 aliens to session it has 17 players



huh. Oh, that's right. I add the corpses too, just in case.
for the relationship shit.

but what else?

they are clearly............


oh.

OH.

Fuck.

SimController.instance.startSession(true);
        //load(curSessionGlobalVar.players, <Player>[], ""); //in loading.js


the old way was to load the players. and the start
the new way is to start the session normally which lets me get easter eggs.
but it MIGHT be clearling out the alien players.

let's find out, together.

or get distracted googling marbits. whatever.

Alright.

Let's go.

alright.

i can confirm that shogun of sauce is in the player list so i don't have to worry about it getting wiped out.

i can also confirm taht the intro is never called for him.

so....what gives?

~~~~~~~

It's been 8 hours.

I haven't solved this yet. Not fully.

I can't keep coding, in addition to the fact that I'm wearing down, DM will be here soon.

So.

I am going to spend 5 minutes on the clock defining the problem. I should have done that sooner.

The problem is that:

Shogun does not even attempt to enter the session. (confirmed that intro is not called for him).
At first, he seemed to be in the player list but he suddenly isn't anymore?
Other dead session players can invade sessions no problem.
Session 13 overrights existing players with meta players. This might blow shogun away.

~~~~~~~

........Alright.

why.

Why does the thief of blood loot the black king, but then doesn't have the scepter?

cuz they get corpse smooched okay.

but.

why else?


ThiefBlood (Wise Guy Book, RING OF ORBS EIGHTFOLD, Candelabra, ..., Nuclear Winter Poster, Compass) is looting BlackKing 's corpse of [SCEPTER]
VM715:1 after looting I have (Wise Guy Book, RING OF ORBS EIGHTFOLD, Candelabra, Dice, ..., Compass, SCEPTER) and corpse has ()
VM715:1 ThiefBlood (Wise Guy Book, Friendship Bracelet) is looting KnightLight 's corpse of []

like right there.

They get the RING and then......they go to loot their friend and dont' have it anymore.
......
....
are they alchemizing with it?

maybe add "crowned" to their title.

....Oh.

It's a robo clone of the Thief of Blood.

Okay.

So.



How to do frog and reckoning?

If a player or any of their companions or a prospit carapace has the Scepter, reckoning ends.
If a player or any of their companions or a prospit carapace as the ring, frog happens.

So new scenes. But can at least have a debug statement at the end of the current aftermath to test that asking the session
"does a player own the black queens ring" or whatever.

maybe game entities can have a flag "allied with players". which gets tripped if they are a companion
a player, or prospit. or it can be a get


yeah npc needs to know who their 'party leader' is.


~~

Alright. I need to figure out how to change the Reckoning and the Aftermath.

I do NOT want the reckoning to be stoppable. You fuck up, you fuck up. Maybe in big bad update, can make it stopable
but it summons a big bad.



Okay so.

How does reckoning currently happen?

I think it's in the sim controller?

        if((curSessionGlobalVar.canReckoning || curSessionGlobalVar.numScenes > maxScenes ||  findLiving(curSessionGlobalVar.players).isEmpty ) && curSessionGlobalVar.timeTillReckoning <= 0) {


so. if the reckoning is available, or we've done too many scenes, or everyone is dead, or there is no time.

that's easy to fix i think.

just make it instead be

if "reckoning == true || curSessionGlobalVar.numScenes > maxScenes ";

and then different things can set it on.

need to do instance, too.


~~~~

post scene refactoring:



observed behavior:

all the intro scenes go with no interuptions, then nothing else.

no clue why. so. let's go digging.

Alright, console says infinite ticks are happening with no ending.

So.

That's new.

Ah, there we go. The players think they have zero scenes for some reason. Excellent.


God fucking damn it. It thinks there are zero plaeyrs when it inits the scenes. because of course it does.

I must be calling it at the wrong time. I'm gonna just....

have players create their own scens on creation i think.
wait no, then things who are technically players but not active ones would have useless scenes.
nope nope nope

~~~~~

currently problem. only companions are being parsed as active, not bumped into carapaces like jack


hrrm, it even says jack isn't active....but....
A Jack Noir bumps into them and they chat a bit.

that happens. that should be them activating

~~~~~~~~~~~

before adding ring from BlackQueen, their sylladex is (RING OF ORBS ???FOLD) and my sylladex is ()
VM87:1 after adding ring from BlackQueen but before taking, their sylladex is (RING OF ORBS ???FOLD) and my sylladex is (RING OF ORBS ???FOLD)
VM87:1 after taking ring from BlackQueen, their sylladex is (RING OF ORBS ???FOLD) and my sylladex is (RING OF ORBS ???FOLD)



tell me how this makes sense.

Just.

jack takes the ring, and GETS the ring, but TWO ways I try to get it out of queens sylladex, and nothing.


.... is it a copy thing?

okay wait
wait
wait
a fucking second.

if i don't cache the ring and isntead directly say ........

oh my fuck.

i was setting       ring = target.ring;
 but then i was letting the target change like an IDIOT. omfg



~~~~~~

why does jack only think he should even consider offering up the regisword once?

.....are scene availibiites not getting reset or smoething? oh well, future jr will hafta do it

~~~~~

alright, pastjr couldn't figure this out. It's up to me.

I know session mutators do weird shit like not reset between sessions, because tht's the point of them.

Is it possible it's not re-creating jack or whoever between sessions? Hence it only does jacks stuff once
 cuz he's fucking DEAD the next time?

 How to test: print out each time a jack is made.

 okay never mind, jack thought qbout it 4 times this time. Maybe his shennnaigans needs to be lower prioriry
 .......
 oh.
 my.
 fuck.
 patsy isn't ever being returned. Of COURSE this is happening. God DAMN.

 ~~~~~~~~

             if(!g.dead) g.available;



..............................

what.

what the fuck.

that.
why do i keep making that mistake lately. that's not a method, set it to true dunkass.


~~~~~

okay.

now.


the system thinks a random fucking player owns the ring when they dont'. wtf.

maybe they lost it at some point, but never got marked as not it's owner....or they alchemized with it. fuck.


~~~~~~~~

Alright.

So.

Uh.

How do I want to do this?

Lands need to blow up. They kill their associated players, and set their land (if they are a player) to null.

if they are a moon, they kill their associated players's dream selves and the carapaces, and set the sessions' prospit/derse to null.

is that enough? I think so.

but what about for dead sessions? ...worry about taht soon, i guess. for a dead session
should make session unwinnable. that's a flag, right? yeah.

it means ANY big bad or red miles activity can make a dead session unwinnable. that's the point, dunkass.
~~~~~

alright so. i'm fixing it up so that if your moon goes null you don't crash
when you can't do horrorterror dreams.  So...what now?

where does dreams actually happen? in quests? i'll need to do it for dead sessions, too

wait...no?

looks like it's just....
        player.moon.doQuest(div, player, null);


okay, so if moon == null, session.furthestRing.doQuest();

looks solid

and i guess if you somehow manage to blow up the FURTHEST RING you are just fucked and it crashes.

thems the breaks


~~~~~~~~~

Alright. Time to stop futzing around with the Bullet Hell Sim.
Looks like it'll be a three weekend project after all, not a two.


Right now I need to code ShogunBot. He's a Villain Nerd, and collects trading cards of them and their stats.

The Carapaces and (eventually) Dedicated Big Bads will keep track of their own stats. Things like:

* How many times did you end the session with a Crown?
* How many times did you ever have a crown?
* How many npcs did you kill?
* How many Players did you kill?
* How many Planets did you kill?
* How many Moons did you kill?
* How many Sessions did you kill?
* How many Scenes did you complete?
* How many times did you die?
* How many times were you active?
* How many times were you a companion?

Basically, new Object: BigBadBinder that is kept by MultiSessionSummary.

(Should it involve local storage??? This sounds adorable. But maybe impractical. Because...I also want you to be able to
go view any sessions the BigBad was active in. I could just store that and not the summary data...
but what if there is a deploy and it gets invalidated?)

Alright let's think about this. I want to introduce VERY rare things to the sim, and being able to have
AB store information about sessions in your cache would be useful. ShogunBot could use this information as well.

But how would this information work? Currently AB works via..........Shit am I talking about refactoring AB completely?

Maybe I should. She IS kind of insane right now...though that's probably from session leakage.

So, without any commitment to refactoring AB, if I were going to design her from scratch today I would want:

*Ability to store session stats in cache.
*Ability to 100% not have leakage between sessions.
*No requirement for sessions to be each other's children. (let's PL's eventual async idea work).


So. I could store session summaries as json or whatever. And recreate multisessionsummarires from that.

But is that what I want? Would mean I'd need to have BigBad data in an individual session summary.

How would I mark the data as dirty? That actually seems pretty obvious to me...wait no that'd be dumb.
Hrrmmmm..

It would need to be automatic, something I can't forget to do when I deploy. It would also have
to be visible to the Observer, or they won't know why they lost their data.

...
...
...

AB Sanity Check.

Before she checks ANY sessions, or lets you view any cached sessions, she does a sanity check.
She picks a random session from her cache and compares it to her current view of it. If it matches up, you continue.

If it doesn't, she displays a warning and asks if you'd like her to delete her cache, with an explanation that it's likely
just from JR deploying.

~~~~

What order do steps need to be in?

First: Keep AB exactly as is. Write "toJSON" method for SessionSummaries.  Call this method to store all found data in a cache.
    keyed by original (in the case of combo) sessionID and the word "scratch" or not.

Second: Make new page that displays ONLY the multisession summaries from memory. Cannot search for new ones
and does not clog up the page with SessionSummaries.

Third: On that new page, allow for filtering of session summaries.

Fourth: Filtered Session Summaries has pagination. (never more than 13 displayed at a time)

Fifth: On any page besides one (you know the one) AB does a sanity check before searching or displaying sessions.
    Take a random stored session. Search for it now. Compare results.
        if the same, start as normal
        if different, display an error and delete your cache.

Sixth: Decouple Sessions
    Look at this closer when you get there, but litearlly wipe out all information kept between sessions.
    Find all singletons or static classes and murder them. Turn them into instances.
    Manually make session mutators and afterlifes get carried over between scratches and combos.
        because it's manual, won't be carried over for yards or for ab searches

Seventh:  Write ShogunBot
    Allows data for BigBads to be displayed. (AB shares her data with her robot boyfriend)
    Big Bad data has session id stored with it, along with Entity info. Allows easy filtering.
    Can click a "view sessions" and it displays the session viewer.



~~~~~~~~~~~

alright . uh.

why does shogun bot not know about the list of sessions i'm making?

places to look:

* place i create the list
* place i convert hte list to json
* place i load it from json


What do I see?

the creation of the list has either zero or one after a single session.

Then, 35 carapaces are loded from json, and they are all zero:

from json, sessions are now 0 for active and 0 long for carapace
VM88:1 loaded carapace Jack Noir (SS) who is active 1 and sessions are now 1 for active and 0 long for carapace

this repeats over and over until it's time to write to json:
to json, sessions are now 0 for active and 0 long for carapace
(program):1 to json, sessions are now 1 for active and 1 long for carapace


how is it being called FROM json if it's never being called to json? and if that's the problem, why aren't the
rest of the stats zeroed out, too?

what else do i see?

to json, sessions are now 0 for active and 0 long for carapace
(program):1 to json, sessions are now 1 for active and 1 long for carapace
(program):1 to json, sessions are now 0 for active and 0 long for carapace
(program):1 to json, sessions are now 1 for active and 0 long for carapace
14(program):1 to json, sessions are now 0 for active and 0 long for carapace
2(program):1 to json, sessions are now 0 for active and 1 long for carapace
14(program):1 to json, sessions are now 0 for active and 0 long for carapace
2(program):1 to json, sessions are now 0 for active and 1 long for carapace


so some of them are 1 big when they go to json....

my assumption is it's any that were one this round......

So...

I guess the first thing I want to know is, why is "from json" being called? it looks like that's wehre the data is
 being lost.

 i kinda think that the carapace data shouldn't be messed with ....untill....


 Oh okay.

 So, what I'm doing is saving each session to the local cache every time it's done, since that's how
 i make it so you don't hafta wait for ab to be done to have data.

 i'm still not sure why 'to json' isn't being called tho

 so let's go find the place where i save a session....


    void save() {
        //i need to load all the session summaries from memory
        //then add myself to it
        //then turn them all to json
        //then save
        Map<String, SessionSummary> summaries =  loadAllSummaries();
        summaries[jsonKey] = this;
        SessionSummary.saveAllSummaries(new List.from(summaries.values));
    }



    so it looks like what i do is i load all the summaries i've stored in json (which is empty the first time)
    and then i add myself to it, and then i turn all the summaries back to json and put back into local storage

6 total sessions got:

DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
5  VM146:1 DEBUG SHOGUNBOT: loaded carapace summary with 0 active sessions for  SS


so....it was saved once and loaded 5 times. this doesn't make sense. the stats still look right...


when is save called?

makeSummaryForSession...


DEBUG SHOGUNBOT: making a session summary for session 1677437000
VM176:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
4 VM176:1 DEBUG SHOGUNBOT: loaded carapace summary with 0 active sessions for  SS





this is insane.

i notice i am confused.


what it looks like it's saying is that it makes exactly one summary, then loads 4 of them. how. why.

okay. Yes. that's the final session in the list.

which means ab is printing too much shit out for me to read it all.

time to go on a purge.

looks like a lot of json



yes okay

VM196:1 DEBUG SHOGUNBOT: making a session summary for session 1054585160
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2952231370
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS
VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2952231370
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
2VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS
VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2834243485
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
3VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS
(program):1 Debugging AB: going to check for combo in session: 2834243485 because makeCombined is true
(program):1 DEBUG SHOGUNBOT: making a session summary for session 2834243485
(program):1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
4(program):1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS

this looks better.

now to look closely at it

i'ts hard to focus but i can do this.

these are from 5 sessions total.

so let's add new lines


VM196:1 DEBUG SHOGUNBOT: making a session summary for session 1054585160
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS


VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2952231370
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS

VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2952231370
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
2VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS

VM196:1 DEBUG SHOGUNBOT: making a session summary for session 2834243485
VM196:1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
3VM196:1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS

(program):1 DEBUG SHOGUNBOT: making a session summary for session 2834243485
(program):1 DEBUG SHOGUNBOT: going to save a summary with 1 active sessions for  SS
4(program):1 DEBUG SHOGUNBOT: loaded a session summary with 0 active sessions for  SS


so, i correctly see that it loads a session for each one saved, none at first, then 1, 2, etc.

i notice that it always goes to save a summary with 1 active sessions, but then loads
loaded a session summary with 0 active sessions for  SS

alright.

I know that the session list is a list of ints. or rather. a set that turns into a list
does anything happen there?

check where it gets created.

DEBUG SHOGUNBOT:to json, sessions are now 1 for active and 0 long for crowned and made it [4047210998] and [] respectively
(program):1 DEBUG SHOGUNBOT:to json, sessions are now 1 for active and 1 long for crowned and made it [4047210998] and [4047210998] respectively


that looks good. so when it loads...

this might be it:
DEBUG SHOGUNBOT: from json, sessions are now 0 for active and 0 long for crowned, was [2583821404] and [2583821404] respectively
VM227:1 DEBUG SHOGUNBOT: from json, sessions are now 0 for active and 0 long for crowned, was [2583821404] and [] respectively

it has 0 when loading, evne if the json wasn't zero.

i know this works for....
DO i know this works for wigglersim? when was the last time i tested it?



DEBUG SHOGUNBOT: from json, sessions are now 0 for active and 0 long for crowned, was [3463532254] and [3463532254] respectively. temporary set form is {}
VM254:1 DEBUG SHOGUNBOT: from json, sessions are now 0 for active and 0 long for crowned, was [3463532254] and [] respectively. temporary set form is {}


even the set is empty, which i wasn't expecting. i figured it....

huh.

if it's expecting to parse a set,but it's getting an array....does an array look different?

yup, iti's expecting curly braces
well
i kno whow to fix that
make it expect both
or make a new method
whatever
make a new method is probalby correct


I....

what?

this isn't right.

i think it's acting differently, but never getting above one session long?

hrm. or. no that makes sense, it's not collated. lets' go ask ShogunBot.

~~~~~~~~~~~~

>long, steadying breath.

Players are doing things before they are in a session, because, for example, the Alchemy scene just says

"who has highest alchemy, pick them." instead of "who owns this scene.".

So the blood player enters the session, then gets the Life player to do alchemy.

Redoing each scene to be sane would take time, and might not even work since some scenes are "groups of people do this"
type of deals.

Additionally, it gets rid of the "highest alchemy player" does alchemy that turn
since suddenly ALL players can do alchemy that turn.

Actually, that problem will happen no matter what. Ignore that for now.

Another thing is that the sessions should be able to access available players,
and so shouldn't try to secure a non active player. it's possible available does not exclude active
so an easy fix is to do that first.

actually, doing it that way is probably best, since each plaeyrs alcehmy scene as it stands now all chooses the same person
that person just might not be available? i think?

bluh.

why am i so surprised that completely redoing how scenes work fucks shit up

~~~~~

confirmed that mail quests aren't working right. what hte fuck. i'd hoped it was because players were
equipping the delivered items, but it just fucking isn't happening.

Alright. Let's find out why.



~~~~~~
Just one more bug fix before I can go back to my myserties and gigglesnort.

scratched sessions are crashing, just straight up crashing, the first time anyone tries to access a moon.

To be fair, this is after red miles are going, but it was Derse that exploded and a prospit dreamer
that couldn't dream.

Which is also a good point: this prospit dreamer claims to have no moon but is trying to dream on prospit.

so.

first, figure out why there is no prospit, but the player thinks they have a prospit.

print statement on reward
oh wait, not, it IS aplly derse. wtf?

but the scene it ends on is "do prospit bullshit".

Hrrrmmmm....

theory: it's from some sort of if statements where it's "if it's prospit, do x, else do derse"

i guess maybe they got blown up mid dream quest?

so rogue of mind is a real self without a dream self i'm thinking.....

i don't think it's the rewards fault...

i think the code for "dream in furthest ring" needs tweaked, and i think the rogue of mind needs to be marked as having
a dead dream self. maybe moon explosions aren't working

yeah only carapaces are listed out as dying from derse fuckign exploding.

so that's where i'll start

yeah it says that they all didn't die.

this is wrong.

i am
i am so confused.
further statements say that it was PROSPIT that exploded, despite it being visibly derse and all the dersite
carapaces dying....did i typo?
wait maybe two moons:

HeirLife did not die  in a moon splosion. Is it not their moon? They have Derse and it was Derse, false
(program):1 PageBreath did not die  in a moon splosion. Is it not their moon? They have Prospit and it was Derse, false

so what's up with this . they have derse and it was derse

is it a scratch thing? am i not syncing moons post scratch?

god i hate looking at the really old shit and figuring out how scratches worked

~~~~~

found a crash when combo sessions don't know wht the dream palette of a player is.
why.

when i print it out, all the survivors have a dream palette. clones have it. what's going on?


~~~~~~~~~


it's 4/13

I wanted to do a deploy today to at least have AB fixed.

It's been DAYS.

And things are currently WORSE than they were. Now instead of just being insane after X sessions, AB flat out doesn't
return after like, 1 or 2 or sometimes as many as ten.

I need to take a step back and just. Breathe. Define my problem for five minutes on the clock. Don't look
for solutions yet.

Alright: When this all started I was getting multiple reports about AB lying about sessions, especially
for [???].  I was, with some trouble, able to replicate this. It was pretty rare.

Once I found the problem, I tried to do my normal routine of debugging. View the session normally,
view it in What Pumpkin mode, see if there's differences (there were not, but it's been awhile i might be crazy).

Then, see if the the session goes wrong if it's the only session AB looks at (it did not).

At that point I know it's a leak of some sort between sessions. Sometimes it's the afterlife, often it's a mutator.

Basically, anything kept between sessions is suspect.
But this time, unlike the last times, I couldn't find anything obvious.

SO I did two huge refactorings designed to keep less information between sessions.  I even made it so that
sessions go asynchronously (wiht PL's help), so that I could make a "AB sanity checker" page (which i still haven't finished).

However, at that point AB stopped returning. After a lot of head scratching and hair pulling,
I determined that EVERY time she doesn't return she calls the sessionComplete function
and it does NOT give control back to AB.

I determined that it DOES relinquish control when run alone, and that if a session that fails is run FIRST
it will NOT fail.

To me this means it's part of the multiple session structure, somehow.  Except, if it were that simple,
she'd ALWAYS return on only the first session and no subsequent sessions.

I tried printing out a lot of data, but sessons that fail don't seem to differ in any meaningful way compared to sessions
that don't.

I DID see that "combo" code is being called when I think it shouldn't, but it LOOKS like this might happen
even for sucessful sessions.

I don't have any leads, even after five minutes, so I"ll dig around combos again.

~~~~~~

ahahahah i accidentally destroyed this file like, two weeks ago. go me.

got it restored but now i need to do a thing:


~~~~~~~~

BigBad summon conditions clearly need to be stored differently than scenes, because scenes are things that are proccessed
after you're activated.

Or are they?  I could have big bad startScenes be their own thing.  If I did that, then

Start, Middle and End could all be the "same kind of thing".

But the way i envisioned serializable scenes was completely different. What should I do?

Don't think about what code I already have, think about what I need:

I already have trigger Conditions created, which are meant to be for summoning, defeating, or any scene in between.

If I don't need to differentiate those things as much what happens?

A "summon" is just an action that ends with the big bad activating, which allows their main scenes to start being processed.

A "defeat" is just an action that ends with the big bad DEactivating.

So, A BigBad has three lists of scenes:

Start, the regular scenes list and End.

Does this sound right? Yes....

~~~~~~~~

Alright I need to focus up here:

My SHORT TERM GOAL is to be able to prove that Big Bads can appear in a session.
 Which means that, barring flavor text, the next step I need to take is to make a single "Effect" for a scene
 that involves the BigBad actually being activated. Then, I need to have a text document of big bads that I parse
 and a method every tick in a session that evaluates all known big bads to see if they have been activated.


 I don't want to actually do that, though, before I've branched Main and Experimental.

 SO.

 The Order of things I should do is:

 * Add flavor text to SummonScenes
 * Add effects to SerializableScenes
 * Text doc of a few Big Bads
 * BUG FIXES
 * Branch Main and Experimental
 * Big Bad Activation Loop
 * Test for crashes
 * Teach ShogunBot how to make cards for non Carapace Big Bads
 * Find sessions where the current Big Bads are being summoned



 How to do FLAVOR TEXT:

 Instead of it being a constant stored as a static (like i do with quests)
 each TRIGGER CONDITION has a list of replacements.

 A scene's flavor text builder lets you add anything from the list to the text box
 and then when it's time to actually replace it you itterate through all your conditions
 lists to replace shit.

 but it's not enough to just be a list of strings, is it. it needs to be a MAP
 of string, method to replace shit pairs.

 does it need to be a method or could it be a get? i like it being a get i think.

wait that might not work when i try to think it through...

Map<String, LambdaOrWhatever> replacements;

replacements["CARAPACENAME"] = replaceCarapaceName

String replaceCarapaceName(String textWithNameInItProbably){
    //do the replacey thing
    return newStringWithTHeNameInsteadOfThePlaceholder;
}

Big thing I'll need ot do is make sure the thingy to replace is unique....

Alright. Let's go.

Wait shit i need to rethink this

because i need to take in more than just a string. i need to take in....
yes okay

Map<String, ReplacementObject>

where Replacement Object has the same string as it's key and then a lambda cuz i need to keep
the key/values mapped together even when called....


~~

okay i can replace shit, what next?

I need scenes to have a flavor text box, and for that box to also have a drop down for every trigger condition
the scene has. these drop downs need to be added and removed if you add or remove trigger conditions.

Seems complicated, so let's break it down into steps:

STEP 1: FLAVOR TEXT BOX
    STEP 1a: when you edit box ,edit's scene's text
    STEP 1b: serialize flavor text
STEP 2: for each current trigger, add a drop down plus button
    STEP 2a: when you click button, adds selected word to flavor text box

and now, a quick break

or wait, what if the drop down is part of the trigger condition?

what would that mean? well for one it would auto show up or be removed when the trigger condition changes... and it'd
be obvious what it applies to....

but how would it know which text box to add it's text to?

let's do step 1 first















Shit.

Fuck.

I'm confused again.

I need to stop before I code anymore.

What is a scene like?

For a start scene, that's simple:

triggers cause the thingy to become active.

But what about for a more complicated scene, like let's say:


BB attacks a PLAYER.

The Trigger Conditions decide that the scene should happen.  maybe but....

~~~~~~~~

Okay.


New plan:

SerializableScenes have a list of targets, and boolean var for if they are supposed
to apply effects to ONE target, or ALL TARGETS.

TRIGGERCONDITIONS

are ways to filter possible targets.

CROWNEDCARAPACE becomes:
* target is carapace <-- gets all carapaces
* target is crowned <-- uses output of previous trigger to get only those with crowns
* target has item X <-- uses output of previous trigger to get only those with item

then it's triggered becomes if List<GameEntity> livingTargets.isNotEmpty && List<Land>  landTargets.isNotEmpty;




~~~~~~~~

Okay. I'm frustrated and confused. It's time to step back for five minutes, then maybe go take a break outside.

AB is insane. I've gotten multiple reports about it, and this time it's worse than normal.

I have a session, 2304171846, where a void gnosis happens and NOTHING IS RIGHT afterwards.

I went and did a quick refactor to make sure the mutator isn't being shared between sessions, and added a thing to
 the debug printout for the number of mutators.

The first session after that void gnosis is still wrong. It ends in a space gnosis in reality but AB
 thinks there's no gnosis and everything went okay.

 When I ask her to print out what happened in the session, somehow she prints out a bunch of debug
 lines but not any text unless it's about carapaces. I don't know why, but it means I can't
 do a simple diff comparison of the sessions.

 I'm frustrated, and I don't know what to do. If I could get her to print the entire session out correctly, then
 I'd be fine. I know the NPC stuff is the most recent, so likely makes a new div instead of appendHtml
 , it might be related to that.

 Even without an auto diff, though, I should be able to compare scene ids and see where there's a difference.
 It would be tedius and boring, but it gets me information I need.

 I can't think of anything at all that would be shared between sessions at this point, and any step is better than nothing.

 So.

 I'm going to go outside and look at some nature for ten minutes, then I'm going to come back in and
 spend a half hour or so line by line manually comparing the sessions.



 ~~~~~~~~

 Current Problem:

 Editing flavor text was working. But NOW, no matter how I edit it, the scene data box updates but the
 big bad data box does not.

 i can confirm i can copy the scene box from one screen to another.

 if i add a trigger it saves the big bad, but otherwise only saves the scene

 it calls '        scene.syncForm();' while name and shit calls

             syncDataBoxToScene();
and all that is is:

        dataBox.value = scene.toDataString();


which...
hrm...


void syncForm() {
    form.syncDataBoxToScene();
    if(gameEntity is BigBad) {
        (gameEntity as BigBad).syncForm();
    }
}

well. huh. isn't that a punch in the face.



